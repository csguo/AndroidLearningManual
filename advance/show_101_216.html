
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android中View绘制优化之一 优化布局层次_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li class="navcurrentLink"><A href="index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="Android基础之运行原理和机制" href="index_215.html">Android基础之运行原理和机制</A></h2>

  <h2><A title="Android高级篇之Android优化" href="index_216.html">Android高级篇之Android优化</A></h2>
<UL><li class="currentLink"><A title=Android中View绘制优化之一 优化布局层次 href="show_101_216.html">Android中View绘制优化之一 优化布局层次</A> </li><li ><A title=Android中View绘制优化二 使用include 标签复用布局文件 href="show_102_216.html">Android中View绘制优化二 使用include 标签复用布局文件</A> </li><li ><A title=Android中View绘制优化之三 优化View href="show_103_216.html">Android中View绘制优化之三 优化View</A> </li><li ><A title=Android FrameLayou和布局优化（一） href="show_104_216.html">Android FrameLayou和布局优化（一）</A> </li><li ><A title=Android FrameLayou和布局优化（二） href="show_105_216.html">Android FrameLayou和布局优化（二）</A> </li><li ><A title=Android GridView视图缓存优化（一） href="show_106_216.html">Android GridView视图缓存优化（一）</A> </li><li ><A title=Android GridView视图缓存优化（二） href="show_107_216.html">Android GridView视图缓存优化（二）</A> </li><li ><A title=Android布局优化的要点 href="show_108_216.html">Android布局优化的要点</A> </li><li ><A title=Android 适配器（Adapter）优化 href="show_109_216.html">Android 适配器（Adapter）优化</A> </li><li ><A title=Android UI 优化 href="show_110_216.html">Android UI 优化</A> </li><li ><A title=Android 你的OnTouchEvent() 触屏事件的优化了吗 href="show_111_216.html">Android 你的OnTouchEvent() 触屏事件的优化了吗</A> </li><li ><A title=Android SQLite的查询优化（一） href="show_112_216.html">Android SQLite的查询优化（一）</A> </li><li ><A title=Android SQLite的查询优化（二） href="show_113_216.html">Android SQLite的查询优化（二）</A> </li><li ><A title=Android SQLite的查询优化（三） href="show_114_216.html">Android SQLite的查询优化（三）</A> </li><li ><A title=Android程序运行性能优化 href="show_115_216.html">Android程序运行性能优化</A> </li><li ><A title=Android代码性能优化技巧 href="show_116_216.html">Android代码性能优化技巧</A> </li><li ><A title=Android进程管理机制及优化 href="show_117_216.html">Android进程管理机制及优化</A> </li><li ><A title=Android应用开发者指南：性能优化 href="show_118_216.html">Android应用开发者指南：性能优化</A> </li><li ><A title=如何优化java代码 href="show_119_216.html">如何优化java代码</A> </li><li ><A title=Android Dalvik检查和优化.apk.jar的流程introduce href="show_120_216.html">Android Dalvik检查和优化.apk.jar的流程introduce</A> </li><li ><A title=ProGuard支持哪些种类的优化 href="show_121_216.html">ProGuard支持哪些种类的优化</A> </li><li ><A title=Android和大家分享几个重要的代码（一） href="show_122_216.html">Android和大家分享几个重要的代码（一）</A> </li><li ><A title=Android和大家分享几个重要的代码（二） href="show_123_216.html">Android和大家分享几个重要的代码（二）</A> </li></UL>
  <h2><A title="Android高级篇之编译及反编译" href="index_217.html">Android高级篇之编译及反编译</A></h2>

  <h2><A title="Android高级篇之加密解密" href="index_218.html">Android高级篇之加密解密</A></h2>

  <h2><A title="Android高级篇之Android 安全" href="index_219.html">Android高级篇之Android 安全</A></h2>

  <h2><A title="Android高级篇之算法" href="index_220.html">Android高级篇之算法</A></h2>

  <h2><A title="Android高级篇之解锁教程" href="index_221.html">Android高级篇之解锁教程</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android中View绘制优化之一 优化布局层次</H2>
<div style="line-height:20px; font-size:14px;"><p>为了避免歧义，先将Android “Layout”一次的意思进行说明，主要有如下三个方面：</p><p>1、统称，即如何摆放UI，UI呈现效果等；</p><p>2、布局文件，即/res/layout/xxx.xml ；</p><p>3、布局过程  ，Android绘制过程中的 layout过程；</p><p>4、一些布局控件，例如LinearLayout、FrameLayout等。</p><p style="color:#3333FF;">改善布局效率(Layout Performace)</p><p>布局是Android应用程序重要的一部分，它与用户体验有着直接联系。如果一个布局是糟糕的，它将产生一个消耗内存与低效UI应用程序。 Android SDK及它包含的工具都能帮助你定位在布局过程中隐藏的问题，通过对这些课程的学习，你能够以很小的内存代价去实现流畅的平滑界面。</p><p>课程如下：</p><p style="color:#3333FF;">1、优化布局层次</p><p>同样地，一个复杂的网页会延长加载时间，你的布局层次如果太复杂也能引发一些效率问题。本课程告知你如何利用SDK的工具去观察你的布局以及发现布局过程的瓶颈问题。</p><p style="color:#3333FF;">2、使用标签复用布局文件</p><p>如果应用程序的UI在多处重复某些布局结构，本课程向你展示如何创建高效、可重用的布局结构，然后以合适的 UI布局文件包含它们。</p><p style="color:#3333FF;">3、按需加载View视图</p><p>除了简单地在另外的布局文件中包括一个布局组件，你可能想在需要的时候才将视图显现出来，有的时候是在Activity运行之后。本课程告诉你如何改进布局初始化行为----按需加载布局文件的某个视图。</p><p style="color:#3333FF;">4、如何使ListView流畅滑动</p><p>如果你构建了一个ListView实例呈现那些包含复杂或者大容量数据的列表项，这可能会影响ListView的流畅滑动。本课程提供了一些如何让滑动过程更加流畅的建议。</p><p style="color:#3333FF;">优化布局层次</p><p>一个通常的错误观念就是使用基本的布局结构(例如：LinearLayout、FrameLayout等)能够在大多数情况下产生高效率的布局。显然，你的应用程序里添加的每一个控件和每一个布局都需要初始化、布局(layout)、绘制(drawing)。举例来说：嵌入一个LinearLayout会产生一个太深的布局层次。更严重的是，嵌入几个使用layout_weight属性的LinearLayout将会导致大量的开销，因为每个子视图都需要被测量两次。这是反复解析布局文件时重要的一点，例如在ListView或者GridView中使用时。</p><p style="color:#3333FF;">观察你的布局</p><p>Android SDK 工具箱包括一个称作“ Hierarchy Viewer”的工具，它允许你去在你的应用程序运行时分析布局。通过使用这个工具，能帮助你发现你的布局效率上的瓶颈问题。</p><p>“Hierarchy Viewer”工具允许你在已连接的设备或模拟器中选择正在运行的进程，然后呈现出布局层次树 (layout tree)。每个正方块下的交通灯(见下图) --- 红绿蓝表现出了在测量(measure)、布局(layout)、以及绘制(draw)过程中的效率值，这能帮助你定位潜在的问题。</p><p>假设ListView 中的一项Item 存在如下(见图 1)布局 ：</p><p><img src="../img/adv_optimize/01_ListView 01.jpg"></p><p>“Hierarchy Viewer”工具可以在 /tools路径下找到。当打开它时，“ Hierarchy Viewer”工具显示了所有可用的设备以及运行在这些设备上的进程。点击”Load View Hierarchy”来显示某个你选择的组件的UI布局层次。举例来说，图2展现了图1的布局层次树。</p><p><img src="../img/adv_optimize/01_ListView 02.jpg"></p><p>在图2中，你可以直观看到这个三层的布局结构是存在一些问题的。点击项体现出了在每个测量(measure)、布局(layout)、以及绘制(draw)过程中的时间消耗(见图3)。很明显，该项(LinearLayout)花费了最长的时间去测量、布局、绘制，你应该花点精力去优化它们。</p><p><img src="../img/adv_optimize/01_ListView 03.jpg"></p><p>完成该布局文件渲染的时间分别为：</p><p><pre>测量过程：0.977ms</p><p>布局过程：0.167ms</p><p>绘制过程：2.717ms</p><p></pre></p><p style="color:#3333FF;">修改布局文件</p><p>由于上图中布局效率的低下是因为一个内嵌的 LinearLayout控件，通过扁平化布局文件----让布局变得更浅更宽，而不是变得更窄更深层次 ，这样就能提升效率了。 一个RelativeLayout 作为根节点也能提供如上的布局效果(即图1)。因此，使用RelativeLayout 改变布局的设计，你可以看到现在我们的布局层次只有2层了。</p><p>新的布局层次树如下：</p><p><img src="../img/adv_optimize/01_RelativeLayout01.jpg"></p><p>现在，完成该布局文件渲染的时间分别为：</p><p><pre>测量过程：0.977ms</p><p>布局过程：0.167ms</p><p>绘制过程：2.717ms</p><p></pre></p><p>也许它只是一点点微小的改进，但这次它会被多次调用，因为是ListView会布局所有的Item，累积起来，改进后效果还是非常可观地。</p><p>大部分的时间差异是由于使用了带有layout_weight属性的LinearLayout，它能减缓测量过程的速度。这仅仅是一个例子，即每个布局都应该合适地被使用以及你应该认真考虑是否有必要采用“layout_weight" 属性。</p><p style="color:#3333FF;">使用Lint工具 (译者注：ADT插件更新到最新的16.0后的工具)</p><p>一个好的实践就是在你的布局文件中使用Lint工具去寻求可能优化布局层次的方法。Lint已经取代了Layoutopt工具并且它提供了更强大的功能。一些Lint规则如下：</p><p>1、使用组合控件 --- 包含了一个ImageView以及一个TextView 控件的LinearLayout如果能够作为一个组合控件将会被更有效的处理。</p><p>2、合并作为根节点的帧布局(Framelayout) --- 如果一个帧布局时布局文件中的根节点，而且它没有背景图片或者padding等、更有效的方式是使用标签替换该&lt;Framelayout /&gt;标签。</p><p>3、无用的叶子节点 --- 通常来说如果一个布局控件没有子视图或者背景图片，那么该布局控件时可以被移除 (由于它处于 invisible状态)。</p><p>4、无用的父节点 --- 如果一个父视图即有子视图，但没有兄弟视图节点，该视图不是ScrollView控件或者根节点，并且它没有背景图片，也是可以被移除的，移除之后，该父视图的所有子视图都直接迁移至之前父视图的布局层次。同样能够使解析布局以及布局层次更有效。</p><p>5、过深的布局层次 --- 内嵌过多的布局总是低效率地。考虑使用一些扁平的布局控件，例如RelativeLayout、GridLayout，来改善布局过程。默认最大的布局深度为10。</p><p>当使用Eclipse环境开发时，Lint能够自动解决一些问题，提供一些建议以及直接跳转到出错的代码中去核查。</p><p>如果你没有使用Eclipse，Lint也可以通过命令行的方式运行。</p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

