
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android SQLite的查询优化（二）_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li class="navcurrentLink"><A href="index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="Android基础之运行原理和机制" href="index_215.html">Android基础之运行原理和机制</A></h2>

  <h2><A title="Android高级篇之Android优化" href="index_216.html">Android高级篇之Android优化</A></h2>
<UL><li ><A title=Android中View绘制优化之一 优化布局层次 href="show_101_216.html">Android中View绘制优化之一 优化布局层次</A> </li><li ><A title=Android中View绘制优化二 使用include 标签复用布局文件 href="show_102_216.html">Android中View绘制优化二 使用include 标签复用布局文件</A> </li><li ><A title=Android中View绘制优化之三 优化View href="show_103_216.html">Android中View绘制优化之三 优化View</A> </li><li ><A title=Android FrameLayou和布局优化（一） href="show_104_216.html">Android FrameLayou和布局优化（一）</A> </li><li ><A title=Android FrameLayou和布局优化（二） href="show_105_216.html">Android FrameLayou和布局优化（二）</A> </li><li ><A title=Android GridView视图缓存优化（一） href="show_106_216.html">Android GridView视图缓存优化（一）</A> </li><li ><A title=Android GridView视图缓存优化（二） href="show_107_216.html">Android GridView视图缓存优化（二）</A> </li><li ><A title=Android布局优化的要点 href="show_108_216.html">Android布局优化的要点</A> </li><li ><A title=Android 适配器（Adapter）优化 href="show_109_216.html">Android 适配器（Adapter）优化</A> </li><li ><A title=Android UI 优化 href="show_110_216.html">Android UI 优化</A> </li><li ><A title=Android 你的OnTouchEvent() 触屏事件的优化了吗 href="show_111_216.html">Android 你的OnTouchEvent() 触屏事件的优化了吗</A> </li><li ><A title=Android SQLite的查询优化（一） href="show_112_216.html">Android SQLite的查询优化（一）</A> </li><li class="currentLink"><A title=Android SQLite的查询优化（二） href="show_113_216.html">Android SQLite的查询优化（二）</A> </li><li ><A title=Android SQLite的查询优化（三） href="show_114_216.html">Android SQLite的查询优化（三）</A> </li><li ><A title=Android程序运行性能优化 href="show_115_216.html">Android程序运行性能优化</A> </li><li ><A title=Android代码性能优化技巧 href="show_116_216.html">Android代码性能优化技巧</A> </li><li ><A title=Android进程管理机制及优化 href="show_117_216.html">Android进程管理机制及优化</A> </li><li ><A title=Android应用开发者指南：性能优化 href="show_118_216.html">Android应用开发者指南：性能优化</A> </li><li ><A title=如何优化java代码 href="show_119_216.html">如何优化java代码</A> </li><li ><A title=Android Dalvik检查和优化.apk.jar的流程introduce href="show_120_216.html">Android Dalvik检查和优化.apk.jar的流程introduce</A> </li><li ><A title=ProGuard支持哪些种类的优化 href="show_121_216.html">ProGuard支持哪些种类的优化</A> </li><li ><A title=Android和大家分享几个重要的代码（一） href="show_122_216.html">Android和大家分享几个重要的代码（一）</A> </li><li ><A title=Android和大家分享几个重要的代码（二） href="show_123_216.html">Android和大家分享几个重要的代码（二）</A> </li></UL>
  <h2><A title="Android高级篇之编译及反编译" href="index_217.html">Android高级篇之编译及反编译</A></h2>

  <h2><A title="Android高级篇之加密解密" href="index_218.html">Android高级篇之加密解密</A></h2>

  <h2><A title="Android高级篇之Android 安全" href="index_219.html">Android高级篇之Android 安全</A></h2>

  <h2><A title="Android高级篇之算法" href="index_220.html">Android高级篇之算法</A></h2>

  <h2><A title="Android高级篇之解锁教程" href="index_221.html">Android高级篇之解锁教程</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android SQLite的查询优化（二）</H2>
<div style="line-height:20px; font-size:14px;"><p style="color:#3333FF;">四、子查询扁平化 </p><p>例子：</p><p><pre>SELECT a FROM (SELECT x+y AS a FROM t1 WHERE z&lt;100) WHERE a&gt;5</p><p></pre></p><p>对这个SQL语句的执行一般默认的方法就是先执行内查询，把结果放到一个临时表中，再对这个表进行外部查询，这就要对数据处理两次，另外这个临时表没有索引，所以对外部查询就不能进行优化了，如果对上面的SQL进行处理后可以得到如下SQL语句：</p><p><pre>SELECT x+y AS a FROM t1 WHERE z&lt;100 AND a&gt;5</p><p></pre></p><p>这个结果显然和上面的一样，但此时只需要对数据进行查询一次就够了，另外如果在表t1上有索引的话就避免了遍历整个表。</p><p>运用flatten方法优化SQL的条件：</p><p>1.子查询和外查询没有都用集函数</p><p>2.子查询没有用集函数或者外查询不是个表的连接</p><p>3.子查询不是一个左外连接的右操作数</p><p>4.子查询没有用DISTINCT或者外查询不是个表的连接</p><p>5.子查询没有用DISTINCT或者外查询没有用集函数</p><p>6.子查询没有用集函数或者外查询没有用关键字DISTINCT</p><p>7.子查询有一个FROM语句</p><p>8.子查询没有用LIMIT或者外查询不是表的连接</p><p>9.子查询没有用LIMIT或者外查询没有用集函数</p><p>10.子查询没有用集函数或者外查询没用LIMIT</p><p>11.子查询和外查询不是同时是ORDER BY子句</p><p>12.子查询和外查询没有都用LIMIT</p><p>13.子查询没有用OFFSET</p><p>14.外查询不是一个复合查询的一部分或者子查询没有同时用关键字ORDER BY和LIMIT</p><p>15.外查询没有用集函数子查询不包含ORDER BY</p><p>16.复合子查询的扁平化：子查询不是一个复合查询，或者他是一个UNION ALL复合查询，但他是都由若干个非集函数的查询构成，他的父查询不是一个复合查询的子查询，也没有用集函数或者是DISTINCT查询，并且在FROM语句中没有其它的表或者子查询，父查询和子查询可能会包含WHERE语句，这些都会受到上面11、12、13条件的限制。</p><p><pre>SELECT a+1 FROM (</p><p>	SELECT x FROM tab</p><p>	UNION ALL</p><p>	SELECT y FROM tab</p><p>	UNION ALL</p><p>	SELECT abs(z*2) FROM tab2</p><p>) WHERE a!=5 ORDER BY 1</p><p></pre></p><p>转换为：</p><p><pre>SELECT x+1 FROM tab WHERE x+1!=5</p><p>UNION ALL</p><p>SELECT y+1 FROM tab WHERE y+1!=5</p><p>UNION ALL</p><p>SELECT abs(z*2)+1 FROM tab2 WHERE abs(z*2)+1!=5</p><p>ORDER BY 1</p><p></pre></p><p>17.如果子查询是一个复合查询，那么父查询的所有的ORDER BY语句必须是对子查询的列的简单引用</p><p>18.子查询没有用LIMIT或者外查询不具有WHERE语句</p><p>子查询扁平化是由专门一个函数实现的，函数为：</p><p><pre><font class="keyword">static </font><font class="keyword">int </font>flattenSubquery(</p><p>	Parse *pParse, /* Parsing context */</p><p>	Select *p, /* The parent or outer SELECT statement */</p><p>	<font class="keyword">int </font>iFrom, /* Index in p-&gt;pSrc-&gt;a[] of the inner subquery */</p><p>	<font class="keyword">int </font>isAgg, /* True </font><font class="keyword">if </font>outer SELECT uses aggregate functions */</p><p>	<font class="keyword">int </font>subqueryIsAgg /* True </font><font class="keyword">if </font>the subquery uses aggregate functions */</p><p>)</p><p></pre></p><p>它是在Select.c文件中实现的。显然对于一个比较复杂的查询，如果满足上面的条件时对这个查询语句进行扁平化处理后就可以实现对查询的优化。如果正好存在索引的话效果会更好。</p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

