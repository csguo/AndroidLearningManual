
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android 批量打包_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li class="navcurrentLink"><A href="index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="开发基础" href="index_100.html">开发基础</A></h2>

  <h2><A title="开发环境搭建" href="index_101.html">开发环境搭建</A></h2>

  <h2><A title="模拟器" href="index_102.html">模拟器</A></h2>

  <h2><A title="Resource" href="index_103.html">Resource</A></h2>

  <h2><A title="Manifest" href="index_104.html">Manifest</A></h2>

  <h2><A title="ADB" href="index_105.html">ADB</A></h2>

  <h2><A title="DDMS" href="index_106.html">DDMS</A></h2>

  <h2><A title="Logcat(日志)" href="index_107.html">Logcat(日志)</A></h2>

  <h2><A title="打包" href="index_108.html">打包</A></h2>
<UL><li ><A title=APK文件的解包打包和修改 href="show_801_108.html">APK文件的解包打包和修改</A> </li><li ><A title=Android 把APK文件打包编译 href="show_802_108.html">Android 把APK文件打包编译</A> </li><li class="currentLink"><A title=Android 批量打包 href="show_803_108.html">Android 批量打包</A> </li><li ><A title=Linux下使用shell控制ant批量打包 href="show_804_108.html">Linux下使用shell控制ant批量打包</A> </li><li ><A title=关于多个apk打包一起安装 href="show_805_108.html">关于多个apk打包一起安装</A> </li></UL>
  <h2><A title="文件处理" href="index_109.html">文件处理</A></h2>

  <h2><A title="底层基础" href="index_111.html">底层基础</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android 批量打包</H2>
<div style="line-height:20px; font-size:14px;"><p>为了放不同内容的漫画到Android Market上，但是Android Market需要每个应用的不要不同的包名，所以就需要批量打包了；</p><p>流程差不多是这样的：</p><p>1.给编辑人员图形界面操作资源；</p><p>2.利用Ant处理相应的资源；</p><p>3.利用Ant打包；</p><p>4.以用Ant把apk安装到模拟器，看是否正常运行；</p><p>这里主要写利用Ant打包apk文件，弄了我好一阵，写下来为自己备忘，也希望能帮助到刚好在处理相关的朋友；</p><p>分如下几步：</p><p>1.生成R.java</p><p>2.编译Java文件</p><p>3.生成classes.dex文件</p><p>4.打包res文件</p><p>5.把3和4生成的文件打包</p><p>6.签名apk</p><p><pre>&lt;?xml version="1.0" encoding="GBK"?&gt;</p><p>&lt;!-- step </p><p>1.generate R.java by aapt </p><p>2.compile java to class by javac.exe </p><p>3.generate classes.dex by dx.bat</p><p>4.package resources by aapt </p><p>5. package resource and classes.dex by apkbuilder.bat </p><p>6.sign apk by jarsinger --&gt;</p><p>&lt;project name="项目名" default="debug" basedir="."&gt;</p><p>&lt;property file="local.properties"/&gt;</p><p></p><p>&lt;!-- The intermediates directory --&gt;</p><p>&lt;!-- Eclipse uses "bin" for its own output, so we do the same. --&gt;</p><p>&lt;property name="outdir" value="bin" /&gt;</p><p>&lt;property name="out.absolute.dir" location="${outdir}" /&gt;</p><p></p><p>&lt;!-- Create R.java in the source directory --&gt;</p><p>&lt;property name="outdir-gen" value="gen"/&gt;</p><p></p><p>&lt;!-- Input directories --&gt;</p><p>&lt;property name="resource-dir" value="res" /&gt;</p><p>&lt;property name="asset-dir" value="assets" /&gt;</p><p>&lt;property name="src-dir" value="src" /&gt;</p><p>&lt;property name="src-dir-ospath" value="${basedir}/${src-dir}" /&gt;</p><p></p><p>&lt;!-- Output directories --&gt;</p><p>&lt;property name="outdir-classes" value="${outdir}/classes" /&gt;</p><p>&lt;property name="out.classes.absolute.dir" location="${outdir-classes}" /&gt;</p><p></p><p>&lt;!-- Intermediate files --&gt;</p><p>&lt;property name="dex-file" value="classes.dex" /&gt;</p><p>&lt;property name="intermediate-dex" value="${out.absolute.dir}/${dex-file}" /&gt;</p><p></p><p>&lt;!-- The final package file to generate --&gt;</p><p>&lt;property name="out-package" value="${outdir}/${ant.project.name}.apk" /&gt;</p><p></p><p>&lt;!-- Tools --&gt;</p><p>&lt;property name="aapt" value="${sdk-platform-tools}/aapt.exe" /&gt;</p><p>&lt;property name="aidl" value="${sdk-platform-tools}/aidl.exe" /&gt;</p><p>&lt;property name="dx" value="${sdk-platform-tools}/dx.bat"/&gt;</p><p>&lt;property name="adb" value="${sdk-tools}/adb" /&gt;</p><p>&lt;property name="apk-builder" value="${sdk-tools}/apkbuilder.bat" /&gt;</p><p>&lt;property name="android-jar" value="${sdk-platform}/android.jar" /&gt;</p><p></p><p>&lt;!-- The final package file to generate --&gt;</p><p>&lt;property name="resources-package" value="${outdir}/${ant.project.name}" /&gt;</p><p>&lt;property name="resources-package-ospath" value="${basedir}/${resources-package}" /&gt;</p><p>&lt;property name="out-debug-package" value="${outdir}/${ant.project.name}-debug.apk" /&gt;</p><p>&lt;property name="out-debug-package-ospath" value="${basedir}/${out-debug-package}" /&gt;</p><p>&lt;property name="out-unsigned-package" value="${outdir}/${ant.project.name}-unsigned.apk" /&gt;</p><p>&lt;property name="out-unsigned-package-ospath" value="${basedir}/${out-unsigned-package}" /&gt;</p><p>&lt;property name="out-signed-package" value="${outdir}/${ant.project.name}-signed.apk" /&gt;</p><p>&lt;property name="out-signed-package-ospath" value="${basedir}/${out-signed-package}" /&gt;</p><p>&lt;property name="zipalign-package-ospath" value="${basedir}/${ant.project.name}_release.apk" /&gt;</p><p>&lt;property name="jarsigner" value="${jdk-home}/bin/jarsigner.exe"/&gt;</p><p>&lt;property name="zipalign" value="${sdk-tools}/zipalign.exe"/&gt; </p><p></p><p>&lt;!-- init --&gt;</p><p>&lt;target name="init"&gt;</p><p>&lt;echo&gt;Creating all output directories &lt;/echo&gt;</p><p>&lt;delete dir="${outdir}" /&gt;</p><p>&lt;delete dir="${outdir-classes}" /&gt;</p><p>&lt;delete dir="${outdir-gen}" /&gt;</p><p>&lt;mkdir dir="${outdir}" /&gt;</p><p>&lt;mkdir dir="${outdir-classes}" /&gt;</p><p>&lt;mkdir dir="${outdir-gen}" /&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Step 1. Generate the R.java file for this project's resources. --&gt;</p><p>&lt;target name="resource-src" depends="init"&gt;</p><p>	&lt;echo&gt;Generating R.java...&lt;/echo&gt;</p><p>	&lt;exec executable="${aapt}" failonerror="true"&gt;</p><p>		&lt;arg value="package" /&gt;</p><p>		&lt;arg value="-m" /&gt;</p><p>		&lt;arg value="-J" /&gt;</p><p>		&lt;arg value="${outdir-gen}" /&gt;</p><p>		&lt;arg value="-M" /&gt;</p><p>		&lt;arg value="AndroidManifest.xml" /&gt;</p><p>		&lt;arg value="-S" /&gt;</p><p>		&lt;arg value="${resource-dir}" /&gt;</p><p>		&lt;arg value="-I" /&gt;</p><p>		&lt;arg value="${android-jar}" /&gt;</p><p>	&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Generate java classes from .aidl files. --&gt;</p><p>&lt;target name="aidl" depends="init"&gt;</p><p>&lt;echo&gt;Compiling aidl files into Java classes...&lt;/echo&gt;</p><p>&lt;apply executable="${aidl}" failonerror="true"&gt;</p><p>	&lt;arg value="-p${android-framework}" /&gt;</p><p>	&lt;arg value="-I${src-dir}" /&gt;</p><p>	&lt;fileset dir="${src-dir}"&gt;</p><p>		&lt;include name="**/*.aidl" /&gt;</p><p>	&lt;/fileset&gt;</p><p>&lt;/apply&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Step 2. Compile this project's .java files into .class files. --&gt;</p><p>&lt;target name="compile" depends="init, resource-src, aidl"&gt;</p><p>&lt;javac encoding="GBK" </p><p>target="1.5" </p><p>debug="true" </p><p>extdirs="" </p><p>srcdir="." </p><p>destdir="${outdir-classes}"</p><p>bootclasspath="${android-jar}" /&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Step 3. Convert this project's .class files into .dex files. --&gt;</p><p>&lt;target name="dex" depends="compile"&gt;</p><p>&lt;echo&gt;Converting compiled files into ${intermediate-dex}... &lt;/echo&gt;</p><p>	&lt;exec executable="${dx}" failonerror="true"&gt;</p><p>	&lt;arg value="--dex" /&gt;</p><p>	&lt;arg value="--output=${intermediate-dex}" /&gt;</p><p>	&lt;arg path="${out.classes.absolute.dir}" /&gt;</p><p>&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Step 4. Put the project's resources into the output package file. --&gt;</p><p>&lt;target name="package-res-and-assets"&gt;</p><p>	&lt;echo&gt;Packaging resources and assets...&lt;/echo&gt;</p><p>	&lt;exec executable="${aapt}" failonerror="true"&gt;</p><p>		&lt;arg value="package" /&gt;</p><p>		&lt;arg value="-f" /&gt;</p><p>		&lt;arg value="-M" /&gt;</p><p>		&lt;arg value="AndroidManifest.xml" /&gt;</p><p>		&lt;arg value="-S" /&gt;</p><p>		&lt;arg value="${resource-dir}" /&gt;</p><p>		&lt;arg value="-A" /&gt;</p><p>		&lt;arg value="${asset-dir}" /&gt;</p><p>		&lt;arg value="-I" /&gt;</p><p>		&lt;arg value="${android-jar}" /&gt;</p><p>		&lt;arg value="-F" /&gt;</p><p>		&lt;arg value="${resources-package}"/&gt;</p><p>	&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Step 4. Same as package-res-and-assets, but without "-A ${asset-dir}" --&gt;</p><p>&lt;target name="package-res-no-assets"&gt;</p><p>	&lt;echo&gt;Packaging resources...&lt;/echo&gt;</p><p>	&lt;exec executable="${aapt}" failonerror="true"&gt;</p><p>		&lt;arg value="package" /&gt;</p><p>		&lt;arg value="-f" /&gt;</p><p>		&lt;arg value="-M" /&gt;</p><p>		&lt;arg value="AndroidManifest.xml" /&gt;</p><p>		&lt;arg value="-S" /&gt;</p><p>		&lt;arg value="${resource-dir}" /&gt;</p><p></p><p>		&lt;!-- No assets directory --&gt;</p><p>		&lt;arg value="-I" /&gt;</p><p>		&lt;arg value="${android-jar}" /&gt;</p><p>		&lt;arg value="-F" /&gt;</p><p>		&lt;arg value="${resources-package}" /&gt;</p><p>	&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Invoke the proper target depending on whether or not an assets directory is present. --&gt;</p><p>&lt;!-- TODO: find a nicer way to include the "-A ${asset-dir}" argument only when the assets dir exists. --&gt;</p><p>&lt;target name="package-res"&gt;</p><p>	&lt;available file="${asset-dir}" type="dir" property="res-target" value="and-assets" /&gt;</p><p>		&lt;property name="res-target" value="no-assets" /&gt;</p><p>	&lt;antcall target="package-res-${res-target}" /&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Step 5. Package the application and sign it with a debug key.</p><p>This is the default target when building. It is used for debug. --&gt;</p><p></p><p>&lt;target name="debug" depends="dex, package-res"&gt;</p><p>	&lt;echo&gt;Packaging ${out-debug-package-ospath}, and signing it with a debug key...&lt;/echo&gt;</p><p>	&lt;exec executable="${apk-builder}" failonerror="true"&gt;</p><p>		&lt;arg value="${out-debug-package-ospath}" /&gt;</p><p>		&lt;arg value="-z" /&gt;</p><p>		&lt;arg value="${resources-package-ospath}" /&gt;</p><p>		&lt;arg value="-f" /&gt;</p><p>		&lt;arg value="${intermediate-dex}" /&gt;</p><p>		&lt;arg value="-rf" /&gt;</p><p>		&lt;arg value="${src-dir-ospath}" /&gt;</p><p>	&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Step 5. Package the application without signing it. --&gt;</p><p>&lt;target name="release" depends="dex, package-res"&gt;</p><p>	&lt;echo&gt;Packaging ${out-debug-package-ospath}, and signing it with a debug key...&lt;/echo&gt;</p><p>	&lt;exec executable="${apk-builder}" failonerror="true"&gt;</p><p>		&lt;arg value="${out-unsigned-package-ospath}" /&gt;</p><p>		&lt;arg value="-u" /&gt;</p><p>		&lt;arg value="-z" /&gt;</p><p>		&lt;arg value="${resources-package-ospath}" /&gt;</p><p>		&lt;arg value="-f" /&gt;</p><p>		&lt;arg value="${intermediate-dex}" /&gt;</p><p>		&lt;arg value="-rf" /&gt;</p><p>		&lt;arg value="${src-dir-ospath}" /&gt;</p><p>	&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!--Step 6. signer apk with private key --&gt;</p><p>&lt;target name="jarsigner" depends="release"&gt;</p><p>	&lt;echo&gt; jarsigner ${out-signed-package-ospath}&lt;/echo&gt;</p><p>	&lt;exec executable="${jarsigner}" failonerror="true"&gt;</p><p>		&lt;arg value="-verbose" /&gt;</p><p>		&lt;arg value="-storepass" /&gt;</p><p>		&lt;arg value="这里是keystore的密码" /&gt;</p><p>		&lt;arg value="-keystore" /&gt;</p><p>		&lt;arg value="你的keystore的文件" /&gt;</p><p>		&lt;arg value="-signedjar" /&gt;</p><p>		&lt;arg value="${out-signed-package-ospath}" /&gt;</p><p>		&lt;arg value="${out-unsigned-package-ospath}" /&gt;</p><p>		&lt;arg value="你的keystore的文件" /&gt;</p><p>	&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!--zipalign--&gt;</p><p>&lt;target name="zipalign" depends="jarsigner"&gt;</p><p>	&lt;echo&gt; zipalign ${zipalign-package-ospath}&lt;/echo&gt;</p><p>	&lt;exec executable="${zipalign}" failonerror="true"&gt;</p><p>		&lt;arg value="-v" /&gt;</p><p>		&lt;arg value="-f" /&gt;</p><p>		&lt;arg value="4" /&gt;</p><p>		&lt;arg value="${out-signed-package-ospath}" /&gt;</p><p>		&lt;arg value="${zipalign-package-ospath}" /&gt;</p><p>	&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p>&lt;!-- run --&gt;</p><p></p><p>&lt;target name="run" depends="zipalign, debug"&gt;</p><p>&lt;echo&gt;run... Package debug apk and un sign apk&lt;/echo&gt;</p><p>&lt;/target&gt;</p><p></p><p>&lt;!-- Install the package on the default emulator --&gt;</p><p>&lt;target name="install" depends="debug"&gt;</p><p>	&lt;echo&gt;Installing ${out-debug-package} onto default emulator...&lt;/echo&gt;</p><p>	&lt;exec executable="${adb}" failonerror="true"&gt;</p><p>		&lt;arg value="install" /&gt;</p><p>		&lt;arg value="${out-debug-package-ospath}" /&gt;</p><p>	&lt;/exec&gt;</p><p>&lt;/target&gt;</p><p>&lt;/project&gt;</p><p></pre></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

