
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android Service 详解简单音乐播放器_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li class="navcurrentLink"><A href="index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="Activity" href="index_112.html">Activity</A></h2>

  <h2><A title="Intent" href="index_113.html">Intent</A></h2>

  <h2><A title="Service" href="index_114.html">Service</A></h2>
<UL><li ><A title=Android Service (一) href="show_201_114.html">Android Service (一)</A> </li><li ><A title=Android Service (二) href="show_202_114.html">Android Service (二)</A> </li><li ><A title=Android Service生命周期 href="show_203_114.html">Android Service生命周期</A> </li><li ><A title=Android Service 生命期详解 href="show_204_114.html">Android Service 生命期详解</A> </li><li ><A title=Service的启动与运行 href="show_205_114.html">Service的启动与运行</A> </li><li ><A title=startservice和bindservice详解 href="show_206_114.html">startservice和bindservice详解</A> </li><li ><A title=Android Service 通信 href="show_207_114.html">Android Service 通信</A> </li><li ><A title=Service 与 Thread 的区分详解 href="show_208_114.html">Service 与 Thread 的区分详解</A> </li><li ><A title=判断一个指定的Service是否存在的方法 href="show_209_114.html">判断一个指定的Service是否存在的方法</A> </li><li ><A title=Android Service 代码实例 href="show_210_114.html">Android Service 代码实例</A> </li><li class="currentLink"><A title=Android Service 详解简单音乐播放器 href="show_211_114.html">Android Service 详解简单音乐播放器</A> </li></UL>
  <h2><A title="Content Provider" href="index_115.html">Content Provider</A></h2>

  <h2><A title="BroadcastReceiver" href="index_116.html">BroadcastReceiver</A></h2>

  <h2><A title="AsyncTask" href="index_117.html">AsyncTask</A></h2>

  <h2><A title="Handler" href="index_118.html">Handler</A></h2>

  <h2><A title="Thread" href="index_119.html">Thread</A></h2>

  <h2><A title="Permission" href="index_120.html">Permission</A></h2>

  <h2><A title="AIDL" href="index_121.html">AIDL</A></h2>

  <h2><A title="Json" href="index_122.html">Json</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android Service 详解简单音乐播放器</H2>
<div style="line-height:20px; font-size:14px;"><p>Service是android系统中的一种组件，它跟Activity的级别差不多，但是他不能自己运行，只能后台运行，并且可以和其他组件进行交互。Service的启动有两种方式：context.startService() 和 context.bindService()。</p><p>使用context.startService() 启动Service是会会经历:</p><p><pre>context.startService()  -&gt;onCreate()- &gt;onStart()-&gt;Service running</p><p>context.stopService() | -&gt;onDestroy() -&gt;Service stop</p><p></pre></p><p>如果Service还没有运行，则android先调用onCreate()然后调用onStart()；如果Service已经运行，则只调用onStart()，所以一个Service的onStart方法可能会重复调用多次。 </p><p>stopService的时候直接onDestroy，如果是调用者自己直接退出而没有调用stopService的话，Service会一直在后台运行。该Service的调用者再启动起来后可以通过stopService关闭Service。</p><p>所以调用startService的生命周期为：onCreate --&gt; onStart(可多次调用) --&gt; onDestroy</p><p>使用使用context.bindService()启动Service会经历：</p><p><pre>context.bindService()-&gt;onCreate()-&gt;onBind()-&gt;Service running</p><p>onUnbind() -&gt; onDestroy() -&gt;Service stop</p><p></pre></p><p>onBind将返回给客户端一个IBind接口实例，IBind允许客户端回调服务的方法，比如得到Service运行的状态或其他操作。这个时候把调用者（Context，例如Activity）会和Service绑定在一起，Context退出了，Srevice就会调用onUnbind-&gt;onDestroy相应退出。 </p><p>所以调用bindService的生命周期为：onCreate --&gt; onBind(只一次，不可多次绑定) --&gt; onUnbind --&gt; onDestory。</p><p>在Service每一次的开启关闭过程中，只有onStart可被多次调用(通过多次startService调用)，其他onCreate，onBind，onUnbind，onDestory在一个生命周期中只能被调用一次。</p><p>service可以在和多场合的应用中使用，比如播放多媒体的时候用户启动了其他Activity这个时候程序要在后台继续播放，比如检测SD卡上文件的变化，再或者在后台记录你地理信息位置的改变等等，总之服务嘛，总是藏在后头的。</p><p>下面我做了一个简单的音乐播放的应用，分别使用startService和bindService来启动本地的服务。</p><p>下面是整个应用启动界面：</p><p><img src="../img/component_service/11_service.jpg"></p><p>先从使用startService启动Service学起</p><p>首先编写一个Activity</p><p><pre><font class="keyword">import </font>android.R;</p><p><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.content.Intent;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">import </font>android.view.View;</p><p><font class="keyword">import </font>android.view.View.OnClickListener;</p><p><font class="keyword">import </font>android.widget.Button;</p><p><font class="keyword">public </font><font class="keyword">class </font>PlayMusic </font><font class="keyword">extends </font>Activity </font><font class="keyword">implements </font>OnClickListener {</p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>String TAG = <font class="Fields">"PlayMusic"</font>;</p><p>	<font class="keyword">private </font>Button playBtn;</p><p>	<font class="keyword">private </font>Button stopBtn;</p><p>	<font class="keyword">private </font>Button pauseBtn;</p><p>	<font class="keyword">private </font>Button exitBtn;</p><p>	<font class="keyword">private </font>Button closeBtn;</p><p>	<font class="Comments">// ....（详见源码）</font></p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>		<font class="keyword">int </font>op = -1;</p><p>		</font>Intent intent = <font class="keyword">new </font>Intent(<font class="Fields">"org.allin.android.musicService"</font>);</p><p>		<font class="Comments">// 广播用</font></p><p>		<font class="Comments">// Intent intent = new Intent("org.allin.android.musicReceiver");</font></p><p>		<font class="keyword">switch </font>(v.getId()) {</p><p>		<font class="keyword">case </font>R.id.play:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: playing muic"</font>);</p><p>			op = 1;</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.stop:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: stoping music"</font>);</p><p>			op = 2;</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.pause:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: pausing music"</font>);</p><p>			op = 3;</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.close:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: close"</font>);</p><p>			<font class="keyword">this</font>.finish();</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.exit:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: exit"</font>);</p><p>			op = 4;</p><p>			stopService(intent);</p><p>			<font class="keyword">this</font>.finish();</p><p>			<font class="keyword">break</font>;</p><p>		}</p><p>		</font>Bundle bundle = <font class="keyword">new </font>Bundle();</p><p>		</font>bundle.putInt(<font class="Fields">"op"</font>, op);</p><p>		intent.putExtras(bundle);</p><p>		startService(intent);</p><p>		<font class="Comments">// sendBroadcast(intent);</font></p><p>	}</p><p>}</p><p></pre></p><p>通过重写onClick方法来实现对播放音乐的控制。这里把播放音乐的各种操作用数字的方式通过Intent传递给service。 </p><p>构造一个Intent ，ntent intent = new Intent("org.allin.android.musicService");</p><p>"org.allin.android.musicService"是在AndroidManifest.xml文件中对service类的定义</p><p><pre>&lt;service android:enabled=<font class="Fields">"<font class="keyword">true</font>"</font> android:name=</font><font class="Fields">".MusicService"</font>&gt;</p><p>	&lt;intent-filter&gt;</p><p>		</font>&lt;action android:name=<font class="Fields">"org.allin.android.musicService"</font> /&gt;</p><p>	&lt;/intent-filter&gt;</p><p>&lt;/service&gt;</p><p></pre></p><p>把操作码放在Bundle中</p><p><pre>Bundle bundle  = <font class="keyword">new </font>Bundle();</p><p>bundle.putInt(<font class="Fields">"op"</font>, op);</p><p>intent.putExtras(bundle);</p><p></pre></p><p>最后使用startService(intent);启动服务。</p><p>下面看看Service是怎么实现的。</p><p>MusicService.java</p><p><pre><font class="keyword">import </font>java.io.IOException;</p><p><font class="keyword">import </font>android.R;</p><p><font class="keyword">import </font>android.app.Service;</p><p><font class="keyword">import </font>android.content.Intent;</p><p><font class="keyword">import </font>android.media.MediaPlayer;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.os.IBinder;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">public </font><font class="keyword">class </font>MusicService </font><font class="keyword">extends </font>Service {</p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>String TAG = <font class="Fields">"MyService"</font>;</p><p>	<font class="keyword">private </font>MediaPlayer mediaPlayer;</p><p>	@Override</p><p>	<font class="keyword">public </font>IBinder onBind(Intent arg0) {</p><p>		<font class="keyword">return </font><font class="keyword">null</font>;</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate() {</p><p>		</font>Log.v(TAG, <font class="Fields">"onCreate"</font>);</p><p>		<font class="keyword">if </font>(mediaPlayer == </font><font class="keyword">null</font>) {</p><p>			</font>mediaPlayer = MediaPlayer.create(<font class="keyword">this</font>, R.raw.tmp);</p><p>			</font>mediaPlayer.setLooping(<font class="keyword">false</font>);</p><p>		}</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onDestroy() {</p><p>		</font>Log.v(TAG, <font class="Fields">"onDestroy"</font>);</p><p>		<font class="keyword">if </font>(mediaPlayer != </font><font class="keyword">null</font>) {</p><p>			mediaPlayer.stop();</p><p>			mediaPlayer.release();</p><p>		}</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onStart(Intent intent, </font><font class="keyword">int </font>startId) {</p><p>		</font>Log.v(TAG, <font class="Fields">"onStart"</font>);</p><p>		<font class="keyword">if </font>(intent != </font><font class="keyword">null</font>) {</p><p>			Bundle bundle = intent.getExtras();</p><p>			<font class="keyword">if </font>(bundle != </font><font class="keyword">null</font>) {</p><p>				<font class="keyword">int </font>op = bundle.getInt(<font class="Fields">"op"</font>);</p><p>				<font class="keyword">switch </font>(op) {</p><p>				<font class="keyword">case </font>1:</p><p>					play();</p><p>					<font class="keyword">break</font>;</p><p>				<font class="keyword">case </font>2:</p><p>					stop();</p><p>					<font class="keyword">break</font>;</p><p>				<font class="keyword">case </font>3:</p><p>					pause();</p><p>					<font class="keyword">break</font>;</p><p>				}</p><p>			}</p><p>		}</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>play() {</p><p>		<font class="keyword">if </font>(!mediaPlayer.isPlaying()) {</p><p>			mediaPlayer.start();</p><p>		}</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>pause() {</p><p>		<font class="keyword">if </font>(mediaPlayer != </font><font class="keyword">null</font> && mediaPlayer.isPlaying()) {</p><p>			mediaPlayer.pause();</p><p>		}</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>stop() {</p><p>		<font class="keyword">if </font>(mediaPlayer != </font><font class="keyword">null</font>) {</p><p>			mediaPlayer.stop();</p><p>			<font class="keyword">try </font>{</p><p>				<font class="Comments">// 在调用stop后如果需要再次通过start进行播放,需要之前调用prepare函数</font></p><p>				mediaPlayer.prepare();</p><p>			</font>} <font class="keyword">catch </font>(IOException ex) {</p><p>				ex.printStackTrace();</p><p>			}</p><p>		}</p><p>	}</p><p>}</p><p></pre></p><p>服务使用了系统自带MediaPlayer进行音乐的播放控制。 当调用了startService后服务会先调用onCreate，我们在里面对MediaPlayer进行初始化。接着会调用onStart，可以看到传递给startService()的Intent对象会传递给onStart()方法，这样我们就可以得到intent里面的操作码： </p><p><pre>IBundle bundle = intent.getExtras();</p><p><font class="keyword">int </font>op = bundle.getInt(<font class="Fields">"op"</font>);</p><p></pre></p><p>然后更具定义好的操作码进行相应的f播放操作。启动后界面如下图：</p><p><img src="../img/component_service/11_service2.png"></p><p>图中的”close”和“exit”是不同的，close只是调用finish()退出当前的Activity，但是Service并没有关掉，音乐会继续播放。而exit就是调用了stopService(intent);来停止服务，Service会调用onDestroy()方法来对mediaPlayer进行停止和释放资源。</p><p>有时候如果服务只提供一些操作接口，我们也可以通过广播的g方式来启动服务。</p><p>首先要定义一个Receiver，并继承BroadcastReceiver，然后在AndroidManifest.xml中进行注册：</p><p><pre>&lt;receiver android:name=<font class="Fields">".MusicReceiver"</font>&gt;</p><p>	&lt;intent-filter&gt;</p><p>		</font>&lt;action android:name=<font class="Fields">"org.allin.android.musicReceiver"</font> /&gt;</p><p>	&lt;/intent-filter&gt;</p><p>&lt;/receiver&gt;</p><p></pre></p><p>Receiver的实现：</p><p>MusicReceiver.java</p><p><pre><font class="keyword">import </font>android.content.BroadcastReceiver;</p><p><font class="keyword">import </font>android.content.Context;</p><p><font class="keyword">import </font>android.content.Intent;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">public </font><font class="keyword">class </font>MusicReceiver </font><font class="keyword">extends </font>BroadcastReceiver {</p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>String TAG = <font class="Fields">"MusicReceiver"</font>;</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onReceive(Context context, Intent intent) {</p><p>		</font>Log.d(TAG, <font class="Fields">"onReceive"</font>);</p><p>		</font>Intent it = <font class="keyword">new </font>Intent(<font class="Fields">"org.androidmanual.musicService"</font>);</p><p>		Bundle bundle = intent.getExtras();</p><p>		it.putExtras(bundle);</p><p>		<font class="keyword">if </font>(bundle != </font><font class="keyword">null</font>) {</p><p>			<font class="keyword">int </font>op = bundle.getInt(<font class="Fields">"op"</font>);</p><p>			<font class="keyword">if </font>(op == 4) {</p><p>				context.stopService(it);</p><p>			</font>} <font class="keyword">else </font>{</p><p>				context.startService(it);</p><p>			}</p><p>		}</p><p>	}</p><p>}</p><p></pre></p><p>然后对PlayMusic中的onclick方法进行些改造，把Intent指向Receiver</p><p><pre>Intent intent = <font class="keyword">new </font>Intent(<font class="Fields">"org.allin.android.musicReceiver"</font>);</p><p></pre></p><p>intent中绑定的操作码都不变，再调用sendBroadcast(intent);把intentg广播出去。</p><p>当MusicReceiver接受到广播后根据操作码进行相应的操作。</p><p>接下来的例子就是使用bindService来启动Service</p><p>首先一样是写一个Activity</p><p><pre><font class="keyword">import </font>android.R;</p><p><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.content.ComponentName;</p><p><font class="keyword">import </font>android.content.Context;</p><p><font class="keyword">import </font>android.content.Intent;</p><p><font class="keyword">import </font>android.content.ServiceConnection;</p><p><font class="keyword">import </font>android.os.IBinder;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">import </font>android.view.View;</p><p><font class="keyword">import </font>android.view.View.OnClickListener;</p><p><font class="keyword">import </font>android.widget.Button;</p><p><font class="keyword">public </font><font class="keyword">class </font>PlayBindMusic </font><font class="keyword">extends </font>Activity </font><font class="keyword">implements </font>OnClickListener {</p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>String TAG = <font class="Fields">"PlayBindMusic"</font>;</p><p>	<font class="keyword">private </font>Button playBtn;</p><p>	<font class="keyword">private </font>Button stopBtn;</p><p>	<font class="keyword">private </font>Button pauseBtn;</p><p>	<font class="keyword">private </font>Button exitBtn;</p><p>	<font class="keyword">private </font>BindMusicService musicService;</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>		<font class="keyword">switch </font>(v.getId()) {</p><p>		<font class="keyword">case </font>R.id.play:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: binding srvice"</font>);</p><p>			musicService.play();</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.stop:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: stoping srvice"</font>);</p><p>			<font class="keyword">if </font>(musicService != </font><font class="keyword">null</font>) {</p><p>				musicService.stop();</p><p>			}</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.pause:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: pausing srvice"</font>);</p><p>			<font class="keyword">if </font>(musicService != </font><font class="keyword">null</font>) {</p><p>				musicService.pause();</p><p>			}</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.exit:</p><p>			</font>Log.d(TAG, <font class="Fields">"onClick: exit"</font>);</p><p>			<font class="keyword">this</font>.finish();</p><p>			<font class="keyword">break</font>;</p><p>		}</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>connection() {</p><p>		</font>Log.d(TAG, <font class="Fields">"connecting....."</font>);</p><p>		</font>Intent intent = <font class="keyword">new </font>Intent(<font class="Fields">"org.allin.android.bindService"</font>);</p><p>		bindService(intent, sc, Context.BIND_AUTO_CREATE);</p><p></p><p>	}</p><p>	<font class="keyword">private </font>ServiceConnection sc = </font><font class="keyword">new </font>ServiceConnection() {</p><p>		@Override</p><p>		<font class="keyword">public </font><font class="keyword">void </font>onServiceDisconnected(ComponentName name) {</p><p>			</font>musicService = <font class="keyword">null</font>;</p><p>			</font>Log.d(TAG, <font class="Fields">"in onServiceDisconnected"</font>);</p><p>		}</p><p>		@Override</p><p>		<font class="keyword">public </font><font class="keyword">void </font>onServiceConnected(ComponentName name, IBinder service) {</p><p>			musicService = ((BindMusicService.MyBinder) (service)).getService();</p><p>			<font class="keyword">if </font>(musicService != </font><font class="keyword">null</font>) {</p><p>				musicService.play();</p><p>			}</p><p>			</font>Log.d(TAG, <font class="Fields">"in onServiceConnected"</font>);</p><p>		}</p><p>	};</p><p>}</p><p></pre></p><p>在这里使用了bindService(intent,sc,Context.BIND_AUTO_CREATE);来启动服务的，我们需要定义ServiceConnectionnn，并实现里面的方法，当服务绑定成功后会调用ServiceConnectionnn中的回调函数：</p><p><pre>public void onServiceConnected(ComponentName name, IBinder service)</p><p></pre></p><p>回调函数里面使用</p><p><pre>musicService = ((BindMusicService.MyBinder)(service)).getService();</p><p></pre></p><p>来获取BindMusicService服务对象，有了BindMusicService实例对象，就可以调用服务提供的各种控制音乐播放的哦功能。</p><p>下面看看BindMusicService.java的实现：</p><p><pre><font class="keyword">import </font>java.io.IOException;</p><p><font class="keyword">import </font>android.R;</p><p><font class="keyword">import </font>android.app.Service;</p><p><font class="keyword">import </font>android.content.Intent;</p><p><font class="keyword">import </font>android.media.MediaPlayer;</p><p><font class="keyword">import </font>android.os.Binder;</p><p><font class="keyword">import </font>android.os.IBinder;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">import </font>android.widget.Toast;</p><p><font class="keyword">public </font><font class="keyword">class </font>BindMusicService </font><font class="keyword">extends </font>Service {</p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>String TAG = <font class="Fields">"MyService"</font>;</p><p>	<font class="keyword">private </font>MediaPlayer mediaPlayer;</p><p>	<font class="keyword">private </font><font class="keyword">final </font>IBinder binder = </font><font class="keyword">new </font>MyBinder();</p><p>	<font class="keyword">public </font><font class="keyword">class </font>MyBinder </font><font class="keyword">extends </font>Binder {</p><p>		BindMusicService getService() {</p><p>			<font class="keyword">return </font>BindMusicService.</font><font class="keyword">this</font>;</p><p>		}</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font>IBinder onBind(Intent intent) {</p><p>		</font>Log.d(TAG, <font class="Fields">"onBind"</font>);</p><p>		play();</p><p>		<font class="keyword">return </font>binder;</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate() {</p><p>		<font class="keyword">super</font>.onCreate();</p><p>		</font>Log.d(TAG, <font class="Fields">"onCreate"</font>);</p><p>		</font>Toast.makeText(<font class="keyword">this</font>, <font class="Fields">"show media player"</font>, Toast.LENGTH_SHORT).show();</p><p></p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onDestroy() {</p><p>		<font class="keyword">super</font>.onDestroy();</p><p>		</font>Log.d(TAG, <font class="Fields">"onDestroy"</font>);</p><p>		</font>Toast.makeText(<font class="keyword">this</font>, <font class="Fields">"stop media player"</font>, Toast.LENGTH_SHORT);</p><p>		<font class="keyword">if </font>(mediaPlayer != </font><font class="keyword">null</font>) {</p><p>			mediaPlayer.stop();</p><p>			mediaPlayer.release();</p><p>		}</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>play() {</p><p>		<font class="keyword">if </font>(mediaPlayer == </font><font class="keyword">null</font>) {</p><p>			</font>mediaPlayer = MediaPlayer.create(<font class="keyword">this</font>, R.raw.tmp);</p><p>			</font>mediaPlayer.setLooping(<font class="keyword">false</font>);</p><p>		}</p><p>		<font class="keyword">if </font>(!mediaPlayer.isPlaying()) {</p><p>			mediaPlayer.start();</p><p>		}</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>pause() {</p><p>		<font class="keyword">if </font>(mediaPlayer != </font><font class="keyword">null</font> && mediaPlayer.isPlaying()) {</p><p>			mediaPlayer.pause();</p><p>		}</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>stop() {</p><p>		<font class="keyword">if </font>(mediaPlayer != </font><font class="keyword">null</font>) {</p><p>			mediaPlayer.stop();</p><p>			<font class="keyword">try </font>{</p><p>				<font class="Comments">// 在调用stop后如果需要再次通过start进行播放,需要之前调用prepare函数</font></p><p>				mediaPlayer.prepare();</p><p>			</font>} <font class="keyword">catch </font>(IOException ex) {</p><p>				ex.printStackTrace();</p><p>			}</p><p>		}</p><p>	}</p><p>}</p><p></pre></p><p>我们看到Service中有个返回IBinder对象的onBind方法，这个方法会在Service被绑定到其他程序上时被调用，而这个IBinder对象和之前看到的onServiceConnected方法中传入的那个IBinder是同一个东西。应用和Service间就依靠这个IBinder对象进行通信。</p><p>启动后的界面如下图：</p><p><img src="../img/component_service/11_service3.png"></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

