
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>BroadcastReceiver生命周期及两种应用_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li class="navcurrentLink"><A href="index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="Activity" href="index_112.html">Activity</A></h2>

  <h2><A title="Intent" href="index_113.html">Intent</A></h2>

  <h2><A title="Service" href="index_114.html">Service</A></h2>

  <h2><A title="Content Provider" href="index_115.html">Content Provider</A></h2>

  <h2><A title="BroadcastReceiver" href="index_116.html">BroadcastReceiver</A></h2>
<UL><li ><A title=BroadcastReceiver简介 href="show_401_116.html">BroadcastReceiver简介</A> </li><li ><A title=BroadcastReceiver学习 href="show_402_116.html">BroadcastReceiver学习</A> </li><li class="currentLink"><A title=BroadcastReceiver生命周期及两种应用 href="show_403_116.html">BroadcastReceiver生命周期及两种应用</A> </li><li ><A title=Android中BroadCastReceiver使用 href="show_404_116.html">Android中BroadCastReceiver使用</A> </li><li ><A title=BroadcastReceiver 消息广播详解-简单监控拨打电话 href="show_405_116.html">BroadcastReceiver 消息广播详解-简单监控拨打电话</A> </li><li ><A title=通过BroadcastReceiver拦截短信 href="show_406_116.html">通过BroadcastReceiver拦截短信</A> </li></UL>
  <h2><A title="AsyncTask" href="index_117.html">AsyncTask</A></h2>

  <h2><A title="Handler" href="index_118.html">Handler</A></h2>

  <h2><A title="Thread" href="index_119.html">Thread</A></h2>

  <h2><A title="Permission" href="index_120.html">Permission</A></h2>

  <h2><A title="AIDL" href="index_121.html">AIDL</A></h2>

  <h2><A title="Json" href="index_122.html">Json</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>BroadcastReceiver生命周期及两种应用</H2>
<div style="line-height:20px; font-size:14px;"><p>一：Android 广播的生命周期  </p><p>一个广播接收者有一个回调方法：void onReceive(Context curContext, Intent broadcastMsg)。当一个广播消息到达接收者时，Android调用它的onReceive()方法并传递给它包含消息的Intent对象。广播接收者被认为仅当它执行这个方法时是活跃的。当onReceive()返回后，它是不活跃的。 </p><p>有一个活跃的广播接收者的进程是受保护的，不会被杀死。但是系统可以在任何时候杀死仅有不活跃组件的进程，当占用的内存别的进程需要时。 </p><p>这带来一个问题，当一个广播消息的响应时费时的，因此应该在独立的线程中做这些事，远离用户界面其它组件运行的主线程。如果onReceive()衍生线程然后返回，整个进程，包括新的线程，被判定为不活跃的（除非进程中的其它应用程序组件是活跃的），将使它处于被杀的危机。解决这个问题的方法是onReceive()启动一个服务，及时服务做这个工作，因此系统知道进程中有活跃的工作在做。</p><p>Broadcast Receive为广播接收器，它和事件处理机制类似，只不过事件的处理机制是程序组件级别的，广播处理机制是系统级别的。 </p><p>Broadcast Receiver用于接收并处理广播通知（broadcast announcements）。多数的广播是系统发起的，如地域变换、电量不足、来电来信等。程序也可以播放一个广播。程序可以有任意数量的 broadcast receivers来响应它觉得重要的通知。broadcast receiver可以通过多种方式通知用户：启动activity、使用NotificationManager、开启背景灯、振动设备、播放声音等，最典型的是在状态栏显示一个图标，这样用户就可以点它打开看通知内容。 </p><p>通常我们的某个应用或系统本身在某些事件（电池电量不足、来电来短信）来临时会广播一个Intent出去，我们可以利用注册一个Broadcast Receiver来监听到这些Intent并获取Intent中的数据。</p><p>二：Android 广播应用 </p><p>android中，不同进程之间传递信息要用到广播，可以有两种方式来实现。</p><p>第一种方式：在Manifest.xml中注册广播，是一种比较推荐的方法，因为它不需要手动注销广播（如果广播未注销，程序退出时可能会出错）。 </p><p>具体实现在Manifest的application中添加：</p><p><pre>&lt;receiver android:name=<font class="Fields">".mEvtReceiver"</font>&gt; </p><p>	&lt;intent-filter&gt;</p><p>		</font>&lt;action android:name=<font class="Fields">"android.intent.action.BOOT_COMPLETED"</font> /&gt;</p><p>	&lt;/intent-filter&gt;</p><p>&lt;/receiver&gt; </p><p></pre></p><p>上面两个android:name分别是广播名和广播的动作（这里的动作是表示系统启动完成），如果要自己发送一个广播，在代码中为：<pre>Intent i = <font class="keyword">new </font>Intent(<font class="Fields">"android.intent.action.BOOT_COMPLETED"</font>); </p><p>sendBroadcast(i);</p><p></pre></p><p>这样，广播就发出去了，然后是接收。接收可以新建一个类，继承至BroadcastReceiver，也可以建一个BroadcastReceiver的实例，然后得写onReceive方法，实现如下：</p><p><pre><font class="keyword">protected </font>BroadcastReceiver mEvtReceiver = </font><font class="keyword">new </font>BroadcastReceiver() {</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onReceive(Context context, Intent intent) {</p><p>		String action = intent.getAction();</p><p>		<font class="keyword">if </font>(action.equals(<font class="Fields">"android.intent.action.BOOT_COMPLETED"</font>)) {</p><p>			<font class="Comments">// Do something</font></p><p>		}</p><p>	}</p><p>}; </p><p></pre></p><p>完整实例：</p><p><pre> </p><p>&lt;?xml version=<font class="Fields">"1.0"</font> encoding=</font><font class="Fields">"utf-8"</font>?&gt; </p><p>&lt;manifest xmlns:android=<font class="Fields">"http:<font class="Comments">//schemas.android.com/apk/res/android"</font> </font></p><p>	</font>package=<font class="Fields">"android.basic.lesson21"</font></p><p>	</font>android:versionCode=<font class="Fields">"1"</font></p><p>	</font>android:versionName=<font class="Fields">"1.0"</font>&gt;</p><p>	</font>&lt;uses-sdk android:minSdkVersion=<font class="Fields">"8"</font> /&gt;</p><p>	</font>&lt;application android:icon=<font class="Fields">"@drawable/icon"</font> android:label=</font><font class="Fields">"@string/app_name"</font>&gt;</p><p>	</font>&lt;activity android:name=<font class="Fields">".MainBroadcastReceiver"</font></p><p>		</font>android:label=<font class="Fields">"@string/app_name"</font>&gt;</p><p>		&lt;intent-filter&gt;</p><p>			</font>&lt;action android:name=<font class="Fields">"android.intent.action.MAIN"</font> /&gt;</p><p>			</font>&lt;category android:name=<font class="Fields">"android.intent.category.LAUNCHER"</font> /&gt;</p><p>		&lt;/intent-filter&gt;</p><p>	&lt;/activity&gt;</p><p>	</font>&lt;receiver android:name=<font class="Fields">".HelloBroadReciever"</font>&gt;</p><p>		&lt;intent-filter&gt;</p><p>			</font>&lt;action android:name=<font class="Fields">"android.basic.lesson21.Hello88"</font> /&gt;</p><p>		&lt;/intent-filter&gt;</p><p>	&lt;/receiver&gt;</p><p>	&lt;/application&gt;</p><p>&lt;/manifest&gt; </p><p><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.content.Intent;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.view.View;</p><p><font class="keyword">import </font>android.widget.Button;</p><p><font class="keyword">public </font><font class="keyword">class </font>MainBroadcastReceiver </font><font class="keyword">extends </font>Activity {</p><p>	<font class="Comments">/** Called when the activity is first created. */</font></p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate(Bundle savedInstanceState) {</p><p>		<font class="keyword">super</font>.onCreate(savedInstanceState);</p><p>		setContentView(R.layout.main);</p><p>		Button b1 = (Button) findViewById(R.id.Button01);</p><p>		</font>b1.setOnClickListener(<font class="keyword">new </font>View.OnClickListener() {</p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>				<font class="Comments">// 定义一个intent</font></p><p>				</font>Intent intent = <font class="keyword">new </font>Intent().setAction(</p><p>						<font class="Fields">"android.basic.lesson21.Hello88"</font>).putExtra(</font><font class="Fields">"yaoyao"</font>,</p><p>						<font class="Fields">"yaoyao is 189 days old ,27 weeks -- 2010-08-10"</font>);</p><p>				</font>System.<font class="Fields">out</font>.println(</font><font class="Fields">"sendBroadcast"</font>);</p><p>				<font class="Comments">// 广播出去</font></p><p>				sendBroadcast(intent);</p><p>			}</p><p>		});</p><p>	}</p><p>}</p><p><font class="keyword">import </font>android.content.BroadcastReceiver;</p><p><font class="keyword">import </font>android.content.Context;</p><p><font class="keyword">import </font>android.content.Intent;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">public </font><font class="keyword">class </font>HelloBroadReciever </font><font class="keyword">extends </font>BroadcastReceiver {</p><p>	<font class="keyword">public </font>HelloBroadReciever() {</p><p>		</font>System.<font class="Fields">out</font>.println(</font><font class="Fields">"HelloBroadReciever"</font>);</p><p>	}</p><p>	<font class="Comments">// 如果接收的事件发生</font></p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onReceive(Context context, Intent intent) {</p><p>		<font class="Comments">// 对比Action决定输出什么信息</font></p><p>		<font class="keyword">if </font>(intent.getAction().equals(<font class="Fields">"android.intent.action.BOOT_COMPLETED"</font>)) {</p><p>			</font>Log.i(<font class="Fields">"HelloBroadReciever"</font>,</p><p>					<font class="Fields">"BOOT_COMPLETED !!!!!!!!!!!!!!!!!!!!!!!!!"</font>);</p><p>		}</p><p>		<font class="keyword">if </font>(intent.getAction().equals(<font class="Fields">"android.basic.lesson21.Hello88"</font>)) {</p><p>			</font>Log.i(<font class="Fields">"HelloBroadReciever"</font>,</p><p>					<font class="Fields">"Say Hello to Yaoyao !!!!!!!!!!!!!!!!!!!!!!!!!"</font>);</p><p>			</font>Log.i(<font class="Fields">"HelloBroadReciever"</font>, intent.getStringExtra(</font><font class="Fields">"yaoyao"</font>));</p><p>		}</p><p>		</font>Log.i(<font class="Fields">"HelloBroadReciever"</font>, </font><font class="Fields">"onReceive**********"</font>);</p><p>		<font class="Comments">// 播放一首音乐</font></p><p>		<font class="Comments">// MediaPlayer.create(context, R.raw.babayetu).start();</font></p><p>	}</p><p>}</p><p></pre></p><p>第二种方式，直接在代码中实现，但需要手动注册注销，实现如下：（以短信接收为例） </p><p><pre>IntentFilter filter = new IntentFilter(); </p><p>filter.addAction("android.provider.Telephony.SMS_RECEIVED"); </p><p></pre></p><p>registerReceiver(mEvtReceiver, filter); //这时注册了一个recevier，名为mEvtReceiver，然后同样用上面的方法以重写onReceiver </p><p>最后在程序的onDestroy中要注销广播，实现如下： </p><p><pre>@Override</p><p><font class="keyword">public </font><font class="keyword">void </font>onDestroy() {</p><p>	<font class="keyword">super</font>.onDestroy();</p><p>	unregisterReceiver(mPlayerEvtReceiver);</p><p>}</p><p></pre></p><p>以短信接收为例： </p><p><pre>&lt;?xml version=<font class="Fields">"1.0"</font> encoding=</font><font class="Fields">"utf-8"</font>?&gt; </p><p>&lt;manifest xmlns:android=<font class="Fields">"http:<font class="Comments">//schemas.android.com/apk/res/android"</font> </font></p><p>	</font>package=<font class="Fields">"android.basic.lesson21"</font></p><p>	</font>android:versionCode=<font class="Fields">"1"</font></p><p>	</font>android:versionName=<font class="Fields">"1.0"</font>&gt;</p><p>	</font>&lt;uses-sdk android:minSdkVersion=<font class="Fields">"5"</font> /&gt;</p><p>	</font>&lt;application android:icon=<font class="Fields">"@drawable/icon"</font> android:label=</font><font class="Fields">"@string/app_name"</font>&gt;</p><p>	</font>&lt;activity android:name=<font class="Fields">".MainBroadcastReceiver"</font></p><p>		</font>android:label=<font class="Fields">"@string/app_name"</font>&gt;</p><p>		&lt;intent-filter&gt;</p><p>			</font>&lt;action android:name=<font class="Fields">"android.intent.action.MAIN"</font> /&gt;</p><p>			</font>&lt;category android:name=<font class="Fields">"android.intent.category.LAUNCHER"</font> /&gt;</p><p>		&lt;/intent-filter&gt;</p><p>	&lt;/activity&gt;</p><p>	&lt;/application&gt;</p><p>	</font>&lt;uses-permission android:name=<font class="Fields">"android.permission.RECEIVE_SMS"</font>/&gt;</p><p>&lt;/manifest&gt;</p><p></pre></p><p>增加一个短信权限&lt;uses-permission android:name="android.permission.RECEIVE_SMS"/&gt; </p><p><pre><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.content.IntentFilter;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">import </font>android.view.View;</p><p><font class="keyword">import </font>android.widget.Button;</p><p><font class="keyword">public </font><font class="keyword">class </font>MainBroadcastReceiver </font><font class="keyword">extends </font>Activity {</p><p>	<font class="Comments">/** Called when the activity is first created. */</font></p><p>	HelloBroadReciever br;</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate(Bundle savedInstanceState) {</p><p>		<font class="keyword">super</font>.onCreate(savedInstanceState);</p><p>		setContentView(R.layout.main);</p><p>		Button b1 = (Button) findViewById(R.id.Button01);</p><p>		</font>b1.setOnClickListener(<font class="keyword">new </font>View.OnClickListener() {</p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>				</font>Log.i(<font class="Fields">"click"</font>, </font><font class="Fields">"OnClick"</font>);</p><p>				</font>br = <font class="keyword">new </font>HelloBroadReciever();</p><p>				</font>IntentFilter filter = <font class="keyword">new </font>IntentFilter();</p><p>				</font>filter.addAction(<font class="Fields">"android.provider.Telephony.SMS_RECEIVED"</font>);</p><p>				registerReceiver(br, filter);</p><p>			}</p><p>		});</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onDestroy() {</p><p>		<font class="keyword">super</font>.onDestroy();</p><p>		unregisterReceiver(br);</p><p>		</font>Log.i(<font class="Fields">"br"</font>, </font><font class="Fields">"onDestroy"</font>);</p><p>	}</p><p>}</p><p><font class="keyword">import </font>android.content.BroadcastReceiver;</p><p><font class="keyword">import </font>android.content.Context;</p><p><font class="keyword">import </font>android.content.Intent;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">public </font><font class="keyword">class </font>HelloBroadReciever </font><font class="keyword">extends </font>BroadcastReceiver {</p><p>	<font class="keyword">public </font>HelloBroadReciever() {</p><p>		</font>System.<font class="Fields">out</font>.println(</font><font class="Fields">"HelloBroadReciever"</font>);</p><p>	}</p><p>	<font class="Comments">// 如果接收的事件发生</font></p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onReceive(Context context, Intent intent) {</p><p>		<font class="Comments">// 对比Action决定输出什么信息</font></p><p>		<font class="keyword">if </font>(intent.getAction()</p><p>				</font>.equals(<font class="Fields">"android.provider.Telephony.SMS_RECEIVED"</font>)) {</p><p>			</font>Log.i(<font class="Fields">"HelloBroadReciever"</font>,</p><p>					<font class="Fields">"SMS_RECEIVED !!!!!!!!!!!!!!!!!!!!!!!!!"</font>);</p><p>		}</p><p>		</font>Log.i(<font class="Fields">"HelloBroadReciever"</font>, </font><font class="Fields">"onReceive**********"</font>);</p><p>	}</p><p>}</p><p></pre></p><p>先按开始键注册广播，然后在Emulator Control设置发短信如图： </p><p><pre>按Send,这时HelloBroadReciever的onReceive响应 </p><p>输出SMS_RECEIVED !!!!!!!!!!!!!!!!!!!!!!!!! </p><p>onReceive**********"信息。</p><p></pre> </p><p>一个广播接收者有一个回调方法：void onReceive(Context curContext, Intent broadcastMsg)。当一个广播消息到达接收者是，Android调用它的onReceive()方法并传递给它包含消息的Intent对象。广播接收者被认为仅当它执行这个方法时是活跃的。当onReceive()返回后，它是不活跃的。 </p><p>有一个活跃的广播接收者的进程是受保护的，不会被杀死。但是系统可以在任何时候杀死仅有不活跃组件的进程，当占用的内存别的进程需要时。 </p><p>这带来一个问题，当一个广播消息的响应时费时的，因此应该在独立的线程中做这些事，远离用户界面其它组件运行的主线程。如果onReceive()衍生线程然后返回，整个进程，包括新的线程，被判定为不活跃的（除非进程中的其它应用程序组件是活跃的），将使它处于被杀的危机。解决这个问题的方法是onReceive()启动一个服务，及时服务做这个工作，因此系统知道进程中有活跃的工作在做。</p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

