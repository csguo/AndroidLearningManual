
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android教程之SQlite数据库操作_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li class="navcurrentLink"><A href="index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="ContentProvider" href="index_170.html">ContentProvider</A></h2>

  <h2><A title="Preferences" href="index_171.html">Preferences</A></h2>

  <h2><A title="SQLite" href="index_172.html">SQLite</A></h2>

  <h2><A title="SD卡" href="index_173.html">SD卡</A></h2>

  <h2><A title="数据库" href="index_174.html">数据库</A></h2>
<UL><li ><A title=Android 数据存取之Databases href="show_401_174.html">Android 数据存取之Databases</A> </li><li class="currentLink"><A title=Android教程之SQlite数据库操作 href="show_402_174.html">Android教程之SQlite数据库操作</A> </li><li ><A title=Android 数据库一次创建多个表（一） href="show_403_174.html">Android 数据库一次创建多个表（一）</A> </li><li ><A title=Android 数据库一次创建多个表（二） href="show_404_174.html">Android 数据库一次创建多个表（二）</A> </li><li ><A title=Android 数据库经验总结 href="show_405_174.html">Android 数据库经验总结</A> </li><li ><A title=创建数据库的时候就将数据库保存到SDcard href="show_406_174.html">创建数据库的时候就将数据库保存到SDcard</A> </li><li ><A title=Android保存图片到数据库 href="show_407_174.html">Android保存图片到数据库</A> </li><li ><A title=Android中访问已有的SQLite数据库 href="show_408_174.html">Android中访问已有的SQLite数据库</A> </li><li ><A title=关于Android SQLite database存储到sdcard上的问题 href="show_409_174.html">关于Android SQLite database存储到sdcard上的问题</A> </li></UL>
  <h2><A title="URI" href="index_175.html">URI</A></h2>

  <h2><A title="MediaStore" href="index_176.html">MediaStore</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android教程之SQlite数据库操作</H2>
<div style="line-height:20px; font-size:14px;"><p>SQlite API:</p><p>android.database.sqlite.SQLiteOpenHelper</p><p>public SQLiteOpenHelper(Context context, String name, SQLiteDatabase.CursorFactory factory, int version)  </p><p>Create a helper object to create, open, and/or manage a database. </p><p>The database is not actually created or opened until one of getWritableDatabase() or getReadableDatabase() is called.</p><p>直到调用getWritableDatabase()函数或者getReadableDatabase()时才会创建或者打开数据库。（如果数据库没有创建，那么会先创建数据库）</p><p>Parameters  </p><p>context	to use to open or create the database</p><p>name	of the database file, or null for an in-memory database</p><p>factory	to use for creating cursor objects, or null for the default</p><p>version	number of the database (starting at 1); if the database is older, onUpgrade(SQLiteDatabase, int, int) will be used to upgrade the database</p><p>A helper class to manage database creation and version management. </p><p>SQLiteOpenHelper类是管理数据库生成和数据库版本建立的辅助类。</p><p>You create a subclass implementing onCreate(SQLiteDatabase), onUpgrade(SQLiteDatabase, int, int) and optionally onOpen(SQLiteDatabase), and this class takes care of opening the database if it exists, creating it if it does not, and upgrading it as necessary. Transactions are used to make sure the database is always in a sensible state</p><p>SQLiteOpenHelper，如果这个数据库存在，那么SQLiteOpenHelper负责管理数据库。</p><p>如果数据库不存在，那么SQLiteOpenHelper会建立一个数据库。</p><p>如果需要的话，升级数据库。</p><p><pre><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>String DB_NAME = <font class="Fields">"CartDB.db"</font>;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>DB_VERSION = 2;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>String TABLE_NAME_1 = <font class="Fields">"MyOrder"</font>;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>String TABLE_NAME_2 = <font class="Fields">"OrderLine"</font>;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">class </font>DatabaseHelper </font><font class="keyword">extends </font>SQLiteOpenHelper {</p><p>	DatabaseHelper(Context context) {</p><p>		<font class="keyword">super</font>(context, DB_NAME, </font><font class="keyword">null</font>, DB_VERSION);</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate(SQLiteDatabase db) {</p><p>		</font>db.execSQL(<font class="Fields">"CREATE TABLE "</font> + TABLE_NAME_1 + </font><font class="Fields">" ("</font> + </font><font class="Fields">"order_no</p><p>				</font>+ <font class="Fields">" text not <font class="keyword">null</font>, "</font> + </font><font class="Fields">"type"</font> + </font><font class="Fields">" text not </font><font class="keyword">null</font>, "</font> + </font><font class="Fields">"desc</p><p>				</font>+ <font class="Fields">" text"</font> + </font><font class="Fields">");"</font>);</p><p>		</font>db.execSQL(<font class="Fields">"CREATE TABLE "</font> + TABLE_NAME_2 + </font><font class="Fields">" ("</font> + </font><font class="Fields">"order_no</p><p>				</font>+ <font class="Fields">" text not <font class="keyword">null</font>, "</font> + </font><font class="Fields">"item_no"</font> + </font><font class="Fields">" text not </font><font class="keyword">null</font>, "</font> + </font><font class="Fields">"QTY</p><p>				</font>+ <font class="Fields">" text"</font> + </font><font class="Fields">");"</font>);</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onUpgrade(SQLiteDatabase db, </font><font class="keyword">int </font>oldVersion, </font><font class="keyword">int </font>newVersion) {</p><p>	}</p><p>}</p><p></pre></p><p>1.首先得新建数据库的代理类，通过这个类得到具体数据库的代理类。</p><p><pre>mOpenHelper = new DatabaseHelper(this);</p><p></pre></p><p>这个DatabaseHelper是继承SQLiteOpenHelper</p><p>SQLiteDatabase db = mOpenHelper.getWritableDatabase();</p><p>2.由于操作的是SQLiteDatabase数据，故得到一个SQLiteDatabase类，这个类里边的方法可以对数据库进行具体的操作。</p><p>建立数据库：</p><p><pre></font>mOpenHelper = <font class="keyword">new </font>DatabaseHelper(v.getContext());</p><p>SQLiteDatabase db = mOpenHelper.getWritableDatabase();</p><p></font>String sql = <font class="Fields">"create table Student("</font> + </font><font class="Fields">"stud_no text not <font class="keyword">null</font>,</p><p>		</font>+ <font class="Fields">"stud_name text );"</font>;</p><p><font class="keyword">try </font>{</p><p>	db.execSQL(sql);</p><p>	</font>setTitle(<font class="Fields">"create table ok!"</font>);</p><p></font>} <font class="keyword">catch </font>(SQLException e) {</p><p>	</font>Log.e(<font class="Fields">"ERROR"</font>, e.toString());</p><p>	</font>setTitle(<font class="Fields">"create table Error!"</font>);</p><p>}</p><p></pre></p><p>drop数据库：</p><p><pre></font>mOpenHelper = <font class="keyword">new </font>DatabaseHelper(v.getContext());</p><p>SQLiteDatabase db = mOpenHelper.getWritableDatabase();</p><p></font>String sql = <font class="Fields">"drop table Student"</font>;</p><p><font class="keyword">try </font>{</p><p>	db.execSQL(sql);</p><p>	</font>setTitle(<font class="Fields">"drop table ok!"</font>);</p><p></font>} <font class="keyword">catch </font>(SQLException e) {</p><p>	</font>Log.e(<font class="Fields">"ERROR"</font>, e.toString());</p><p>	</font>setTitle(<font class="Fields">"drop table Error!"</font>);</p><p>}</p><p></pre></p><p>插入语句：</p><p>采用sql语句进行插入：</p><p><pre></font>mOpenHelper = <font class="keyword">new </font>DatabaseHelper(v.getContext());</p><p>SQLiteDatabase db = mOpenHelper.getWritableDatabase();</p><p></font>String sql_1 = <font class="Fields">"insert into Student (stud_no, stud_name) values(</font><font class="Fields">'S108'</font>, </font><font class="Fields">'Lily Chen'</font>);"</font>;</p><p></font>String sql_2 = <font class="Fields">"insert into Student (stud_no, stud_name) values(</font><font class="Fields">'S201'</font>, </font><font class="Fields">'Tom Kao'</font>);"</font>;</p><p></font>String sql_3 = <font class="Fields">"insert into Student (stud_no, stud_name) values(</font><font class="Fields">'S333'</font>, </font><font class="Fields">'Peter Rabbit'</font>);"</font>;</p><p><font class="keyword">try </font>{</p><p>	db.execSQL(sql_1);</p><p>	db.execSQL(sql_2);</p><p>	db.execSQL(sql_3);</p><p>	</font>setTitle(<font class="Fields">"insert records ok!"</font>);</p><p></font>} <font class="keyword">catch </font>(SQLException e) {</p><p>	</font>Log.e(<font class="Fields">"ERROR"</font>, e.toString());</p><p>}</p><p></pre></p><p>采用第二种方便的方法进行插入：（采用contentValues的方法）</p><p><pre></font>mOpenHelper = <font class="keyword">new </font>DatabaseHelper(v.getContext());</p><p>SQLiteDatabase db = mOpenHelper.getWritableDatabase();</p><p></font>ContentValues cv = <font class="keyword">new </font>ContentValues();</p><p></font>cv.put(<font class="Fields">"stud_no"</font>, </font><font class="Fields">"S108"</font>);</p><p></font>cv.put(<font class="Fields">"stud_name"</font>, </font><font class="Fields">"Lily Chen"</font>);</p><p></font>db.insert(<font class="Fields">"Student"</font>, <font class="keyword">null</font>, cv);</p><p></font>cv = <font class="keyword">new </font>ContentValues();</p><p></font>cv.put(<font class="Fields">"stud_no"</font>, </font><font class="Fields">"S201"</font>);</p><p></font>cv.put(<font class="Fields">"stud_name"</font>, </font><font class="Fields">"Tom Kao"</font>);</p><p></font>db.insert(<font class="Fields">"Student"</font>, <font class="keyword">null</font>, cv);</p><p></font>cv = <font class="keyword">new </font>ContentValues();</p><p></font>cv.put(<font class="Fields">"stud_no"</font>, </font><font class="Fields">"S333"</font>);</p><p></font>cv.put(<font class="Fields">"stud_name"</font>, </font><font class="Fields">"Peter Rabbit"</font>);</p><p></font>db.insert(<font class="Fields">"Student"</font>, <font class="keyword">null</font>, cv);</p><p></font>setTitle(<font class="Fields">"insert record ok!"</font>);</p><p></pre></p><p>查询语句：</p><p><pre></font>mOpenHelper = <font class="keyword">new </font>DatabaseHelper(v.getContext());</p><p>SQLiteDatabase db = mOpenHelper.getReadableDatabase();</p><p></font>String col[] = { <font class="Fields">"stud_no"</font>, </font><font class="Fields">"stud_name"</font> </font>};</p><p></font>cur = db.query(<font class="Fields">"Student"</font>, col, <font class="keyword">null</font>, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>);</p><p>Integer n = cur.getCount();</p><p>String ss = Integer.toString(n);</p><p></font>setTitle(ss + <font class="Fields">" records"</font>);</p><p></pre></p><p>cur.moveToFirst();</p><p>public Cursor query(String table, String[] columns, String selection, String[] selectionArgs, String groupBy, String having, String orderBy)</p><p>selection：  A filter declaring which rows to return, formatted as an SQL WHERE clause (excluding the WHERE itself). Passing null will return all rows for the given table.</p><p>selectionArgs:You may include ?s in selection, which will be replaced by the values from selectionArgs, in order that they appear in the selection. The values will be bound as Strings.</p><p>如何不断循环的取出下一条打印出来：</p><p>查询语句返回的是一个Cursor cur = db.query("MyOrder", col, cond, null, null, null,null);</p><p>第一个参数为数据表的名字，第二个参数为一个String[],里边是数据列的名字，第三个是查询条件。翻译的SQL语句为：//SELECT order_no, type FROM MyOrder WHERE type='NEW'。</p><p>得到查询出来数据的个数。Integer n = cur.getCount();</p><p>如果想从头遍历的话：cur.moveToFirst();</p><p>如果想遍历完的话可以这么做：</p><p><pre><font class="keyword">while </font>(!cur.isAfterLast()) {</p><p>	</font>String ss = cur.getString(0) + <font class="Fields">", "</font> + cur.getString(1);</p><p>	data[k++] = ss;</p><p>	cur.moveToNext();</p><p>}</p><p><font class="keyword">public </font>String getString(</font><font class="keyword">int </font>columnIndex) {</p><p>}</p><p></pre></p><p>对于当前条处理完了，想进入下一条目。moveToNext()；</p><p><pre><font class="keyword">public </font>String[] loadData() {</p><p>	</font>SharedPreferences passwdfile = m_ctx.getSharedPreferences(<font class="Fields">"CONDITION"</font>,</p><p>			0);</p><p>	</font>String cond = passwdfile.getString(<font class="Fields">"CONDITION"</font>, <font class="keyword">null</font>);</p><p>	</font>mOpenHelper = <font class="keyword">new </font>DatabaseHelper(m_ctx);</p><p>	SQLiteDatabase db = mOpenHelper.getReadableDatabase();</p><p>	</font>String col[] = { <font class="Fields">"order_no"</font>, </font><font class="Fields">"type"</font> </font>};</p><p>	</font>Cursor cur = db.query(<font class="Fields">"MyOrder"</font>, col, cond, <font class="keyword">null</font>, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>);</p><p>	<font class="Comments">// SELECT order_no, type FROM MyOrder WHERE type='NEW'</font></p><p>	Integer n = cur.getCount();</p><p>	</font>String[] data = <font class="keyword">new </font>String[n];</p><p>	cur.moveToFirst();</p><p>	<font class="keyword">int </font>k = 0;</p><p>	<font class="keyword">while </font>(!cur.isAfterLast()) {</p><p>		</font>String ss = cur.getString(0) + <font class="Fields">", "</font> + cur.getString(1);</p><p>		data[k++] = ss;</p><p>		cur.moveToNext();</p><p>	}</p><p>	<font class="keyword">return </font>data;</p><p>}</p><p></pre></p><p>更新：</p><p><pre><font class="Comments">// 更新条列</font></p><p>SQLiteDatabase db = mOpenHelper.getWritableDatabase();</p><p></font>ContentValues cv = <font class="keyword">new </font>ContentValues();</p><p></font>cv.put(<font class="Fields">"stud_no"</font>, </font><font class="Fields">"S288"</font>);</p><p></font>cv.put(<font class="Fields">"stud_name"</font>, </font><font class="Fields">"Linda Wang"</font>);</p><p></font>db.update(<font class="Fields">"Student"</font>, cv, </font><font class="Fields">"stud_no = </font><font class="Fields">'S201'</font>"</font>, <font class="keyword">null</font>);</p><p></pre></p><p>删除：</p><p><pre><font class="Comments">// 删除条列</font></p><p></font>mOpenHelper = <font class="keyword">new </font>DatabaseHelper(v.getContext());</p><p>SQLiteDatabase db = mOpenHelper.getWritableDatabase();</p><p></font>db.delete(<font class="Fields">"Student"</font>, </font><font class="Fields">"stud_no = </font><font class="Fields">'S108'</font>"</font>, <font class="keyword">null</font>);</p><p></pre></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

