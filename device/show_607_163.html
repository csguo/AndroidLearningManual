
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android GPS，WIFI，基站定位集合_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li class="navcurrentLink"><A href="index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="设备信息" href="index_157.html">设备信息</A></h2>

  <h2><A title="摄像头" href="index_158.html">摄像头</A></h2>

  <h2><A title="通讯录" href="index_159.html">通讯录</A></h2>

  <h2><A title="电话" href="index_160.html">电话</A></h2>

  <h2><A title="短信" href="index_161.html">短信</A></h2>

  <h2><A title="传感器" href="index_162.html">传感器</A></h2>

  <h2><A title="定位" href="index_163.html">定位</A></h2>
<UL><li ><A title=Android 实现GPS定位（一） href="show_601_163.html">Android 实现GPS定位（一）</A> </li><li ><A title=Android 实现GPS定位（二） href="show_602_163.html">Android 实现GPS定位（二）</A> </li><li ><A title=Android GPS定位 href="show_603_163.html">Android GPS定位</A> </li><li ><A title=Android wifi实现定位（一） href="show_604_163.html">Android wifi实现定位（一）</A> </li><li ><A title=Android wifi实现定位（二） href="show_605_163.html">Android wifi实现定位（二）</A> </li><li ><A title=Android 基站定位源代码 href="show_606_163.html">Android 基站定位源代码</A> </li><li class="currentLink"><A title=Android GPS，WIFI，基站定位集合 href="show_607_163.html">Android GPS，WIFI，基站定位集合</A> </li><li ><A title=Android 使用地图 href="show_608_163.html">Android 使用地图</A> </li><li ><A title=Android 显示查询结果（一） href="show_609_163.html">Android 显示查询结果（一）</A> </li><li ><A title=Android 显示查询结果（二） href="show_610_163.html">Android 显示查询结果（二）</A> </li><li ><A title=Google地图经纬度转换成具体位置 href="show_611_163.html">Google地图经纬度转换成具体位置</A> </li></UL>
  <h2><A title="视频系统" href="index_164.html">视频系统</A></h2>

  <h2><A title="音频系统" href="index_165.html">音频系统</A></h2>

  <h2><A title="铃声" href="index_166.html">铃声</A></h2>

  <h2><A title="音量" href="index_167.html">音量</A></h2>

  <h2><A title="录音" href="index_168.html">录音</A></h2>

  <h2><A title="输入法" href="index_169.html">输入法</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android GPS，WIFI，基站定位集合</H2>
<div style="line-height:20px; font-size:14px;"><p>集合了gps、wifi、基站定位。</p><p>其中GPS定位首先是GpsTask类异步返回GPS经纬度信息</p><p><pre><font class="keyword">this</font>.context = context;</p><p></font>GpsTask gpstask = <font class="keyword">new </font>GpsTask(GpsActivity.</font><font class="keyword">this</font>, </font><font class="keyword">new </font>GpsTaskCallBack() {</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>gpsConnectedTimeOut() {</p><p>		</font>gps_tip.setText(<font class="Fields">"获取GPS超时了"</font>);</p><p>	}</p><p></p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>gpsConnected(GpsData gpsdata) {</p><p>		do_gps(gpsdata);</p><p>	}</p><p>}, 3000);</p><p>gpstask.execute();</p><p></pre></p><p>其中3000是设置获取gps数据timeout时间。GpsTask是根据</p><p><pre>locationManager.getLastKnownLocation(LocationManager.NETWORK_PROVIDER);</p><p></pre></p><p>获取最后一次GPS信息，如果返回为Null则是根据监听获取Location信息发生改变时返回的GPS信息。因为手机获取GPS信息时间比较长，所以这个类实际使用时可能还存在一些BUG。</p><p>IAddressTask封装了获取地理位置的方法，具体代码如下：</p><p><pre><font class="keyword">import </font>java.io.BufferedReader;</p><p><font class="keyword">import </font>java.io.InputStreamReader;</p><p><font class="keyword">import </font>org.apache.http.HttpEntity;</p><p><font class="keyword">import </font>org.apache.http.HttpResponse;</p><p><font class="keyword">import </font>org.json.JSONArray;</p><p><font class="keyword">import </font>org.json.JSONObject;</p><p><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.content.Context;</p><p><font class="keyword">import </font>android.net.wifi.WifiManager;</p><p><font class="keyword">import </font>android.telephony.TelephonyManager;</p><p><font class="keyword">import </font>android.telephony.gsm.GsmCellLocation;</p><p><font class="keyword">public </font><font class="keyword">abstract </font><font class="keyword">class </font>IAddressTask {</p><p>	<font class="keyword">protected </font>Activity context;</p><p>	<font class="keyword">public </font>IAddressTask(Activity context) {</p><p>		<font class="keyword">this</font>.context = context;</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">abstract </font>HttpResponse execute(JSONObject params) </font><font class="keyword">throws </font>Exception;</p><p>	<font class="keyword">public </font>MLocation doWifiPost() </font><font class="keyword">throws </font>Exception {</p><p>		<font class="keyword">return </font>transResponse(execute(doWifi()));</p><p>	}</p><p>	<font class="keyword">public </font>MLocation doApnPost() </font><font class="keyword">throws </font>Exception {</p><p>		<font class="keyword">return </font>transResponse(execute(doApn()));</p><p>	}</p><p>	<font class="keyword">public </font>MLocation doGpsPost(</font><font class="keyword">double </font>lat, </font><font class="keyword">double </font>lng) </font><font class="keyword">throws </font>Exception {</p><p>		<font class="keyword">return </font>transResponse(execute(doGps(lat, lng)));</p><p>	}</p><p>	<font class="keyword">private </font>MLocation transResponse(HttpResponse response) {</p><p>		</font>MLocation location = <font class="keyword">null</font>;</p><p>		<font class="keyword">if </font>(response.getStatusLine().getStatusCode() == 200) {</p><p>			</font>location = <font class="keyword">new </font>MLocation();</p><p>			HttpEntity entity = response.getEntity();</p><p>			BufferedReader br;</p><p>			<font class="keyword">try </font>{</p><p>				</font>br = <font class="keyword">new </font>BufferedReader(</font><font class="keyword">new </font>InputStreamReader(</p><p>						entity.getContent()));</p><p>				</font>StringBuffer sb = <font class="keyword">new </font>StringBuffer();</p><p>				String result = br.readLine();</p><p>				<font class="keyword">while </font>(result != </font><font class="keyword">null</font>) {</p><p>					sb.append(result);</p><p>					result = br.readLine();</p><p>				}</p><p>				</font>JSONObject json = <font class="keyword">new </font>JSONObject(sb.toString());</p><p>				</font>JSONObject lca = json.getJSONObject(<font class="Fields">"location"</font>);</p><p>				</font>location.Access_token = json.getString(<font class="Fields">"access_token"</font>);</p><p>				<font class="keyword">if </font>(lca != </font><font class="keyword">null</font>) {</p><p>					<font class="keyword">if </font>(lca.has(<font class="Fields">"accuracy"</font>))</p><p>						</font>location.Accuracy = lca.getString(<font class="Fields">"accuracy"</font>);</p><p>					<font class="keyword">if </font>(lca.has(<font class="Fields">"longitude"</font>))</p><p>						</font>location.Latitude = lca.getDouble(<font class="Fields">"longitude"</font>);</p><p>					<font class="keyword">if </font>(lca.has(<font class="Fields">"latitude"</font>))</p><p>						</font>location.Longitude = lca.getDouble(<font class="Fields">"latitude"</font>);</p><p>					<font class="keyword">if </font>(lca.has(<font class="Fields">"address"</font>)) {</p><p>						</font>JSONObject address = lca.getJSONObject(<font class="Fields">"address"</font>);</p><p>						<font class="keyword">if </font>(address != </font><font class="keyword">null</font>) {</p><p>							<font class="keyword">if </font>(address.has(<font class="Fields">"region"</font>))</p><p>								</font>location.Region = address.getString(<font class="Fields">"region"</font>);</p><p>							<font class="keyword">if </font>(address.has(<font class="Fields">"street_number"</font>))</p><p>								location.Street_number = address</p><p>										</font>.getString(<font class="Fields">"street_number"</font>);</p><p>							<font class="keyword">if </font>(address.has(<font class="Fields">"country_code"</font>))</p><p>								location.Country_code = address</p><p>										</font>.getString(<font class="Fields">"country_code"</font>);</p><p>							<font class="keyword">if </font>(address.has(<font class="Fields">"street"</font>))</p><p>								</font>location.Street = address.getString(<font class="Fields">"street"</font>);</p><p>							<font class="keyword">if </font>(address.has(<font class="Fields">"city"</font>))</p><p>								</font>location.City = address.getString(<font class="Fields">"city"</font>);</p><p>							<font class="keyword">if </font>(address.has(<font class="Fields">"country"</font>))</p><p>								</font>location.Coun<font class="keyword">try </font>= address.getString(<font class="Fields">"country"</font>);</p><p>						}</p><p>					}</p><p>				}</p><p>			</font>} <font class="keyword">catch </font>(Exception e) {</p><p>				e.printStackTrace();</p><p>				</font>location = <font class="keyword">null</font>;</p><p>			}</p><p>		}</p><p>		<font class="keyword">return </font>location;</p><p>	}</p><p>	<font class="keyword">private </font>JSONObject doGps(</font><font class="keyword">double </font>lat, </font><font class="keyword">double </font>lng) </font><font class="keyword">throws </font>Exception {</p><p>		</font>JSONObject holder = <font class="keyword">new </font>JSONObject();</p><p>		</font>holder.put(<font class="Fields">"version"</font>, </font><font class="Fields">"1.1.0"</font>);</p><p>		</font>holder.put(<font class="Fields">"host"</font>, </font><font class="Fields">"maps.google.com"</font>);</p><p>		</font>holder.put(<font class="Fields">"address_language"</font>, </font><font class="Fields">"zh_CN"</font>);</p><p>		</font>holder.put(<font class="Fields">"request_address"</font>, <font class="keyword">true</font>);</p><p>		</font>JSONObject data = <font class="keyword">new </font>JSONObject();</p><p>		</font>data.put(<font class="Fields">"latitude"</font>, lat);</p><p>		</font>data.put(<font class="Fields">"longitude"</font>, lng);</p><p>		</font>holder.put(<font class="Fields">"location"</font>, data);</p><p>		<font class="keyword">return </font>holder;</p><p>	}</p><p>	<font class="keyword">private </font>JSONObject doApn() </font><font class="keyword">throws </font>Exception {</p><p>		</font>JSONObject holder = <font class="keyword">new </font>JSONObject();</p><p>		</font>holder.put(<font class="Fields">"version"</font>, </font><font class="Fields">"1.1.0"</font>);</p><p>		</font>holder.put(<font class="Fields">"host"</font>, </font><font class="Fields">"maps.google.com"</font>);</p><p>		</font>holder.put(<font class="Fields">"address_language"</font>, </font><font class="Fields">"zh_CN"</font>);</p><p>		</font>holder.put(<font class="Fields">"request_address"</font>, <font class="keyword">true</font>);</p><p>		TelephonyManager tm = (TelephonyManager) context</p><p>				.getSystemService(Context.TELEPHONY_SERVICE);</p><p>		GsmCellLocation gcl = (GsmCellLocation) tm.getCellLocation();</p><p>		<font class="keyword">int </font>cid = gcl.getCid();</p><p>		<font class="keyword">int </font>lac = gcl.getLac();</p><p>		<font class="keyword">int </font>mcc = Integer.valueOf(tm.getNetworkOperator().substring(0, 3));</p><p>		<font class="keyword">int </font>mnc = Integer.valueOf(tm.getNetworkOperator().substring(3, 5));</p><p>		</font>JSONArray array = <font class="keyword">new </font>JSONArray();</p><p>		</font>JSONObject data = <font class="keyword">new </font>JSONObject();</p><p>		</font>data.put(<font class="Fields">"cell_id"</font>, cid);</p><p>		</font>data.put(<font class="Fields">"location_area_code"</font>, lac);</p><p>		</font>data.put(<font class="Fields">"mobile_country_code"</font>, mcc);</p><p>		</font>data.put(<font class="Fields">"mobile_network_code"</font>, mnc);</p><p>		array.put(data);</p><p>		</font>holder.put(<font class="Fields">"cell_towers"</font>, array);</p><p>		<font class="keyword">return </font>holder;</p><p>	}</p><p>	<font class="keyword">private </font>JSONObject doWifi() </font><font class="keyword">throws </font>Exception {</p><p>		</font>JSONObject holder = <font class="keyword">new </font>JSONObject();</p><p>		</font>holder.put(<font class="Fields">"version"</font>, </font><font class="Fields">"1.1.0"</font>);</p><p>		</font>holder.put(<font class="Fields">"host"</font>, </font><font class="Fields">"maps.google.com"</font>);</p><p>		</font>holder.put(<font class="Fields">"address_language"</font>, </font><font class="Fields">"zh_CN"</font>);</p><p>		</font>holder.put(<font class="Fields">"request_address"</font>, <font class="keyword">true</font>);</p><p>		WifiManager wifiManager = (WifiManager) context</p><p>				.getSystemService(Context.WIFI_SERVICE);</p><p>		<font class="keyword">if </font>(wifiManager.getConnectionInfo().getBSSID() == </font><font class="keyword">null</font>) {</p><p>			<font class="keyword">throw </font><font class="keyword">new </font>RuntimeException(<font class="Fields">"bssid is </font><font class="keyword">null</font>"</font>);</p><p>		}</p><p>		</font>JSONArray array = <font class="keyword">new </font>JSONArray();</p><p>		</font>JSONObject data = <font class="keyword">new </font>JSONObject();</p><p>		</font>data.put(<font class="Fields">"mac_address"</font>, wifiManager.getConnectionInfo().getBSSID());</p><p>		</font>data.put(<font class="Fields">"signal_strength"</font>, 8);</p><p>		</font>data.put(<font class="Fields">"age"</font>, 0);</p><p>		array.put(data);</p><p>		</font>holder.put(<font class="Fields">"wifi_towers"</font>, array);</p><p>		<font class="keyword">return </font>holder;</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">static </font><font class="keyword">class </font>MLocation {</p><p>		<font class="keyword">public </font>String Access_token;</p><p>		<font class="keyword">public </font><font class="keyword">double </font>Latitude;</p><p>		<font class="keyword">public </font><font class="keyword">double </font>Longitude;</p><p>		<font class="keyword">public </font>String Accuracy;</p><p>		<font class="keyword">public </font>String Region;</p><p>		<font class="keyword">public </font>String Street_number;</p><p>		<font class="keyword">public </font>String Country_code;</p><p>		<font class="keyword">public </font>String Street;</p><p>		<font class="keyword">public </font>String City;</p><p>		<font class="keyword">public </font>String Country;</p><p>		@Override</p><p>		<font class="keyword">public </font>String toString() {</p><p>			</font>StringBuffer buffer = <font class="keyword">new </font>StringBuffer();</p><p>			</font>buffer.append(<font class="Fields">"Access_token:"</font> + Access_token + </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"Region:"</font> + Region + </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"Accuracy:"</font> + Accuracy + </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"Latitude:"</font> + Latitude + </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"Longitude:"</font> + Longitude + </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"Country_code:"</font> + Country_code + </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"Country:"</font> + Coun<font class="keyword">try </font>+ </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"City:"</font> + City + </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"Street:"</font> + Street + </font><font class="Fields">"\n"</font>);</p><p>			</font>buffer.append(<font class="Fields">"Street_number:"</font> + Street_number + </font><font class="Fields">"\n"</font>);</p><p>			<font class="keyword">return </font>buffer.toString();</p><p>		}</p><p>	}</p><p>}</p><p></pre></p><p>GpsActivity.java</p><p><pre><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.app.AlertDialog;</p><p><font class="keyword">import </font>android.app.ProgressDialog;</p><p><font class="keyword">import </font>android.os.AsyncTask;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">import </font>android.view.View;</p><p><font class="keyword">import </font>android.view.View.OnClickListener;</p><p><font class="keyword">import </font>android.widget.TextView;</p><p><font class="keyword">import </font>device.gps.IAddressTask.MLocation;</p><p><font class="keyword">public </font><font class="keyword">class </font>GpsActivity </font><font class="keyword">extends </font>Activity </font><font class="keyword">implements </font>OnClickListener {</p><p>	<font class="keyword">private </font>TextView gps_tip = </font><font class="keyword">null</font>;</p><p>	<font class="keyword">private </font>AlertDialog dialog = </font><font class="keyword">null</font>;</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate(Bundle savedInstanceState) {</p><p>		<font class="keyword">super</font>.onCreate(savedInstanceState);</p><p>		setContentView(R.layout.main);</p><p>		gps_tip = (TextView) findViewById(R.id.gps_tip);</p><p>		</font>findViewById(R.id.do_gps).setOnClickListener(GpsActivity.<font class="keyword">this</font>);</p><p>		</font>findViewById(R.id.do_apn).setOnClickListener(GpsActivity.<font class="keyword">this</font>);</p><p>		</font>findViewById(R.id.do_wifi).setOnClickListener(GpsActivity.<font class="keyword">this</font>);</p><p>		</font>dialog = <font class="keyword">new </font>ProgressDialog(GpsActivity.</font><font class="keyword">this</font>);</p><p>		</font>dialog.setTitle(<font class="Fields">"请稍等..."</font>);</p><p>		</font>dialog.setMessage(<font class="Fields">"正在定位..."</font>);</p><p>	}</p><p>	</font>@SuppressWarnings(<font class="Fields">"unchecked"</font>)</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>		</font>gps_tip.setText(<font class="Fields">""</font>);</p><p>		<font class="keyword">switch </font>(v.getId()) {</p><p>		<font class="keyword">case </font>R.id.do_apn:</p><p>			do_apn();</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.do_gps:</p><p>			</font>GpsTask gpstask = <font class="keyword">new </font>GpsTask(GpsActivity.</font><font class="keyword">this</font>,</p><p>					<font class="keyword">new </font>GpsTaskCallBack() {</p><p>						@Override</p><p>						<font class="keyword">public </font><font class="keyword">void </font>gpsConnectedTimeOut() {</p><p>							</font>gps_tip.setText(<font class="Fields">"获取GPS超时了"</font>);</p><p>						}</p><p></p><p>						@Override</p><p>						<font class="keyword">public </font><font class="keyword">void </font>gpsConnected(GpsData gpsdata) {</p><p>							do_gps(gpsdata);</p><p>						}</p><p>					}, 3000);</p><p>			gpstask.execute();</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.id.do_wifi:</p><p>			do_wifi();</p><p>			<font class="keyword">break</font>;</p><p>		}</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>do_apn() {</p><p>		<font class="keyword">new </font>AsyncTask&lt;Void, Void, String&gt;() {</p><p>			@Override</p><p>			<font class="keyword">protected </font>String doInBackground(Void... params) {</p><p>				</font>MLocation location = <font class="keyword">null</font>;</p><p>				<font class="keyword">try </font>{</p><p>					</font>location = <font class="keyword">new </font>AddressTask(GpsActivity.</font><font class="keyword">this</font>,</p><p>							AddressTask.DO_APN).doApnPost();</p><p>				</font>} <font class="keyword">catch </font>(Exception e) {</p><p>					e.printStackTrace();</p><p>				}</p><p>				<font class="keyword">if </font>(location == </font><font class="keyword">null</font>)</p><p>					<font class="keyword">return </font><font class="keyword">null</font>;</p><p>				<font class="keyword">return </font>location.toString();</p><p>			}</p><p>			@Override</p><p>			<font class="keyword">protected </font><font class="keyword">void </font>onPreExecute() {</p><p>				dialog.show();</p><p>				<font class="keyword">super</font>.onPreExecute();</p><p>			}</p><p>			@Override</p><p>			<font class="keyword">protected </font><font class="keyword">void </font>onPostExecute(String result) {</p><p>				<font class="keyword">if </font>(result == </font><font class="keyword">null</font>) {</p><p>					</font>gps_tip.setText(<font class="Fields">"基站定位失败了..."</font>);</p><p>				</font>} <font class="keyword">else </font>{</p><p>					gps_tip.setText(result);</p><p>				}</p><p>				dialog.dismiss();</p><p>				<font class="keyword">super</font>.onPostExecute(result);</p><p>			}</p><p>		}.execute();</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>do_gps(</font><font class="keyword">final </font>GpsData gpsdata) {</p><p>		<font class="keyword">new </font>AsyncTask&lt;Void, Void, String&gt;() {</p><p>			@Override</p><p>			<font class="keyword">protected </font>String doInBackground(Void... params) {</p><p>				</font>MLocation location = <font class="keyword">null</font>;</p><p>				<font class="keyword">try </font>{</p><p>					</font>Log.i(<font class="Fields">"do_gpspost"</font>, </font><font class="Fields">"经纬度："</font> + gpsdata.getLatitude() + </font><font class="Fields">"----</p><p>							+ gpsdata.getLongitude());</p><p>					</font>location = <font class="keyword">new </font>AddressTask(GpsActivity.</font><font class="keyword">this</font>,</p><p>							AddressTask.DO_GPS).doGpsPost(</p><p>							gpsdata.getLatitude(), gpsdata.getLongitude());</p><p>				</font>} <font class="keyword">catch </font>(Exception e) {</p><p>					e.printStackTrace();</p><p>				}</p><p>				<font class="keyword">if </font>(location == </font><font class="keyword">null</font>)</p><p>					<font class="keyword">return </font><font class="Fields">"GPS信息获取错误"</font>;</p><p>				<font class="keyword">return </font>location.toString();</p><p>			}</p><p>			@Override</p><p>			<font class="keyword">protected </font><font class="keyword">void </font>onPreExecute() {</p><p>				dialog.show();</p><p>				<font class="keyword">super</font>.onPreExecute();</p><p>			}</p><p>			@Override</p><p>			<font class="keyword">protected </font><font class="keyword">void </font>onPostExecute(String result) {</p><p>				gps_tip.setText(result);</p><p>				dialog.dismiss();</p><p>				<font class="keyword">super</font>.onPostExecute(result);</p><p>			}</p><p>		}.execute();</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>do_wifi() {</p><p>		<font class="keyword">new </font>AsyncTask&lt;Void, Void, String&gt;() {</p><p>			@Override</p><p>			<font class="keyword">protected </font>String doInBackground(Void... params) {</p><p>				</font>MLocation location = <font class="keyword">null</font>;</p><p>				<font class="keyword">try </font>{</p><p>					</font>location = <font class="keyword">new </font>AddressTask(GpsActivity.</font><font class="keyword">this</font>,</p><p>							AddressTask.DO_WIFI).doWifiPost();</p><p>				</font>} <font class="keyword">catch </font>(Exception e) {</p><p>					e.printStackTrace();</p><p>				}</p><p>				<font class="keyword">if </font>(location == </font><font class="keyword">null</font>)</p><p>					<font class="keyword">return </font><font class="keyword">null</font>;</p><p>				<font class="keyword">return </font>location.toString();</p><p>			}</p><p>			@Override</p><p>			<font class="keyword">protected </font><font class="keyword">void </font>onPreExecute() {</p><p>				dialog.show();</p><p>				<font class="keyword">super</font>.onPreExecute();</p><p>			}</p><p>			@Override</p><p>			<font class="keyword">protected </font><font class="keyword">void </font>onPostExecute(String result) {</p><p>				<font class="keyword">if </font>(result != </font><font class="keyword">null</font>) {</p><p>					gps_tip.setText(result);</p><p>				</font>} <font class="keyword">else </font>{</p><p>					</font>gps_tip.setText(<font class="Fields">"WIFI定位失败了..."</font>);</p><p>				}</p><p>				dialog.dismiss();</p><p>				<font class="keyword">super</font>.onPostExecute(result);</p><p>			}</p><p>		}.execute();</p><p>	}</p><p>}</p><p></pre></p><p>AddressTask.java</p><p><pre><font class="keyword">import </font>org.apache.http.HttpHost;</p><p><font class="keyword">import </font>org.apache.http.HttpResponse;</p><p><font class="keyword">import </font>org.apache.http.client.HttpClient;</p><p><font class="keyword">import </font>org.apache.http.client.methods.HttpPost;</p><p><font class="keyword">import </font>org.apache.http.conn.params.ConnRouteParams;</p><p><font class="keyword">import </font>org.apache.http.entity.StringEntity;</p><p><font class="keyword">import </font>org.apache.http.impl.client.DefaultHttpClient;</p><p><font class="keyword">import </font>org.apache.http.params.HttpConnectionParams;</p><p><font class="keyword">import </font>org.json.JSONObject;</p><p></p><p><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.database.Cursor;</p><p><font class="keyword">import </font>android.net.Uri;</p><p><font class="keyword">public </font><font class="keyword">class </font>AddressTask </font><font class="keyword">extends </font>IAddressTask {</p><p>	<font class="keyword">public </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>DO_APN = 0;</p><p>	<font class="keyword">public </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>DO_WIFI = 1;</p><p>	<font class="keyword">public </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>DO_GPS = 2;</p><p>	<font class="keyword">private </font><font class="keyword">int </font>postType = -1;</p><p>	<font class="keyword">public </font>AddressTask(Activity context, </font><font class="keyword">int </font>postType) {</p><p>		<font class="keyword">super</font>(context);</p><p>		<font class="keyword">this</font>.postType = postType;</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font>HttpResponse execute(JSONObject params) </font><font class="keyword">throws </font>Exception {</p><p>		</font>HttpClient httpClient = <font class="keyword">new </font>DefaultHttpClient();</p><p>		HttpConnectionParams.setConnectionTimeout(httpClient.getParams(),</p><p>				20 * 1000);</p><p>		HttpConnectionParams.setSoTimeout(httpClient.getParams(), 20 * 1000);</p><p>		</font>HttpPost post = <font class="keyword">new </font>HttpPost(<font class="Fields">"http:<font class="Comments">//74.125.71.147/loc/json"</font>); <font class="Comments">// 设置代理</font></p><p>		<font class="keyword">if </font>(postType == DO_APN) {</p><p>			</font>Uri uri = Uri.parse(<font class="Fields">"content:<font class="Comments">//telephony/carriers/preferapn"</font>); <font class="Comments">// 获取当前正在使用的APN接入点</font></p><p>			</font>Cursor mCursor = context.getContentResolver().query(uri, <font class="keyword">null</font>,</p><p>					<font class="keyword">null</font>, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>);</p><p>			<font class="keyword">if </font>(mCursor != </font><font class="keyword">null</font>) {</p><p>				<font class="keyword">if </font>(mCursor.moveToFirst()) {</p><p>					String proxyStr = mCursor.getString(mCursor</p><p>							</font>.getColumnIndex(<font class="Fields">"proxy"</font>));</p><p>					<font class="keyword">if </font>(proxyStr != </font><font class="keyword">null</font> && proxyStr.trim().length() &gt; 0) {</p><p>						</font>HttpHost proxy = <font class="keyword">new </font>HttpHost(proxyStr, 80);</p><p>						httpClient.getParams().setParameter(</p><p>								ConnRouteParams.DEFAULT_PROXY, proxy);</p><p>					}</p><p>				}</p><p>			}</p><p>		}</p><p>		</font>StringEntity se = <font class="keyword">new </font>StringEntity(params.toString());</p><p>		post.setEntity(se);</p><p>		HttpResponse response = httpClient.execute(post);</p><p>		<font class="keyword">return </font>response;</p><p>	}</p><p>}</p><p></pre></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

