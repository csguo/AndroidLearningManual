
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android 图形绘制（Skia EGL OpenGL ES）_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li class="navcurrentLink"><A href="index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="游戏开发须知" href="index_187.html">游戏开发须知</A></h2>

  <h2><A title="游戏策划、设计分析" href="index_188.html">游戏策划、设计分析</A></h2>

  <h2><A title="Android OpenGL学习" href="index_190.html">Android OpenGL学习</A></h2>
<UL><li ><A title=Android OpenGL基础实例（一） href="show_301_190.html">Android OpenGL基础实例（一）</A> </li><li ><A title=Android OpenGL基础实例（二） href="show_302_190.html">Android OpenGL基础实例（二）</A> </li><li ><A title=Android OpenGL基础实例（三） href="show_303_190.html">Android OpenGL基础实例（三）</A> </li><li ><A title=Android OpenGL基础实例（四） href="show_304_190.html">Android OpenGL基础实例（四）</A> </li><li ><A title=Android 浅谈OpenGL ES（一） href="show_305_190.html">Android 浅谈OpenGL ES（一）</A> </li><li ><A title=Android 浅谈OpenGL ES（二） href="show_306_190.html">Android 浅谈OpenGL ES（二）</A> </li><li ><A title=OpenGL ES基础教程（一） href="show_307_190.html">OpenGL ES基础教程（一）</A> </li><li ><A title=OpenGL ES基础教程（二） href="show_308_190.html">OpenGL ES基础教程（二）</A> </li><li ><A title=Android OpenGL实战一―开发框架搭建、三角形和四边形的绘制 href="show_309_190.html">Android OpenGL实战一―开发框架搭建、三角形和四边形的绘制</A> </li><li ><A title=Android OpenGL实战二―颜色和旋转 href="show_310_190.html">Android OpenGL实战二―颜色和旋转</A> </li><li ><A title=Android 3D OpenGL开发之一― 变幻的背景色 href="show_311_190.html">Android 3D OpenGL开发之一― 变幻的背景色</A> </li><li ><A title=Android 3D OpenGL开发之二 ―旋转的三角形 href="show_312_190.html">Android 3D OpenGL开发之二 ―旋转的三角形</A> </li><li ><A title=Android 3D OpenGL开发之三 ―漂亮的金字塔 href="show_313_190.html">Android 3D OpenGL开发之三 ―漂亮的金字塔</A> </li><li ><A title=OpenGL ES 2.0实现的3D（一） href="show_314_190.html">OpenGL ES 2.0实现的3D（一）</A> </li><li ><A title=OpenGL ES 2.0实现的3D（二） href="show_315_190.html">OpenGL ES 2.0实现的3D（二）</A> </li><li ><A title=OpenGL ES 2.0实现的3D（三） href="show_316_190.html">OpenGL ES 2.0实现的3D（三）</A> </li><li ><A title=OpenGL核心函数库 href="show_317_190.html">OpenGL核心函数库</A> </li><li ><A title=OpenGL ES绘制3D图形 href="show_318_190.html">OpenGL ES绘制3D图形</A> </li><li ><A title=OpenGL ES 如何判断点击滑动线路位于哪个平面？ href="show_319_190.html">OpenGL ES 如何判断点击滑动线路位于哪个平面？</A> </li><li ><A title=OpenGL ES 学习阶段性总结 href="show_320_190.html">OpenGL ES 学习阶段性总结</A> </li><li class="currentLink"><A title=Android 图形绘制（Skia EGL OpenGL ES） href="show_321_190.html">Android 图形绘制（Skia EGL OpenGL ES）</A> </li><li ><A title=Android Graphic:apk and SkiaOpenGLES href="show_322_190.html">Android Graphic:apk and SkiaOpenGLES</A> </li><li ><A title=Android里的FrameBuffer href="show_323_190.html">Android里的FrameBuffer</A> </li></UL>
  <h2><A title="Android游戏开发之旅" href="index_191.html">Android游戏开发之旅</A></h2>

  <h2><A title="Android2D游戏开发" href="index_192.html">Android2D游戏开发</A></h2>

  <h2><A title="Android经典实例教程解析" href="index_193.html">Android经典实例教程解析</A></h2>

  <h2><A title="Android游戏开发实例" href="index_194.html">Android游戏开发实例</A></h2>

  <h2><A title="Libgdx游戏引擎" href="index_195.html">Libgdx游戏引擎</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android 图形绘制（Skia EGL OpenGL ES）</H2>
<div style="line-height:20px; font-size:14px;"><p>本人对图形学非常感兴趣，本硕期间都是图形学研究方向，目前还没毕业。为了找到好工作，就提前出来实习了。由于工作经验不足，对android图形绘制方面的了解也比较浮浅，希望写出来的东西，不要遭到大家的耻笑和鄙视。</p><p>好了，言归正传。</p><p>熟悉Windows编程的同志们，可能都知道GDI+是Windows的一套图形绘制库。也就是说Windows系统下，所有图形图像绘制，最终都是通过GDI来实现的。同样，在Android下也需要一套能绘制出点、线、面等复杂图形，或者渲染界面等图像方面的一个可供开发者调用的绘图函数接口，Skia就是这套绘制工具，一套图形图像绘制接口。</p><p>Skia是什么？打个比方来说吧，现在让你来画一幅画，比如我们的国画―山水画。画一幅画需要哪些工具呢？从常识上来说，我们需要一张纸，比如白纸，或者带有某些背景图的纸张；需要毛笔，不同型号的毛笔；墨汁；颜料等等。然后我们规定在纸张的哪个区域画图，用什么样的毛笔，用什么样的颜色，画什么样的图形，是点、线、面？还是花草等。</p><p>Skia是什么？Skia就是类似上面画图所有需要的一系列设备、工具等。要在Android里画图或者渲染图像，都需要Skia提供的API接口，或者是间接提供。</p><p>你可能会问，我在写应用程序里，怎么没看到或者用到Skia这样的函数呢？这个问题并不奇怪，因为你不需要直接控制图形绘制，没有做绘图类的应用，所以你没有用到这方面函数。但是，你所有Activity或者View或者其他控件的显示，在底层都是通过Skia提供的函数进行显示的。常见的Canvas类，假如你跟踪一下代码，会发现，Canvas是通过Native方式，调用底层的SkCanvas的。</p><p>我对Skia的理解很肤浅，之所有介绍一下Skia，是为了后续介绍Android下OpenGL ES方面的知识做准备的。因为在Android系统下，通过OpenGL ES绘制的3d图形，最终还是被合并到Skia定义的显示缓存中进行显示的。</p><p>Skia在Android系统中所处的位置，如下图：</p><p><img src="../img/games_opengl/21_opengl.jpg"></p><p>Skia在android源码里的目录位置：</p><p>・头文件(也可以说是internal API,因为google没有在NDK里面提供他)位置：android/external/skia/include。其中还包含以下几个子目录：animator,core,effects,images, views...， 最重要的就是core目录了，我们在这里的分析也主要针对core目录里面的API。</p><p>・源文件位于: android/external/skia/src目录，子目录结构和头文件目录相同。</p><p>・封装层：android对Skia引擎进行了封装，以便让java代码方便的调用，对skia封装的代码存在于android/framework/base/core/jni以及android/framework/base/core/jni/android/graphics目录下面。主要是对Canvas, Bitmap, Graphics, Picture等等的封装，以及和libui库的结合使用。</p><p>关于Skia的介绍，网上有很多，我这里只是简单提下，不是重点。</p><p>为了保持结构完整，下面引用网友的，关于Skia的简单调用吧。</p><p><pre></font>include <font class="Fields">"SkBitmap.h</p><p></font>include <font class="Fields">"SkDevice.h</p><p></font>include <font class="Fields">"SkPaint.h</p><p></font>include <font class="Fields">"SkRect.h</p><p></font>include <font class="Fields">"SkImageEncoder.h</p><p><font class="keyword">int </font>main()</p><p>{</p><p>	<font class="Comments">// Declare a raster bitmap, which has an integer width and height,</font></p><p>	<font class="Comments">// and a format (config), and a pointer to the actual pixels.</font></p><p>	<font class="Comments">// Bitmaps can be drawn into a SkCanvas, but they are also used to</font></p><p>	<font class="Comments">// specify the target of a SkCanvas' drawing operations.</font></p><p>	SkBitmap bitmap;</p><p>	bitmap.setConfig(SkBitmap::kARGB_8888_Config, 200, 200);</p><p>	bitmap.allocPixels();</p><p>	<font class="Comments">// A Canvas encapsulates all of the state about drawing into a</font></p><p>	<font class="Comments">// device (bitmap).  This includes a reference to the device itself,</font></p><p>	<font class="Comments">// and a stack of matrix/clip values. For any given draw call (e.g.</font></p><p>	<font class="Comments">// drawRect), the geometry of the object being drawn is transformed</font></p><p>	<font class="Comments">// by the concatenation of all the matrices in the stack. The</font></p><p>	<font class="Comments">// transformed geometry is clipped by the intersection of all of the</font></p><p>	<font class="Comments">// clips in the stack.</font></p><p>	</font>SkCanvas canvas(<font class="keyword">new </font>SkDevice(bitmap));</p><p>	<font class="Comments">// SkPaint class holds the style and color information about how to</font></p><p>	<font class="Comments">// draw geometries, text and bitmaps.</font></p><p>	</font>SkPa<font class="keyword">int </font>paint;</p><p>	<font class="Comments">// SkIRect holds four 32 bit integer coordinates for a rectangle.</font></p><p>	SkRect r;</p><p>	paint.setARGB(255, 255, 0, 0);</p><p>	r.set(25, 25, 145, 145);</p><p>	</font>canvas.drawRect(r, pa<font class="keyword">int</font>);</p><p>	paint.setARGB(255, 0, 255, 0);</p><p>	r.offset(20, 20);</p><p>	</font>canvas.drawRect(r, pa<font class="keyword">int</font>);</p><p>	paint.setARGB(255, 0, 0, 255);</p><p>	r.offset(20, 20);</p><p>	</font>canvas.drawRect(r, pa<font class="keyword">int</font>);</p><p>	<font class="Comments">// SkImageEncoder is the base class for encoding compressed images</font></p><p>	<font class="Comments">// from a specific SkBitmap.</font></p><p>	</font>SkImageEncoder::EncodeFile(<font class="Fields">"snapshot.png"</font>, bitmap,</p><p>		   SkImageEncoder::kPNG_Type,</p><p>		   100);</p><p>	<font class="keyword">return </font>0;</p><p>}</p><p></pre></p><p>编译方式：</p><p><pre>g++ \</p><p>-I./include \</p><p>-I./include/core \</p><p>-I./include/images \</p><p>-Wall -o test-skia test-skia.c \</p><p>out/src/images/SkImageDecoder_libpng.o out/libskia.a \</p><p>-lpng -lpthread -g</p><p></pre></p><p>笔者做了简要的批注，大概可知晓Sk开头的这些API的功用，而上述的范例程序一开始就要求Skia配置画布(SkCanvas)，接着透过一份SkRect对象r，给定ARGB的描述，使其有着不同的颜色，再来就是调整向量对象的位移并绘制。正如前文提及，Skia仅是绘图引擎，并未如Cairo一般广泛对应到PDF, X11, GDI等等底层绘图装置，所以为了方便观察绘图结果，我们透过Skia内建的image codec来输出PNG图档，所以执行前述编译后的执行档"test-skia"，应该会得到以下图档：(本无外框与底色，但为了清楚于文章呈现，额外用绘图软件追加)</p><p><img src="../img/games_opengl/21_opengl2.png"></p><p>直接调用Skia函数绘图类似上面的操作，下一章直接介绍OpenGL ES在Android下的应用。</p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

