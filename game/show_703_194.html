
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android 3D游戏中的First Step（二）_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li class="navcurrentLink"><A href="index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="游戏开发须知" href="index_187.html">游戏开发须知</A></h2>

  <h2><A title="游戏策划、设计分析" href="index_188.html">游戏策划、设计分析</A></h2>

  <h2><A title="Android OpenGL学习" href="index_190.html">Android OpenGL学习</A></h2>

  <h2><A title="Android游戏开发之旅" href="index_191.html">Android游戏开发之旅</A></h2>

  <h2><A title="Android2D游戏开发" href="index_192.html">Android2D游戏开发</A></h2>

  <h2><A title="Android经典实例教程解析" href="index_193.html">Android经典实例教程解析</A></h2>

  <h2><A title="Android游戏开发实例" href="index_194.html">Android游戏开发实例</A></h2>
<UL><li ><A title=Android 3D游戏基础介绍 href="show_701_194.html">Android 3D游戏基础介绍</A> </li><li ><A title=Android 3D游戏中的First Step（一） href="show_702_194.html">Android 3D游戏中的First Step（一）</A> </li><li class="currentLink"><A title=Android 3D游戏中的First Step（二） href="show_703_194.html">Android 3D游戏中的First Step（二）</A> </li><li ><A title=Android 2D壁球游戏（一） href="show_704_194.html">Android 2D壁球游戏（一）</A> </li><li ><A title=Android 2D壁球游戏（二） href="show_705_194.html">Android 2D壁球游戏（二）</A> </li><li ><A title=Android 2D壁球游戏（三） href="show_706_194.html">Android 2D壁球游戏（三）</A> </li><li ><A title=Android 2D手机游戏即时阴影效果（一） href="show_707_194.html">Android 2D手机游戏即时阴影效果（一）</A> </li><li ><A title=Android 2D手机游戏即时阴影效果（二） href="show_708_194.html">Android 2D手机游戏即时阴影效果（二）</A> </li><li ><A title=Android 五子棋游戏 href="show_709_194.html">Android 五子棋游戏</A> </li></UL>
  <h2><A title="Libgdx游戏引擎" href="index_195.html">Libgdx游戏引擎</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android 3D游戏中的First Step（二）</H2>
<div style="line-height:20px; font-size:14px;"><p>我们的这一篇是接上一篇的来说的。那就不多说废话了。直接贴上代码：</p><p><pre><font class="keyword">private </font><font class="keyword">void </font>copy(Object src) {</p><p>	<font class="keyword">try </font>{</p><p>		<font class="Comments">// 打印日志</font></p><p>		</font>Logger.log(<font class="Fields">"Copying data from master Activity!"</font>);</p><p>		<font class="Comments">// 返回一个数组，其中包含目前这个类的的所有字段的Filed对象</font></p><p>		Field[] fs = src.getClass().getDeclaredFields();</p><p>		<font class="Comments">// 遍历fs数组</font></p><p>		<font class="keyword">for </font>(Field f : fs) {</p><p>			<font class="Comments">// 尝试设置无障碍标志的值。标志设置为false将使访问检查，设置为true，将其禁用。</font></p><p>			</font>f.setAccessible(<font class="keyword">true</font>);</p><p>			<font class="Comments">// 将取到的值全部装入当前类中</font></p><p>			</font>f.set(<font class="keyword">this</font>, f.get(src));</p><p>		}</p><p>	</font>} <font class="keyword">catch </font>(Exception e) {</p><p>		<font class="Comments">// 抛出运行时异常</font></p><p>		<font class="keyword">throw </font><font class="keyword">new </font>RuntimeException(e);</p><p>	}</p><p>}</p><p><font class="keyword">public </font><font class="keyword">boolean </font>onTouchEvent(MotionEvent me) {</p><p>	<font class="Comments">// 按键开始</font></p><p>	<font class="keyword">if </font>(me.getAction() == MotionEvent.ACTION_DOWN) {</p><p>		<font class="Comments">// 保存按下的初始x,y位置于xpos,ypos中</font></p><p>		xpos = me.getX();</p><p>		ypos = me.getY();</p><p>		<font class="keyword">return </font><font class="keyword">true</font>;</p><p>	}</p><p>	<font class="Comments">// 按键结束</font></p><p>	<font class="keyword">if </font>(me.getAction() == MotionEvent.ACTION_UP) {</p><p>		<font class="Comments">// 设置x,y及旋转角度为初始值</font></p><p>		xpos = -1;</p><p>		ypos = -1;</p><p>		touchTurn = 0;</p><p>		touchTurnUp = 0;</p><p>		<font class="keyword">return </font><font class="keyword">true</font>;</p><p>	}</p><p>	<font class="keyword">if </font>(me.getAction() == MotionEvent.ACTION_MOVE) {</p><p>		<font class="Comments">// 计算x,y偏移位置及x,y轴上的旋转角度</font></p><p>		<font class="keyword">float </font>xd = me.getX() - xpos;</p><p>		<font class="keyword">float </font>yd = me.getY() - ypos;</p><p>		<font class="Comments">// Logger.log("me.getX() - xpos-----------&gt;&gt;"</font></p><p>		<font class="Comments">// + (me.getX() - xpos));</font></p><p>		xpos = me.getX();</p><p>		ypos = me.getY();</p><p>		</font>Logger.log(<font class="Fields">"xpos------------&gt;&gt;"</font> + xpos);</p><p>		<font class="Comments">// Logger.log("ypos------------&gt;&gt;" + ypos);</font></p><p>		<font class="Comments">// 以x轴为例，鼠标从左向右拉为正，从右向左拉为负</font></p><p>		touchTurn = xd / -100f;</p><p>		touchTurnUp = yd / -100f;</p><p>		</font>Logger.log(<font class="Fields">"touchTurn------------&gt;&gt;"</font> + touchTurn);</p><p>		<font class="Comments">// Logger.log("touchTurnUp------------&gt;&gt;" + touchTurnUp);</font></p><p>		<font class="keyword">return </font><font class="keyword">true</font>;</p><p>	}</p><p>	<font class="Comments">// 每Move一下休眠毫秒</font></p><p>	<font class="keyword">try </font>{</p><p>		Thread.sleep(15);</p><p>	</font>} <font class="keyword">catch </font>(Exception e) {</p><p>		<font class="Comments">// No need for this...</font></p><p>	}</p><p>	<font class="keyword">return </font><font class="keyword">super</font>.onTouchEvent(me);</p><p>}</p><p></p><p><font class="Comments">// MyRenderer类实现GLSurfaceView.Renderer接口</font></p><p><font class="keyword">class </font>MyRenderer </font><font class="keyword">implements </font>GLSurfaceView.Renderer {</p><p>	<font class="Comments">// 当前系统的毫秒数</font></p><p>	<font class="keyword">private </font><font class="keyword">long </font>time = System.currentTimeMillis();</p><p>	<font class="Comments">// 是否停止</font></p><p>	<font class="keyword">private </font><font class="keyword">boolean </font>stop = </font><font class="keyword">false</font>;</p><p>	<font class="Comments">// 停止</font></p><p>	<font class="keyword">public </font><font class="keyword">void </font>stop() {</p><p>		</font>stop = <font class="keyword">true</font>;</p><p>	}</p><p>	<font class="Comments">// 当屏幕改变时</font></p><p>	<font class="keyword">public </font><font class="keyword">void </font>onSurfaceChanged(GL10 gl, </font><font class="keyword">int </font>w, </font><font class="keyword">int </font>h) {</p><p>		<font class="Comments">// 如果FrameBuffer不为NULL,释放fb所占资源</font></p><p>		<font class="keyword">if </font>(fb != </font><font class="keyword">null</font>) {</p><p>			fb.dispose();</p><p>		}</p><p>		<font class="Comments">// 创建一个宽度为w,高为h的FrameBuffer</font></p><p>		</font>fb = <font class="keyword">new </font>FrameBuffer(gl, w, h);</p><p>		</font>Logger.log(master + <font class="Fields">""</font>);</p><p>		<font class="Comments">// 如果master为空</font></p><p>		<font class="keyword">if </font>(master == </font><font class="keyword">null</font>) {</p><p>			<font class="Comments">// 实例化World对象</font></p><p>			</font>world = <font class="keyword">new </font>World();</p><p>			<font class="Comments">// 设置了环境光源强度。设置此值是负的整个场景会变暗，而为正将照亮了一切。</font></p><p>			world.setAmbientLight(20, 20, 20);</p><p>			<font class="Comments">// 在World中创建一个新的光源</font></p><p>			</font>sun = <font class="keyword">new </font>Light(world);</p><p>			<font class="Comments">// 设置光照强度</font></p><p>			sun.setIntensity(250, 250, 250);</p><p>			<font class="Comments">// 创建一个纹理</font></p><p>			<font class="Comments">// 构造方法Texture(Bitmap image)</font></p><p>			<font class="Comments">// static Bitmap rescale(Bitmap bitmap, int width, int height)</font></p><p>			<font class="Comments">// static Bitmap convert(Drawable drawable)</font></p><p>			</font>Texture texture = <font class="keyword">new </font>Texture(BitmapHelper.rescale(</p><p>					BitmapHelper.convert(getResources().getDrawable(</p><p>							R.drawable.glass)), 64, 64));</p><p>			<font class="Comments">// TextureManager.getInstance()取得一个Texturemanager对象</font></p><p>			<font class="Comments">// addTexture("texture",texture)添加一个纹理</font></p><p>			</font>TextureManager.getInstance().addTexture(<font class="Fields">"texture"</font>, texture);</p><p>			<font class="Comments">// Object3D对象开始了:-)</font></p><p>			<font class="Comments">// Primitives提供了一些基本的三维物体，假如你为了测试而生成一些对象或为</font></p><p>			<font class="Comments">// 其它目的使用这些类将很明智，因为它即快速又简单，不需要载入和编辑。</font></p><p>			<font class="Comments">// 调用public static Object3D getCube(float scale) scale:角度</font></p><p>			<font class="Comments">// 返回一个立方体</font></p><p>			cube = Primitives.getCube(10);</p><p>			<font class="Comments">// 以纹理的方式给对象所有面"包装"上纹理</font></p><p>			cube.calcTextureWrapSpherical();</p><p>			<font class="Comments">// 给对象设置纹理</font></p><p>			</font>cube.setTexture(<font class="Fields">"texture"</font>);</p><p>			<font class="Comments">// 除非你想在事后再用PolygonManager修改,否则释放那些不再需要数据的内存</font></p><p>			cube.strip();</p><p>			<font class="Comments">// 初始化一些基本的对象是几乎所有进一步处理所需的过程。</font></p><p>			<font class="Comments">// 如果对象是"准备渲染"(装载，纹理分配，安置，渲染模式设置，</font></p><p>			<font class="Comments">// 动画和顶点控制器分配),那么build()必须被调用，</font></p><p>			cube.build();</p><p>			<font class="Comments">// 将Object3D对象添加到world集合</font></p><p>			world.addObject(cube);</p><p>			<font class="Comments">// 该Camera代表了Camera/viewer在当前场景的位置和方向，它也包含了当前视野的有关信息</font></p><p>			<font class="Comments">// 你应该记住Camera的旋转矩阵实际上是应用在World中的对象的一个旋转矩阵。</font></p><p>			<font class="Comments">// 这一点很重要，当选择了Camera的旋转角度，一个Camera(虚拟)围绕w旋转和通过围绕World围绕w旋转、</font></p><p>			<font class="Comments">// 将起到相同的效果，因此，考虑到旋转角度，World围绕camera时，camera的视角是静态的。假如你不喜欢</font></p><p>			<font class="Comments">// 这种习惯，你可以使用rotateCamera()方法</font></p><p>			Camera cam = world.getCamera();</p><p>			<font class="Comments">// 以50有速度向后移动Camera（相对于目前的方向）</font></p><p>			cam.moveCamera(Camera.CAMERA_MOVEOUT, 50);</p><p>			<font class="Comments">// cub.getTransformedCenter()返回对象的中心</font></p><p>			<font class="Comments">// cam.lookAt(SimpleVector lookAt))</font></p><p>			<font class="Comments">// 旋转这样camera以至于它看起来是在给定的world-space 的位置</font></p><p>			cam.lookAt(cube.getTransformedCenter());</p><p>			<font class="Comments">// SimpleVector是一个代表三维矢量的基础类，几乎每一个矢量都</font></p><p>			<font class="Comments">// 是用SimpleVector或者至少是一个SimpleVector变体构成的(有时由于</font></p><p>			<font class="Comments">// 某些原因比如性能可能会用(float x,float y,float z)之类)。</font></p><p>			</font>SimpleVector sv = <font class="keyword">new </font>SimpleVector();</p><p>			<font class="Comments">// 将当前SimpleVector的x,y,z值设为给定的SimpleVector(cube.getTransformedCenter())的值</font></p><p>			sv.set(cube.getTransformedCenter());</p><p>			<font class="Comments">// Y方向上减去100</font></p><p>			sv.y -= 100;</p><p>			<font class="Comments">// Z方向上减去100</font></p><p>			sv.z -= 100;</p><p>			<font class="Comments">// 设置光源位置</font></p><p>			sun.setPosition(sv);</p><p>			<font class="Comments">// 强制GC和finalization工作来试图去释放一些内存，同时将当时的内存写入日志，</font></p><p>			<font class="Comments">// 这样可以避免动画不连贯的情况，然而，它仅仅是减少这种情况发生的机率</font></p><p>			MemoryHelper.compact();</p><p>			<font class="Comments">// 如果master为空,使用日志记录且设master为HelloWorld本身</font></p><p>			<font class="keyword">if </font>(master == </font><font class="keyword">null</font>) {</p><p>				</font>Logger.log(<font class="Fields">"Saving master Activity!"</font>);</p><p>				</font>master = HelloWorld.<font class="keyword">this</font>;</p><p>			}</p><p>		}</p><p>	}</p><p>	<font class="Comments">// 需实现的onSurfaceCreated(GL10 gl, EGLConfig config)</font></p><p>	<font class="keyword">public </font><font class="keyword">void </font>onSurfaceCreated(GL10 gl, EGLConfig config) {</p><p>	}</p><p>	<font class="Comments">// 绘制到当前屏幕哦:-D</font></p><p>	<font class="keyword">public </font><font class="keyword">void </font>onDrawFrame(GL10 gl) {</p><p>		<font class="keyword">try </font>{</p><p>			<font class="Comments">// 如果stop为true</font></p><p>			<font class="keyword">if </font>(!stop) {</p><p>				<font class="Comments">// 如果touchTurn不为0,向Y轴旋转touchTure角度</font></p><p>				<font class="keyword">if </font>(touchTurn != 0) {</p><p>					<font class="Comments">// 旋转物体的旋转绕Y由给定矩阵W轴角（弧度顺时针方向为正值）,应用到对象下一次渲染时。</font></p><p>					cube.rotateY(touchTurn);</p><p>					<font class="Comments">// 将touchTurn置0</font></p><p>					touchTurn = 0;</p><p>				}</p><p>				<font class="keyword">if </font>(touchTurnUp != 0) {</p><p>					<font class="Comments">// 旋转物体的旋转围绕x由给定角度宽（弧度，逆时针为正值）轴矩阵,应用到对象下一次渲染时。</font></p><p>					cube.rotateX(touchTurnUp);</p><p>					<font class="Comments">// 将touchTureUp置0</font></p><p>					touchTurnUp = 0;</p><p>				}</p><p>				<font class="Comments">// 用给定的颜色(back)清除FrameBuffer</font></p><p>				fb.clear(back);</p><p>				<font class="Comments">// 变换和灯光所有多边形</font></p><p>				world.renderScene(fb);</p><p>				<font class="Comments">// 绘制</font></p><p>				world.draw(fb);</p><p>				<font class="Comments">// 渲染图像显示</font></p><p>				fb.display();</p><p>				<font class="Comments">// 记录FPS</font></p><p>				<font class="keyword">if </font>(System.currentTimeMillis() - time &gt;= 1000) {</p><p>					<font class="Comments">// Logger.log(fps + "fps");</font></p><p>					fps = 0;</p><p>					time = System.currentTimeMillis();</p><p>				}</p><p>				fps++;</p><p>				<font class="Comments">// 如果stop为false,释放FrameBuffer</font></p><p>			</font>} <font class="keyword">else </font>{</p><p>				<font class="keyword">if </font>(fb != </font><font class="keyword">null</font>) {</p><p>					fb.dispose();</p><p>					</font>fb = <font class="keyword">null</font>;</p><p>				}</p><p>			}</p><p>			<font class="Comments">// 当出现异常，打印异常信息</font></p><p>		</font>} <font class="keyword">catch </font>(Exception e) {</p><p>			Logger.log(e, Logger.MESSAGE);</p><p>		}</p><p>	}</p><p>}</p><p></pre></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

