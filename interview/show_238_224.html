
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>问答题38_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li class="navcurrentLink"><A href="index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="选择题" href="index_222.html">选择题</A></h2>

  <h2><A title="填空题" href="index_223.html">填空题</A></h2>

  <h2><A title="问答题" href="index_224.html">问答题</A></h2>
<UL><li ><A title=问答题1 href="show_201_224.html">问答题1</A> </li><li ><A title=问答题2 href="show_202_224.html">问答题2</A> </li><li ><A title=问答题3 href="show_203_224.html">问答题3</A> </li><li ><A title=问答题4 href="show_204_224.html">问答题4</A> </li><li ><A title=问答题5 href="show_205_224.html">问答题5</A> </li><li ><A title=问答题6 href="show_206_224.html">问答题6</A> </li><li ><A title=问答题7 href="show_207_224.html">问答题7</A> </li><li ><A title=问答题8 href="show_208_224.html">问答题8</A> </li><li ><A title=问答题9 href="show_209_224.html">问答题9</A> </li><li ><A title=问答题10 href="show_210_224.html">问答题10</A> </li><li ><A title=问答题11 href="show_211_224.html">问答题11</A> </li><li ><A title=问答题12 href="show_212_224.html">问答题12</A> </li><li ><A title=问答题13 href="show_213_224.html">问答题13</A> </li><li ><A title=问答题14 href="show_214_224.html">问答题14</A> </li><li ><A title=问答题15 href="show_215_224.html">问答题15</A> </li><li ><A title=问答题16 href="show_216_224.html">问答题16</A> </li><li ><A title=问答题17 href="show_217_224.html">问答题17</A> </li><li ><A title=问答题18 href="show_218_224.html">问答题18</A> </li><li ><A title=问答题19 href="show_219_224.html">问答题19</A> </li><li ><A title=问答题20 href="show_220_224.html">问答题20</A> </li><li ><A title=问答题21 href="show_221_224.html">问答题21</A> </li><li ><A title=问答题22 href="show_222_224.html">问答题22</A> </li><li ><A title=问答题23 href="show_223_224.html">问答题23</A> </li><li ><A title=问答题24 href="show_224_224.html">问答题24</A> </li><li ><A title=问答题25 href="show_225_224.html">问答题25</A> </li><li ><A title=问答题26 href="show_226_224.html">问答题26</A> </li><li ><A title=问答题27 href="show_227_224.html">问答题27</A> </li><li ><A title=问答题28 href="show_228_224.html">问答题28</A> </li><li ><A title=问答题29 href="show_229_224.html">问答题29</A> </li><li ><A title=问答题30 href="show_230_224.html">问答题30</A> </li><li ><A title=问答题31 href="show_231_224.html">问答题31</A> </li><li ><A title=问答题32 href="show_232_224.html">问答题32</A> </li><li ><A title=问答题33 href="show_233_224.html">问答题33</A> </li><li ><A title=问答题34 href="show_234_224.html">问答题34</A> </li><li ><A title=问答题35 href="show_235_224.html">问答题35</A> </li><li ><A title=问答题36 href="show_236_224.html">问答题36</A> </li><li ><A title=问答题37 href="show_237_224.html">问答题37</A> </li><li class="currentLink"><A title=问答题38 href="show_238_224.html">问答题38</A> </li><li ><A title=问答题39 href="show_239_224.html">问答题39</A> </li><li ><A title=问答题40 href="show_240_224.html">问答题40</A> </li><li ><A title=问答题41 href="show_241_224.html">问答题41</A> </li><li ><A title=问答题42 href="show_242_224.html">问答题42</A> </li><li ><A title=问答题43 href="show_243_224.html">问答题43</A> </li><li ><A title=问答题44 href="show_244_224.html">问答题44</A> </li><li ><A title=问答题45 href="show_245_224.html">问答题45</A> </li><li ><A title=问答题46 href="show_246_224.html">问答题46</A> </li><li ><A title=问答题47 href="show_247_224.html">问答题47</A> </li><li ><A title=问答题48 href="show_248_224.html">问答题48</A> </li><li ><A title=问答题49 href="show_249_224.html">问答题49</A> </li><li ><A title=问答题50 href="show_250_224.html">问答题50</A> </li><li ><A title=问答题51 href="show_251_224.html">问答题51</A> </li><li ><A title=问答题52 href="show_252_224.html">问答题52</A> </li><li ><A title=问答题53 href="show_253_224.html">问答题53</A> </li><li ><A title=问答题54 href="show_254_224.html">问答题54</A> </li><li ><A title=问答题55 href="show_255_224.html">问答题55</A> </li></UL>
</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>问答题38</H2>
<div style="line-height:20px; font-size:14px;"><p>请解释下在单线程模型中Message、Handler、Message Queue、Looper之间的关系。</p><p>答：简单的说，Handler获取当前线程中的looper对象，looper用来从存放Message的MessageQueue中取出Message，再有Handler进行Message的分发和处理.</p><p>Message Queue(消息队列)：用来存放通过Handler发布的消息，通常附属于某一个创建它的线程，可以通过Looper.myQueue()得到当前线程的消息队列</p><p>Handler：可以发布或者处理一个消息或者操作一个Runnable，通过Handler发布消息，消息将只会发送到与它关联的消息队列，然也只能处理该消息队列中的消息</p><p>Looper：是Handler和消息队列之间通讯桥梁，程序组件首先通过Handler把消息传递给Looper，Looper把消息放入队列。Looper也把消息队列里的消息广播给所有的</p><p>Handler：Handler接受到消息后调用handleMessage进行处理</p><p>Message：消息的类型，在Handler类中的handleMessage方法中得到单个的消息进行处理</p><p>在单线程模型下，为了线程通信问题，Android设计了一个Message Queue(消息队列)， 线程间可以通过该Message Queue并结合Handler和Looper组件进行信息交换。下面将对它们进行分别介绍：</p><p style="color:#3333FF;">1. Message </p><p>Message消息，理解为线程间交流的信息，处理数据后台线程需要更新UI，则发送Message内含一些数据给UI线程。</p><p style="color:#3333FF;">2. Handler </p><p>Handler处理者，是Message的主要处理者，负责Message的发送，Message内容的执行处理。后台线程就是通过传进来的Handler对象引用来sendMessage(Message)。而使用Handler，需要implement 该类的 handleMessage(Message)方法，它是处理这些Message的操作内容，例如Update UI。通常需要子类化Handler来实现handleMessage方法。</p><p style="color:#3333FF;">3. Message Queue </p><p>Message Queue消息队列，用来存放通过Handler发布的消息，按照先进先出执行。</p><p>每个message queue都会有一个对应的Handler。Handler会向message queue通过两种方法发送消息：sendMessage或post。这两种消息都会插在message queue队尾并按先进先出执行。但通过这两种方法发送的消息执行的方式略有不同：通过sendMessage发送的是一个message对象,会被Handler的handleMessage()函数处理；而通过post方法发送的是一个runnable对象，则会自己执行。</p><p style="color:#3333FF;">4. Looper </p><p>Looper是每条线程里的Message Queue的管家。Android没有Global的Message Queue，而Android会自动替主线程(UI线程)建立Message Queue，但在子线程里并没有建立Message Queue。所以调用Looper.getMainLooper()得到的主线程的Looper不为NULL，但调用Looper.myLooper()得到当前线程的Looper就有可能为NULL。对于子线程使用Looper，API Doc提供了正确的使用方法：这个Message机制的大概流程：</p><p>1. 在Looper.loop()方法运行开始后，循环地按照接收顺序取出Message Queue里面的非NULL的Message。</p><p>2. 一开始Message Queue里面的Message都是NULL的。当Handler.sendMessage(Message)到Message Queue，该函数里面设置了那个Message对象的target属性是当前的Handler对象。随后Looper取出了那个Message，则调用该Message的target指向的Hander的dispatchMessage函数对Message进行处理。在dispatchMessage方法里，如何处理Message则由用户指定，三个判断，优先级从高到低：</p><p>1) Message里面的Callback，一个实现了Runnable接口的对象，其中run函数做处理工作；</p><p>2) Handler里面的mCallback指向的一个实现了Callback接口的对象，由其handleMessage进行处理；</p><p>3) 处理消息Handler对象对应的类继承并实现了其中handleMessage函数，通过这个实现的handleMessage函数处理消息。</p><p>由此可见，我们实现的handleMessage方法是优先级最低的！</p><p>3. Handler处理完该Message (update UI) 后，Looper则设置该Message为NULL，以便回收！</p><p>在网上有很多文章讲述主线程和其他子线程如何交互，传送信息，最终谁来执行处理信息之类的，个人理解是最简单的方法——判断Handler对象里面的Looper对象是属于哪条线程的，则由该线程来执行！ </p><p>1. 当Handler对象的构造函数的参数为空，则为当前所在线程的Looper； </p><p>2. Looper.getMainLooper()得到的是主线程的Looper对象，Looper.myLooper()得到的是当前线程的Looper对象。</p><p></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

