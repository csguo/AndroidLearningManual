
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android中HTTP通信和XML解析_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li class="navcurrentLink"><A href="index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="3G" href="index_177.html">3G</A></h2>

  <h2><A title="WIFI" href="index_178.html">WIFI</A></h2>

  <h2><A title="蓝牙" href="index_179.html">蓝牙</A></h2>

  <h2><A title="HTTP协议" href="index_180.html">HTTP协议</A></h2>
<UL><li ><A title=网络开发必备的HTTP协议知识 href="show_301_180.html">网络开发必备的HTTP协议知识</A> </li><li ><A title=Android通过http协议数据交互 href="show_302_180.html">Android通过http协议数据交互</A> </li><li ><A title=Android通过https协议与服务器端进行通信 href="show_303_180.html">Android通过https协议与服务器端进行通信</A> </li><li ><A title=Android HTTP服务实例（一） href="show_304_180.html">Android HTTP服务实例（一）</A> </li><li ><A title=Android HTTP服务实例（二） href="show_305_180.html">Android HTTP服务实例（二）</A> </li><li ><A title=Android HTTP服务实例（三） href="show_306_180.html">Android HTTP服务实例（三）</A> </li><li class="currentLink"><A title=Android中HTTP通信和XML解析 href="show_307_180.html">Android中HTTP通信和XML解析</A> </li><li ><A title=关于HTTP协议中的KeepAlive属性 href="show_308_180.html">关于HTTP协议中的KeepAlive属性</A> </li><li ><A title=Android Http下载文件到手机内存与SDCard href="show_309_180.html">Android Http下载文件到手机内存与SDCard</A> </li><li ><A title=Android中发送Http请求实例（包括文件上传、servlet接收） href="show_310_180.html">Android中发送Http请求实例（包括文件上传、servlet接收）</A> </li><li ><A title=Android使用http协议上传文件 href="show_311_180.html">Android使用http协议上传文件</A> </li><li ><A title=关于Android Http访问,上传 href="show_312_180.html">关于Android Http访问,上传</A> </li><li ><A title=在Android中发送HTTP POST请求示范 href="show_313_180.html">在Android中发送HTTP POST请求示范</A> </li></UL>
  <h2><A title="Socket" href="index_181.html">Socket</A></h2>

  <h2><A title="HTML与HTML5" href="index_182.html">HTML与HTML5</A></h2>

  <h2><A title="JavaScript" href="index_183.html">JavaScript</A></h2>

  <h2><A title="Email" href="index_184.html">Email</A></h2>

  <h2><A title="NFC" href="index_185.html">NFC</A></h2>

  <h2><A title="Web Service" href="index_186.html">Web Service</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android中HTTP通信和XML解析</H2>
<div style="line-height:20px; font-size:14px;"><p>我们要记住的就是HTTP通信与服务端做HTTP通信，分别以GET方式和POST方式做演示。XML解析可以用两种方式解析XML，分别是DOM方式和SAX方式。异步消息处理-通过Handler实现异步消息处理，以一个自定义的异步下载类来说明Handler的用法。现在我们大家应该明白HTTP和xml了吧，那我们就来看看代码是怎么写的吧，代码中有注释。下面的代码很长大家可要仔细看。</p><p><pre><font class="keyword">import </font>java.io.BufferedInputStream;</p><p><font class="keyword">import </font>java.io.BufferedReader;</p><p><font class="keyword">import </font>java.io.IOException;</p><p><font class="keyword">import </font>java.io.InputStream;</p><p><font class="keyword">import </font>java.io.InputStreamReader;</p><p><font class="keyword">import </font>java.net.HttpURLConnection;</p><p><font class="keyword">import </font>java.net.URL;</p><p><font class="keyword">import </font>java.net.URLConnection;</p><p><font class="keyword">import </font>java.util.ArrayList;</p><p><font class="keyword">import </font>java.util.HashMap;</p><p><font class="keyword">import </font>java.util.Map;</p><p><font class="keyword">import </font>javax.xml.parsers.DocumentBuilder;</p><p><font class="keyword">import </font>javax.xml.parsers.DocumentBuilderFactory;</p><p><font class="keyword">import </font>javax.xml.parsers.SAXParser;</p><p><font class="keyword">import </font>javax.xml.parsers.SAXParserFactory;</p><p><font class="keyword">import </font>org.apache.http.HttpEntity;</p><p><font class="keyword">import </font>org.apache.http.HttpResponse;</p><p><font class="keyword">import </font>org.apache.http.client.entity.UrlEncodedFormEntity;</p><p><font class="keyword">import </font>org.apache.http.client.methods.HttpPost;</p><p><font class="keyword">import </font>org.apache.http.impl.client.DefaultHttpClient;</p><p><font class="keyword">import </font>org.apache.http.message.BasicNameValuePair;</p><p><font class="keyword">import </font>org.apache.http.protocol.HTTP;</p><p><font class="keyword">import </font>org.apache.http.util.ByteArrayBuffer;</p><p><font class="keyword">import </font>org.apache.http.util.EncodingUtils;</p><p><font class="keyword">import </font>org.w3c.dom.Document;</p><p><font class="keyword">import </font>org.w3c.dom.Element;</p><p><font class="keyword">import </font>org.w3c.dom.NodeList;</p><p><font class="keyword">import </font>org.xml.sax.InputSource;</p><p><font class="keyword">import </font>org.xml.sax.XMLReader;</p><p><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.view.View;</p><p><font class="keyword">import </font>android.widget.Button;</p><p><font class="keyword">import </font>android.widget.TextView;</p><p><font class="keyword">public </font><font class="keyword">class </font>Main </font><font class="keyword">extends </font>Activity {</p><p>	<font class="keyword">private </font>TextView textView;</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate(Bundle savedInstanceState) {</p><p>		<font class="keyword">super</font>.onCreate(savedInstanceState);</p><p>		setContentView(R.layout.main);</p><p>		</font>textView = (TextView) <font class="keyword">this</font>.findViewById(R.id.textView);</p><p>		</font>Button btn1 = (Button) <font class="keyword">this</font>.findViewById(R.id.btn1);</p><p>		</font>btn1.setText(<font class="Fields">"http get demo"</font>);</p><p>		</font>btn1.setOnClickListener(<font class="keyword">new </font>Button.OnClickListener() {</p><p>			<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>				httpGetDemo();</p><p>			}</p><p>		});</p><p>		</font>Button btn2 = (Button) <font class="keyword">this</font>.findViewById(R.id.btn2);</p><p>		</font>btn2.setText(<font class="Fields">"http post demo"</font>);</p><p>		</font>btn2.setOnClickListener(<font class="keyword">new </font>Button.OnClickListener() {</p><p>			<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>				httpPostDemo();</p><p>			}</p><p>		});</p><p>		</font>Button btn3 = (Button) <font class="keyword">this</font>.findViewById(R.id.btn3);</p><p>		<font class="Comments">// DOM - Document Object Model</font></p><p>		</font>btn3.setText(<font class="Fields">"DOM 解析 XML"</font>);</p><p>		</font>btn3.setOnClickListener(<font class="keyword">new </font>Button.OnClickListener() {</p><p>			<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>				DOMDemo();</p><p>			}</p><p>		});</p><p>		</font>Button btn4 = (Button) <font class="keyword">this</font>.findViewById(R.id.btn4);</p><p>		<font class="Comments">// SAX - Simple API for XML</font></p><p>		</font>btn4.setText(<font class="Fields">"SAX 解析 XML"</font>);</p><p>		</font>btn4.setOnClickListener(<font class="keyword">new </font>Button.OnClickListener() {</p><p>			<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>				SAXDemo();</p><p>			}</p><p>		});</p><p>	}</p><p>	<font class="Comments">// Android 调用 http 协议的 get 方法</font></p><p>	<font class="Comments">// 本例：以 http 协议的 get 方法获取远程页面响应的内容</font></p><p>	<font class="keyword">private </font><font class="keyword">void </font>httpGetDemo() {</p><p>		<font class="keyword">try </font>{</p><p>			<font class="Comments">// 模拟器测试时，请使用外网地址</font></p><p>			</font>URL url = <font class="keyword">new </font>URL(<font class="Fields">"http:<font class="Comments">//xxx.xxx.xxx"</font>);</font></p><p>			URLConnection con = url.openConnection();</p><p>			</font>String result = <font class="Fields">"http status code:</p><p>					</font>+ ((HttpURLConnection) con).getResponseCode() + <font class="Fields">"\n"</font>;</p><p>			<font class="Comments">// HttpURLConnection.HTTP_OK</font></p><p>			InputStream is = con.getInputStream();</p><p>			</font>BufferedInputStream bis = <font class="keyword">new </font>BufferedInputStream(is);</p><p>			</font>ByteArrayBuffer bab = <font class="keyword">new </font>ByteArrayBuffer(32);</p><p>			<font class="keyword">int </font>current = 0;</p><p>			<font class="keyword">while </font>((current = bis.read()) != -1) {</p><p>				bab.append((byte) current);</p><p>			}</p><p>			result += EncodingUtils.getString(bab.toByteArray(), HTTP.UTF_8);</p><p>			bis.close();</p><p>			is.close();</p><p>			textView.setText(result);</p><p>		</font>} <font class="keyword">catch </font>(Exception e) {</p><p>			textView.setText(e.toString());</p><p>		}</p><p>	}</p><p>	<font class="Comments">// Android 调用 http 协议的 post 方法</font></p><p>	<font class="Comments">// 本例：以 http 协议的 post 方法向远程页面传递参数，并获取其响应的内容</font></p><p>	<font class="keyword">private </font><font class="keyword">void </font>httpPostDemo() {</p><p>		<font class="keyword">try </font>{</p><p>			<font class="Comments">// 模拟器测试时，请使用外网地址</font></p><p>			</font>String url = <font class="Fields">"http:<font class="Comments">//5billion.com.cn/post.php"</font>;</font></p><p>			</font>Map&lt;String, String&gt; data = <font class="keyword">new </font>HashMap&lt;String, String&gt;();</p><p>			</font>data.put(<font class="Fields">"name"</font>, </font><font class="Fields">"webabcd"</font>);</p><p>			</font>data.put(<font class="Fields">"salary"</font>, </font><font class="Fields">"100"</font>);</p><p>			</font>DefaultHttpClient httpClient = <font class="keyword">new </font>DefaultHttpClient();</p><p>			</font>HttpPost httpPost = <font class="keyword">new </font>HttpPost(url);</p><p>			</font>ArrayList&lt;BasicNameValuePair&gt; postData = <font class="keyword">new </font>ArrayList&lt;BasicNameValuePair&gt;();</p><p>			<font class="keyword">for </font>(Map.Entry&lt;String, String&gt; m : data.entrySet()) {</p><p>				</font>postData.add(<font class="keyword">new </font>BasicNameValuePair(m.getKey(), m.getValue()));</p><p>			}</p><p>			</font>UrlEncodedFormEntity entity = <font class="keyword">new </font>UrlEncodedFormEntity(postData,</p><p>					HTTP.UTF_8);</p><p>			httpPost.setEntity(entity);</p><p>			HttpResponse response = httpClient.execute(httpPost);</p><p>			</font>String result = <font class="Fields">"http status code:</p><p>					</font>+ response.getStatusLine().getStatusCode() + <font class="Fields">"\n"</font>;</p><p>			<font class="Comments">// HttpURLConnection.HTTP_OK</font></p><p>			HttpEntity httpEntity = response.getEntity();</p><p>			InputStream is = httpEntity.getContent();</p><p>			result += convertStreamToString(is);</p><p>			textView.setText(result);</p><p>		</font>} <font class="keyword">catch </font>(Exception e) {</p><p>			textView.setText(e.toString());</p><p>		}</p><p>	}</p><p>	<font class="Comments">// 以 DOM 方式解析 XML（xml 数据详见 res/raw/employee.xml）</font></p><p>	<font class="keyword">private </font><font class="keyword">void </font>DOMDemo() {</p><p>		<font class="keyword">try </font>{</p><p>			DocumentBuilderFactory docFactory = DocumentBuilderFactory</p><p>					.newInstance();</p><p>			DocumentBuilder docBuilder = docFactory.newDocumentBuilder();</p><p>			</font>Document doc = docBuilder.parse(<font class="keyword">this</font>.getResources()</p><p>					.openRawResource(R.raw.employee));</p><p>			Element rootElement = doc.getDocumentElement();</p><p>			NodeList employeeNodeList = rootElement</p><p>					</font>.getElementsByTagName(<font class="Fields">"employee"</font>);</p><p></p><p>			</font>textView.setText(<font class="Fields">"DOMDemo"</font> + </font><font class="Fields">"\n"</font>);</p><p>			</font>String title = rootElement.getElementsByTagName(<font class="Fields">"title"</font>).item(0)</p><p>					.getFirstChild().getNodeValue();</p><p>			textView.append(title);</p><p>			<font class="keyword">for </font>(</font><font class="keyword">int </font>i = 0; i &lt; employeeNodeList.getLength(); i++) {</p><p>				Element employeeElement = ((Element) employeeNodeList.item(i));</p><p>				</font>String name = employeeElement.getAttribute(<font class="Fields">"name"</font>);</p><p>				</font>String salary = employeeElement.getElementsByTagName(<font class="Fields">"salary"</font>)</p><p>						.item(0).getFirstChild().getNodeValue();</p><p>				String dateOfBirth = employeeElement</p><p>						</font>.getElementsByTagName(<font class="Fields">"dateOfBirth"</font>).item(0)</p><p>						.getFirstChild().getNodeValue();</p><p>				</font>textView.append(<font class="Fields">"\nname: "</font> + name + </font><font class="Fields">" salary: "</font> + salary</p><p>						</font>+ <font class="Fields">" dateOfBirth: "</font> + dateOfBirth);</p><p>			}</p><p>		</font>} <font class="keyword">catch </font>(Exception e) {</p><p>			textView.setText(e.toString());</p><p>		}</p><p>	}</p><p>	<font class="Comments">// 以 SAX 方式解析 XML（xml 数据详见 res/raw/employee.xml）</font></p><p>	<font class="Comments">// SAX 解析器的实现详见 MySAXHandler.java</font></p><p>	<font class="keyword">private </font><font class="keyword">void </font>SAXDemo() {</p><p>		<font class="keyword">try </font>{</p><p>			SAXParserFactory saxFactory = SAXParserFactory.newInstance();</p><p>			SAXParser parser = saxFactory.newSAXParser();</p><p>			XMLReader reader = parser.getXMLReader();</p><p></p><p>			</font>MySAXHandler handler = <font class="keyword">new </font>MySAXHandler();</p><p>			reader.setContentHandler(handler);</p><p>			</font>reader.parse(<font class="keyword">new </font>InputSource(</font><font class="keyword">this</font>.getResources().openRawResource(</p><p>					R.raw.employee)));</p><p>			String result = handler.getResult();</p><p>			</font>textView.setText(<font class="Fields">"SAXDemo"</font> + </font><font class="Fields">"\n"</font>);</p><p>			textView.append(result);</p><p>		</font>} <font class="keyword">catch </font>(Exception e) {</p><p>			textView.setText(e.toString());</p><p>		}</p><p>	}</p><p>	<font class="Comments">// 辅助方法，用于把流转换为字符串</font></p><p>	<font class="keyword">private </font>String convertStreamToString(InputStream is) {</p><p>		</font>BufferedReader reader = <font class="keyword">new </font>BufferedReader(</font><font class="keyword">new </font>InputStreamReader(is));</p><p>		</font>StringBuilder sb = <font class="keyword">new </font>StringBuilder();</p><p></p><p>		</font>String line = <font class="keyword">null</font>;</p><p>		<font class="keyword">try </font>{</p><p>			<font class="keyword">while </font>((line = reader.readLine()) != </font><font class="keyword">null</font>) {</p><p>				</font>sb.append(line + <font class="Fields">"\n"</font>);</p><p>			}</p><p>		</font>} <font class="keyword">catch </font>(IOException e) {</p><p>			e.printStackTrace();</p><p>		} finally {</p><p>			<font class="keyword">try </font>{</p><p>				is.close();</p><p>			</font>} <font class="keyword">catch </font>(IOException e) {</p><p>				e.printStackTrace();</p><p>			}</p><p>		}</p><p>		<font class="keyword">return </font>sb.toString();</p><p>	}</p><p>}</p><p></pre></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

