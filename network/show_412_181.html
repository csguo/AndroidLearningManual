
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android与PC的socket通信_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li class="navcurrentLink"><A href="index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="3G" href="index_177.html">3G</A></h2>

  <h2><A title="WIFI" href="index_178.html">WIFI</A></h2>

  <h2><A title="蓝牙" href="index_179.html">蓝牙</A></h2>

  <h2><A title="HTTP协议" href="index_180.html">HTTP协议</A></h2>

  <h2><A title="Socket" href="index_181.html">Socket</A></h2>
<UL><li ><A title=Android 浅谈Socket（一） href="show_401_181.html">Android 浅谈Socket（一）</A> </li><li ><A title=Android 浅谈Socket（二） href="show_402_181.html">Android 浅谈Socket（二）</A> </li><li ><A title=Socket编程(多线程、双向通信) href="show_403_181.html">Socket编程(多线程、双向通信)</A> </li><li ><A title=Android开发之socket通信向PC机发信息获取本机IP href="show_404_181.html">Android开发之socket通信向PC机发信息获取本机IP</A> </li><li ><A title=Http和Socket区别 href="show_405_181.html">Http和Socket区别</A> </li><li ><A title=PC客户端与Android服务端的Socket同步通信（一） href="show_406_181.html">PC客户端与Android服务端的Socket同步通信（一）</A> </li><li ><A title=PC客户端与Android服务端的Socket同步通信（二） href="show_407_181.html">PC客户端与Android服务端的Socket同步通信（二）</A> </li><li ><A title=PC客户端与Android服务端的Socket同步通信（三） href="show_408_181.html">PC客户端与Android服务端的Socket同步通信（三）</A> </li><li ><A title=Android解析socket流 href="show_409_181.html">Android解析socket流</A> </li><li ><A title=Android 实例Socket发送Http请求 href="show_410_181.html">Android 实例Socket发送Http请求</A> </li><li ><A title=Android socket和seversocket的用法 href="show_411_181.html">Android socket和seversocket的用法</A> </li><li class="currentLink"><A title=Android与PC的socket通信 href="show_412_181.html">Android与PC的socket通信</A> </li><li ><A title=测试Android作为客户端使用socket网络编程连接到数据库 href="show_413_181.html">测试Android作为客户端使用socket网络编程连接到数据库</A> </li></UL>
  <h2><A title="HTML与HTML5" href="index_182.html">HTML与HTML5</A></h2>

  <h2><A title="JavaScript" href="index_183.html">JavaScript</A></h2>

  <h2><A title="Email" href="index_184.html">Email</A></h2>

  <h2><A title="NFC" href="index_185.html">NFC</A></h2>

  <h2><A title="Web Service" href="index_186.html">Web Service</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android与PC的socket通信</H2>
<div style="line-height:20px; font-size:14px;"><p>我们今天就来说说android怎么样才能和PC通信，这个我们就要用到socket了，那么我们现在就来用一个小例子来看看。在代码中我都用了注释。</p><p><pre><font class="keyword">import </font>java.io.BufferedReader;</p><p><font class="keyword">import </font>java.io.BufferedWriter;</p><p><font class="keyword">import </font>java.io.IOException;</p><p><font class="keyword">import </font>java.io.InputStreamReader;</p><p><font class="keyword">import </font>java.io.OutputStreamWriter;</p><p><font class="keyword">import </font>java.net.ServerSocket;</p><p><font class="keyword">import </font>java.net.Socket;</p><p><font class="keyword">public </font><font class="keyword">class </font>YaoChatServer </font><font class="keyword">extends </font>Thread {</p><p>	<font class="keyword">private </font>YaoChatServer() </font><font class="keyword">throws </font>IOException {</p><p>		CreateSocket();</p><p>		<font class="Comments">// 创建Socket服务器</font></p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>run() {</p><p>		Socket client;</p><p>		String txt;</p><p>		<font class="keyword">try </font>{</p><p>			<font class="keyword">while </font>(</font><font class="keyword">true</font>)</p><p>			<font class="Comments">// 线程无限循环，实时监听socket端口</font></p><p>			{</p><p>				client = ResponseSocket();</p><p>				<font class="Comments">// 响应客户端链接请求。。</font></p><p>				<font class="keyword">while </font>(</font><font class="keyword">true</font>) {</p><p>					txt = ReceiveMsg(client);</p><p>					</font>System.<font class="Fields">out</font>.println(txt);</p><p>					<font class="Comments">// 链接获得客户端发来消息，并将其显示在Server端的屏幕上</font></p><p>					SendMsg(client, txt);</p><p>					<font class="Comments">// 向客户端返回消息</font></p><p>					<font class="keyword">if </font>(</font><font class="keyword">true</font>)</p><p>						<font class="keyword">break</font>;</p><p>					<font class="Comments">// 中断，继续等待链接请求</font></p><p>				}</p><p>				CloseSocket(client);</p><p>				<font class="Comments">// 关闭此次链接</font></p><p>			}</p><p>		</font>} <font class="keyword">catch </font>(IOException e) {</p><p>			</font>System.<font class="Fields">out</font>.println(e);</p><p>		}</p><p>	}</p><p>	<font class="keyword">private </font>ServerSocket server = </font><font class="keyword">null</font>;</p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>PORT = 5000;</p><p>	<font class="keyword">private </font>BufferedWriter writer;</p><p>	<font class="keyword">private </font>BufferedReader reader;</p><p>	<font class="keyword">private </font><font class="keyword">void </font>CreateSocket() </font><font class="keyword">throws </font>IOException {</p><p>		</font>server = <font class="keyword">new </font>ServerSocket(PORT, 100);</p><p>		</font>System.<font class="Fields">out</font>.println(</font><font class="Fields">"Server starting.."</font>);</p><p>	}</p><p>	<font class="keyword">private </font>Socket ResponseSocket() </font><font class="keyword">throws </font>IOException {</p><p>		Socket client = server.accept();</p><p>		</font>System.<font class="Fields">out</font>.println(</font><font class="Fields">"client connected.."</font>);</p><p>		<font class="keyword">return </font>client;</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>CloseSocket(Socket socket) </font><font class="keyword">throws </font>IOException {</p><p>		reader.close();</p><p>		writer.close();</p><p>		socket.close();</p><p>		</font>System.<font class="Fields">out</font>.println(</font><font class="Fields">"client closed.."</font>);</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>SendMsg(Socket socket, String Msg) </font><font class="keyword">throws </font>IOException {</p><p>		</font>writer = <font class="keyword">new </font>BufferedWriter(</font><font class="keyword">new </font>OutputStreamWriter(</p><p>				socket.getOutputStream()));</p><p>		</font>writer.write(Msg + <font class="Fields">"\n"</font>);</p><p>		writer.flush();</p><p>	}</p><p>	<font class="keyword">private </font>String ReceiveMsg(Socket socket) </font><font class="keyword">throws </font>IOException {</p><p>		</font>reader = <font class="keyword">new </font>BufferedReader(</font><font class="keyword">new </font>InputStreamReader(</p><p>				socket.getInputStream()));</p><p>		</font>System.<font class="Fields">out</font>.println(</font><font class="Fields">"server get input from client socket.."</font>);</p><p>		</font>String txt = <font class="Fields">"Sever send:"</font> + reader.readLine();</p><p>		<font class="keyword">return </font>txt;</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">static </font><font class="keyword">void </font>main(</font><font class="keyword">final </font>String args[]) </font><font class="keyword">throws </font>IOException {</p><p>		</font>YaoChatServer yaochatserver = <font class="keyword">new </font>YaoChatServer();</p><p>		<font class="keyword">if </font>(yaochatserver != </font><font class="keyword">null</font>) {</p><p>			yaochatserver.start();</p><p>		}</p><p>	}</p><p>}</p><p></pre></p><p>代码如下：</p><p><pre><font class="keyword">import </font>java.io.BufferedReader;</p><p><font class="keyword">import </font>java.io.BufferedWriter;</p><p><font class="keyword">import </font>java.io.IOException;</p><p><font class="keyword">import </font>java.net.UnknownHostException;</p><p><font class="keyword">import </font>java.io.InputStreamReader;</p><p><font class="keyword">import </font>java.io.OutputStreamWriter;</p><p><font class="keyword">import </font>java.net.Socket;</p><p><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.view.View;</p><p><font class="keyword">import </font>android.widget.*;</p><p><font class="keyword">public </font><font class="keyword">class </font>YaoChatRoomAndroid </font><font class="keyword">extends </font>Activity {</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate(Bundle savedInstanceState) {</p><p>		<font class="keyword">super</font>.onCreate(savedInstanceState);</p><p>		setContentView(R.layout.main);</p><p>		findviews();</p><p>		setonclick();</p><p>	}</p><p>	<font class="keyword">private </font>EditText chattxt;</p><p>	<font class="keyword">private </font>TextView chattxt2;</p><p>	<font class="keyword">private </font>Button chatok;</p><p>	<font class="keyword">public </font><font class="keyword">void </font>findviews() {</p><p>		</font>chattxt = (EditText) <font class="keyword">this</font>.findViewById(R.id.chattxt);</p><p>		</font>chattxt2 = (TextView) <font class="keyword">this</font>.findViewById(R.id.chattxt2);</p><p>		</font>chatok = (Button) <font class="keyword">this</font>.findViewById(R.id.chatOk);</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>setonclick() {</p><p>		</font>chatok.setOnClickListener(<font class="keyword">new </font>View.OnClickListener() {</p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">void </font>onClick(View v) {</p><p>				<font class="keyword">try </font>{</p><p>					connecttoserver(chattxt.getText().toString());</p><p>				</font>} <font class="keyword">catch </font>(UnknownHostException e) {</p><p>					e.printStackTrace();</p><p>				</font>} <font class="keyword">catch </font>(IOException e) {</p><p>					e.printStackTrace();</p><p>				}</p><p>			}</p><p>		});</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>connecttoserver(String socketData) </font><font class="keyword">throws </font>UnknownHostException,</p><p>			IOException {</p><p>		</font>Socket socket = RequestSocket(<font class="Fields">"192.168.10.119"</font>, 5000);</p><p>		SendMsg(socket, socketData);</p><p>		String txt = ReceiveMsg(socket);</p><p>		<font class="keyword">this</font>.chattxt2.setText(txt);</p><p>	}</p><p>	<font class="keyword">private </font>Socket RequestSocket(String host, </font><font class="keyword">int </font>port)</p><p>			<font class="keyword">throws </font>UnknownHostException, IOException {</p><p>		</font>Socket socket = <font class="keyword">new </font>Socket(host, port);</p><p>		<font class="keyword">return </font>socket;</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>SendMsg(Socket socket, String msg) </font><font class="keyword">throws </font>IOException {</p><p>		</font>BufferedWriter writer = <font class="keyword">new </font>BufferedWriter(</font><font class="keyword">new </font>OutputStreamWriter(</p><p>				socket.getOutputStream()));</p><p>		</font>writer.write(msg.replace(<font class="Fields">"\n"</font>, </font><font class="Fields">" "</font>) + </font><font class="Fields">"\n"</font>);</p><p>		writer.flush();</p><p>	}</p><p>	<font class="keyword">private </font>String ReceiveMsg(Socket socket) </font><font class="keyword">throws </font>IOException {</p><p>		</font>BufferedReader reader = <font class="keyword">new </font>BufferedReader(</font><font class="keyword">new </font>InputStreamReader(</p><p>				socket.getInputStream()));</p><p>		String txt = reader.readLine();</p><p>		<font class="keyword">return </font>txt;</p><p>	}</p><p>}</p><p></pre></p><p>配置文件如下：</p><p><pre>&lt;?xml version=<font class="Fields">"1.0"</font> encoding=</font><font class="Fields">"utf-8"</font>?&gt;</p><p>&lt;LinearLayout xmlns:android=<font class="Fields">"http:<font class="Comments">//schemas.android.com/apk/res/android</font></p><p>    </font>android:layout_width=<font class="Fields">"fill_parent</p><p>    </font>android:layout_height=<font class="Fields">"fill_parent</p><p>    </font>android:orientation=<font class="Fields">"vertical"</font> &gt;</p><p>    &lt;TextView</p><p>        </font>android:id=<font class="Fields">"@+id/chattxt2</p><p>        </font>android:layout_width=<font class="Fields">"319px</p><p>        </font>android:layout_height=<font class="Fields">"68px</p><p>        </font>android:layout_alignParentLeft=<font class="Fields">"<font class="keyword">true</font></p><p>        </font>android:layout_alignParentTop=<font class="Fields">"<font class="keyword">true</font></p><p>        </font>android:text=<font class="Fields">"TextView"</font> &gt;</p><p>    &lt;/TextView&gt;</p><p>    &lt;EditText</p><p>        </font>android:id=<font class="Fields">"@+id/chattxt</p><p>        </font>android:layout_width=<font class="Fields">"319px</p><p>        </font>android:layout_height=<font class="Fields">"52px</p><p>        </font>android:layout_alignParentLeft=<font class="Fields">"<font class="keyword">true</font></p><p>        </font>android:layout_below=<font class="Fields">"@+id/widget30</p><p>        </font>android:text=<font class="Fields">"EditText</p><p>        </font>android:textSize=<font class="Fields">"18sp"</font> &gt;</p><p>    &lt;/EditText&gt;</p><p>    &lt;Button</p><p>        </font>android:id=<font class="Fields">"@+id/chatOk</p><p>        </font>android:layout_width=<font class="Fields">"320px</p><p>        </font>android:layout_height=<font class="Fields">"41px</p><p>        </font>android:layout_alignParentLeft=<font class="Fields">"<font class="keyword">true</font></p><p>        </font>android:layout_below=<font class="Fields">"@+id/widget29</p><p>        </font>android:text=<font class="Fields">"Button"</font> &gt;</p><p>    &lt;/Button&gt;</p><p>&lt;/LinearLayout&gt;</p><p></pre></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

