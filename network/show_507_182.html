
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android and HTML5 开发手机应用(转载)_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li class="navcurrentLink"><A href="index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="3G" href="index_177.html">3G</A></h2>

  <h2><A title="WIFI" href="index_178.html">WIFI</A></h2>

  <h2><A title="蓝牙" href="index_179.html">蓝牙</A></h2>

  <h2><A title="HTTP协议" href="index_180.html">HTTP协议</A></h2>

  <h2><A title="Socket" href="index_181.html">Socket</A></h2>

  <h2><A title="HTML与HTML5" href="index_182.html">HTML与HTML5</A></h2>
<UL><li ><A title=Android TextView中显示HTML和图片 href="show_501_182.html">Android TextView中显示HTML和图片</A> </li><li ><A title=HttpClient和URLConnection两种下载HTML href="show_502_182.html">HttpClient和URLConnection两种下载HTML</A> </li><li ><A title=webview与HTML加载自适应问题解决方案 href="show_503_182.html">webview与HTML加载自适应问题解决方案</A> </li><li ><A title=Android中构建HTML5应用 href="show_504_182.html">Android中构建HTML5应用</A> </li><li ><A title=Android下的另一个开发选择——HTML5 href="show_505_182.html">Android下的另一个开发选择——HTML5</A> </li><li ><A title=Android与iOS：谁更适合HTML 5？ href="show_506_182.html">Android与iOS：谁更适合HTML 5？</A> </li><li class="currentLink"><A title=Android and HTML5 开发手机应用(转载) href="show_507_182.html">Android and HTML5 开发手机应用(转载)</A> </li><li ><A title=HTML 5是不是解决跨平台问题的终极密钥 href="show_508_182.html">HTML 5是不是解决跨平台问题的终极密钥</A> </li><li ><A title=HTML5能取代Android和iOS应用程序吗？(转载) href="show_509_182.html">HTML5能取代Android和iOS应用程序吗？(转载)</A> </li><li ><A title=Android webkit HTML5 video研究 href="show_510_182.html">Android webkit HTML5 video研究</A> </li><li ><A title=将HTML5封装成android应用APK文件若干方法 href="show_511_182.html">将HTML5封装成android应用APK文件若干方法</A> </li><li ><A title=七个特点告诉你 HTML5技术到底怎么样 href="show_512_182.html">七个特点告诉你 HTML5技术到底怎么样</A> </li><li ><A title=十大中间工具和HTML5技术应用解析 href="show_513_182.html">十大中间工具和HTML5技术应用解析</A> </li></UL>
  <h2><A title="JavaScript" href="index_183.html">JavaScript</A></h2>

  <h2><A title="Email" href="index_184.html">Email</A></h2>

  <h2><A title="NFC" href="index_185.html">NFC</A></h2>

  <h2><A title="Web Service" href="index_186.html">Web Service</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android and HTML5 开发手机应用(转载)</H2>
<div style="line-height:20px; font-size:14px;"><p>作为一个WEB开发者，HTML5让我兴奋，因为它可以将桌面应用程序功能带入浏览器中。但在国内，看着到处横行的IE8版本以下的浏览器，觉得到能大规模使用HTML5技术的那天，还遥遥无期。但面对iOS及Android等平台的手机用户越来越多，基于Webkit内核的移动浏览器一定能让HTML5先大规模应用起来。这将对对移动Web应用程序开发具有重大影响。</p><p>作为非常看好未来手机网络的我，也在一直研究Android平台的应用的开发，也许是因为自己更熟悉HTML及CSS、JS，并受到之前使用HTML和VC开发程序的影响，我也更愿意使用HTML来做Android程序的UI….</p><p>09年，在开发《华夏风云》游戏的时候，使用了基于Google Gear插件来做了很多离线应用，可惜Gear已经不在更新开发，被HTML5取代。下面介绍基于HTML 5的Web 应用程序的本地存储，不再废话，例子说明一切。</p><p>一、离线应用缓存 HTML 5 Offline Application Cache</p><p>在服务器上添加MIME TYPE支:text/cache-manifest</p><p>如果在Apache下添加：</p><p>AddType text/cache-manifest manifest</p><p>如果为Nginx，在添加：</p><p>text/cache-manifest                   manifest;</p><p>或者通过动态程序生成：</p><p>1 header('Content-type: text/cache-manifest; charset=UTF-8');</p><p>?创建 NAME.manifest:</p><p>新建清单文件 manifest</p><p><pre>CACHE MANIFEST</p><p> This is a comment.</p><p> Cache manifest version 0.0.1</p><p> If you change the version number in this comment,</p><p> the cache manifest is no longer byte-for-byte</p><p> identical.</p><p>/app/static/default/js/models/prototype.js</p><p>/app/static/default/js/controllers/init.js</p><p>NETWORK:</p><p> All URLs that start with the following lines</p><p> are whitelisted.</p><p>http://a.com/</p><p>CACHE:</p><p> Additional items to cache.</p><p>/app/static/default/images/main/bg.png</p><p>FALLBACK:</p><p>demoimages/ images/</p><p></pre></p><p>给 &lt;html&gt; 标签加 manifest 属性：</p><p>建立manifest文件之后，需要在HTML文档中声明：</p><p>声明清单文件 manifest</p><p><pre>&lt;!doctype html&gt; </p><p>&lt;html manifest="notebook.manifest"&gt; </p><p>    &lt;head&gt; </p><p>        &lt;meta charset="UTF-8" /&gt; </p><p>            &lt;meta name = "viewport" content = "width = device-width, user-scalable = no"&gt; </p><p>        &lt;title&gt;NoteBook&lt;/title&gt; </p><p>    &lt;/head&gt; </p><p>    &lt;body&gt; </p><p>    &lt;/body&gt; </p><p>&lt;/html&gt;</p><p></pre></p><p>二、Key-Value Storage</p><p>三、Using the JavaScript Database</p><p>四、Android下使用WebView来做基于HTML5的App</p><p>见如下AndroidManifest.xml</p><p><pre>&lt;?xml version=<font class="Fields">"1.0"</font> encoding=</font><font class="Fields">"utf-8"</font>?&gt;</p><p>&lt;manifest xmlns:android=<font class="Fields">"http:<font class="Comments">//schemas.android.com/apk/res/android</font></p><p>    </font>package=<font class="Fields">"com.xinze.joke</p><p>    </font>android:versionCode=<font class="Fields">"1</p><p>    </font>android:versionName=<font class="Fields">"1.0"</font> &gt;</p><p>    &lt;application</p><p>        </font>android:icon=<font class="Fields">"@drawable/icon</p><p>        </font>android:label=<font class="Fields">"@string/app_name"</font> &gt;</p><p>        &lt;activity</p><p>            </font>android:name=<font class="Fields">".Joke</p><p>            </font>android:configChanges=<font class="Fields">"orientation|keyboardHidden|navigation</p><p>            </font>android:label=<font class="Fields">"@string/app_name</p><p>            </font>android:theme=<font class="Fields">"@android:style/Theme.NoTitleBar"</font> &gt;</p><p>            </font>&lt;intent filter=<font class="Fields">""</font> &gt;</p><p>                </font>&lt;action android:name=<font class="Fields">"android.intent.action.MAIN"</font> &gt;</p><p>                    </font>&lt;category android:name=<font class="Fields">"android.intent.category.LAUNCHER"</font> &gt;</p><p>                    &lt;/category&gt;</p><p>                &lt;/action&gt;</p><p>            &lt;/intent&gt;</p><p>        &lt;/activity&gt;</p><p>    &lt;/application&gt;</p><p>    &lt;uses</p><p>        </font>android:name=<font class="Fields">"android.permission.INTERNET</p><p>        </font>permission=<font class="Fields">""</font> &gt;</p><p>    &lt;/uses&gt;</p><p>&lt;/manifest&gt;</p><p></pre></p><p>注意： </p><p>&lt;uses android:name="android.permission.INTERNET" -permission=""&gt;&lt;/uses&gt;，允许网络应用，必须！！</p><p>Android主程序代码：</p><p><pre><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.app.AlertDialog;</p><p><font class="keyword">import </font>android.app.AlertDialog.Builder;</p><p><font class="keyword">import </font>android.content.DialogInterface;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.view.KeyEvent;</p><p><font class="keyword">import </font>android.view.View;</p><p><font class="keyword">import </font>android.webkit.JsPromptResult;</p><p><font class="keyword">import </font>android.webkit.JsResult;</p><p><font class="keyword">import </font>android.webkit.WebChromeClient;</p><p><font class="keyword">import </font>android.webkit.WebStorage;</p><p><font class="keyword">import </font>android.webkit.WebView;</p><p><font class="keyword">import </font>android.webkit.WebViewClient;</p><p><font class="keyword">public </font><font class="keyword">class </font>Joke </font><font class="keyword">extends </font>Activity {</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate(Bundle savedInstanceState) {</p><p>		<font class="keyword">super</font>.onCreate(savedInstanceState);</p><p>		<font class="keyword">final </font>WebView wv = </font><font class="keyword">new </font>WebView(</font><font class="keyword">this</font>);</p><p>		<font class="Comments">// 覆盖默认后退按钮的作用，替换成WebView里的查看历史页面</font></p><p>		</font>wv.setOnKeyListener(<font class="keyword">new </font>View.OnKeyListener() {</p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">boolean </font>onKey(View v, </font><font class="keyword">int </font>keyCode, KeyEvent event) {</p><p>				<font class="keyword">if </font>(event.getAction() == KeyEvent.ACTION_DOWN) {</p><p>					<font class="keyword">if </font>((keyCode == KeyEvent.KEYCODE_BACK) && wv.canGoBack()) {</p><p>						wv.goBack();</p><p>						<font class="keyword">return </font><font class="keyword">true</font>;</p><p>					}</p><p>				}</p><p>				<font class="keyword">return </font><font class="keyword">false</font>;</p><p>			}</p><p>		});</p><p>		<font class="Comments">// 设置支持Javascript</font></p><p>		</font>wv.getSettings().setJavaScriptEnabled(<font class="keyword">true</font>);</p><p>		</font>wv.getSettings().setJavaScriptCanOpenWindowsAutomatically(<font class="keyword">true</font>);</p><p>		</font>wv.getSettings().setDatabaseEnabled(<font class="keyword">true</font>);</p><p>		</font>wv.getSettings().setDatabasePath(<font class="Fields">"/data/data/com.xinze.joke/databases"</font>);</p><p>		<font class="Comments">// 创建WebViewClient对象</font></p><p>		</font>WebViewClient wvc = <font class="keyword">new </font>WebViewClient() {</p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">boolean </font>shouldOverrideUrlLoading(WebView view, String url) {</p><p>				wv.loadUrl(url);</p><p>				<font class="Comments">// 记得消耗掉这个事件。给不知道的朋友再解释一下，Android中返回True的意思就是到此为止吧,事件就会不会冒泡传递了，我们称之为消耗掉</font></p><p>				<font class="keyword">return </font><font class="keyword">true</font>;</p><p>			}</p><p>		};</p><p>		<font class="Comments">// 设置WebViewClient对象</font></p><p>		wv.setWebViewClient(wvc);</p><p>		<font class="Comments">// 创建WebViewChromeClient</font></p><p>		</font>WebChromeClient wvcc = <font class="keyword">new </font>WebChromeClient() {</p><p>			<font class="Comments">// 处理Alert事件</font></p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">boolean </font>onJsAlert(WebView view, String url, String message,</p><p>					<font class="keyword">final </font>JsResult result) {</p><p>				<font class="Comments">// 构建一个Builder来显示网页中的alert对话框</font></p><p>				</font>Builder builder = <font class="keyword">new </font>Builder(Joke.</font><font class="keyword">this</font>);</p><p>				</font>builder.setTitle(<font class="Fields">"笑死不偿命"</font>);</p><p>				builder.setMessage(message);</p><p>				builder.setPositiveButton(android.R.string.ok,</p><p>						<font class="keyword">new </font>AlertDialog.OnClickListener() {</p><p>							@Override</p><p>							<font class="keyword">public </font><font class="keyword">void </font>onClick(DialogInterface dialog,</p><p>									<font class="keyword">int </font>which) {</p><p>								result.confirm();</p><p>							}</p><p>						});</p><p>				</font>builder.setCancelable(<font class="keyword">false</font>);</p><p>				builder.create();</p><p>				builder.show();</p><p>				<font class="keyword">return </font><font class="keyword">true</font>;</p><p>			}</p><p>			<font class="Comments">// 处理Confirm事件</font></p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">boolean </font>onJsConfirm(WebView view, String url,</p><p>					</font>String message, <font class="keyword">final </font>JsResult result) {</p><p>				</font>Builder builder = <font class="keyword">new </font>Builder(Joke.</font><font class="keyword">this</font>);</p><p>				</font>builder.setTitle(<font class="Fields">"删除确认"</font>);</p><p>				builder.setMessage(message);</p><p>				builder.setPositiveButton(android.R.string.ok,</p><p>						<font class="keyword">new </font>AlertDialog.OnClickListener() {</p><p>							@Override</p><p>							<font class="keyword">public </font><font class="keyword">void </font>onClick(DialogInterface dialog,</p><p>									<font class="keyword">int </font>which) {</p><p>								result.confirm();</p><p>							}</p><p></p><p>						});</p><p>				builder.setNeutralButton(android.R.string.cancel,</p><p>						<font class="keyword">new </font>AlertDialog.OnClickListener() {</p><p>							@Override</p><p>							<font class="keyword">public </font><font class="keyword">void </font>onClick(DialogInterface dialog,</p><p>									<font class="keyword">int </font>which) {</p><p>								result.cancel();</p><p>							}</p><p>						});</p><p>				</font>builder.setCancelable(<font class="keyword">false</font>);</p><p>				builder.create();</p><p>				builder.show();</p><p>				<font class="keyword">return </font><font class="keyword">true</font>;</p><p>			}</p><p>			<font class="Comments">// 处理提示事件</font></p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">boolean </font>onJsPrompt(WebView view, String url, String message,</p><p>					String defaultValue, JsPromptResult result) {</p><p>				<font class="Comments">// 看看默认的效果</font></p><p>				<font class="keyword">return </font><font class="keyword">super</font>.onJsPrompt(view, url, message, defaultValue,</p><p>						result);</p><p>			}</p><p>			@Override</p><p>			<font class="keyword">public </font><font class="keyword">void </font>onExceededDatabaseQuota(String url,</p><p>					</font>String databaseIdentifier, <font class="keyword">long </font>currentQuota,</p><p>					<font class="keyword">long </font>estimatedSize, </font><font class="keyword">long </font>totalUsedQuota,</p><p>					WebStorage.QuotaUpdater quotaUpdater) {</p><p>				quotaUpdater.updateQuota(204801);</p><p>			}</p><p>		};</p><p>		</font>wv.loadUrl(<font class="Fields">"http:<font class="Comments">//192.168.1.14/index.html"</font>);</font></p><p>		<font class="Comments">// 设置setWebChromeClient对象</font></p><p>		wv.setWebChromeClient(wvcc);</p><p>		setContentView(wv);</p><p>	}</p><p>}</p><p></pre></p><p>使用 JavaScript Database 的时候，需要特别注意：setDatabaseEnabled 以及 onExceededDatabaseQuota！</p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

