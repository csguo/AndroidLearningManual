
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android学习笔记之NFC近距离无线通讯技术（Dean）_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li class="navcurrentLink"><A href="index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="3G" href="index_177.html">3G</A></h2>

  <h2><A title="WIFI" href="index_178.html">WIFI</A></h2>

  <h2><A title="蓝牙" href="index_179.html">蓝牙</A></h2>

  <h2><A title="HTTP协议" href="index_180.html">HTTP协议</A></h2>

  <h2><A title="Socket" href="index_181.html">Socket</A></h2>

  <h2><A title="HTML与HTML5" href="index_182.html">HTML与HTML5</A></h2>

  <h2><A title="JavaScript" href="index_183.html">JavaScript</A></h2>

  <h2><A title="Email" href="index_184.html">Email</A></h2>

  <h2><A title="NFC" href="index_185.html">NFC</A></h2>
<UL><li ><A title=Android NFC 开发教程之一 href="show_801_185.html">Android NFC 开发教程之一</A> </li><li ><A title=Android NFC 开发教程之二 href="show_802_185.html">Android NFC 开发教程之二</A> </li><li ><A title=Android NFC 开发教程之三 href="show_803_185.html">Android NFC 开发教程之三</A> </li><li class="currentLink"><A title=Android学习笔记之NFC近距离无线通讯技术（Dean） href="show_804_185.html">Android学习笔记之NFC近距离无线通讯技术（Dean）</A> </li><li ><A title=Android中NFC功能流程图解析及代码演示 href="show_805_185.html">Android中NFC功能流程图解析及代码演示</A> </li><li ><A title=关于NFC的android开发 href="show_806_185.html">关于NFC的android开发</A> </li></UL>
  <h2><A title="Web Service" href="index_186.html">Web Service</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android学习笔记之NFC近距离无线通讯技术（Dean）</H2>
<div style="line-height:20px; font-size:14px;"><p>首先要弄清楚NFC是什么？</p><p><img src="../img/network_nfc/04_nfc.jpg"></p><p>NFC是Near Field Communication缩写，即近距离无线通讯技术。由飞利浦公司和索尼公司共同开发的NFC是一种非接触式识别和互联技术，可以在移动设备、消费类电子产品、PC 和智能控件工具间进行近距离无线通信。NFC 提供了一种简单、触控式的解决方案，可以让消费者简单直观地交换信息、访问内容与服务。 </p><p>NFC将非接触读卡器、非接触卡和点对点（Peer-to-Peer）功能整合进一块单芯片，为消费者的生活方式开创了不计其数的全新机遇。这是一个开放接口平台，可以对无线网络进行快速、主动设置，也是虚拟连接器，服务于现有蜂窝状网络、蓝牙和无线 802.11 设备。 </p><p>NFC可兼容索尼公司的FeliCaTM卡以及已广泛建立的非接触式智能卡架构，该架构基于ISO 14443 A，使用飞利浦的MIFARE?技术。 </p><p>为了推动NFC的发展和普及，飞利浦、索尼和诺基亚创建了一个非赢利性的行业协会——NFC论坛，促进NFC技术的实施和标准化，确保设备和服务之间协同合作。目前，NFC论坛在全球拥有70多个成员，包括：万事达卡国际组织、松下电子工业有限公司、微软公司、摩托罗拉公司、NEC公司、瑞萨科技公司、三星公司、德州仪器制造公司和 Visa 国际组织。 </p><p>编者注：NFC全球最早的商用发布：*德国，美因茨交通公司（RMV）2006年4月19日，飞利浦、诺基亚、Vodafone公司及德国法兰克福美因茨地区的公交网络运营商美因茨交通公司（Rhein-Main Verkehrsverbund）宣布，在成功地进行为期10个月的现场试验后，近距离无线通信（NFC）技术即将投入商用。目前，Nokia 3220手机已集成了NFC技术，可以用作电子车票，还可在当地零售店和旅游景点作为折扣忠诚卡使用。哈瑙市的大约95.000位居民现在只需轻松地刷一下兼容手机，就能享受NFC式公交移动售票带来的便利。 </p><p>与RFID一样，NFC信息也是通过频谱中无线频率部分的电磁感应耦合方式传递，但两者之间还是存在很大的区别。首先，NFC是一种提供轻松、安全、迅速的通信的无线连接技术，其传输范围比RFID小，RFID的传输范围可以达到几米、甚至几十米，但由于NFC采取了独特的信号衰减技术，相对于 RFID来说NFC具有距离近、带宽高、能耗低等特点。 </p><p>其次，NFC与现有非接触智能卡技术兼容，目前已经成为得到越来越多主要厂商支持的正式标准。再次，NFC还是一种近距离连接协议，提供各种设备间轻松、安全、迅速而自动的通信。与无线世界中的其他连接方式相比，NFC是一种近距离的私密通信方式。最后，RFID更多的被应用在生产、物流、跟踪、资产管理上，而NFC则在门禁、公交、手机支付等领域内发挥着巨大的作用。 </p><p>同时，NFC还优于红外和蓝牙传输方式。作为一种面向消费者的交易机制，NFC比红外更快、更可靠而且简单得多，不用向红外那样必须严格的对齐才能传输数据。与蓝牙相比，NFC面向近距离交易，适用于交换财务信息或敏感的个人信息等重要数据；蓝牙能够弥补NFC通信距离不足的缺点，适用于较长距离数据通信。因此，NFC和蓝牙互为补充，共同存在。事实上，快捷轻型的NFC协议可以用于引导两台设备之间的蓝牙配对过程，促进了蓝牙的使用。 </p><p>NFC手机内置NFC芯片，组成RFID模块的一部分，可以当作RFID无源标签使用———用来支付费用；也可以当作RFID读写器———用作数据交换与采集。NFC技术支持多种应用，包括移动支付与交易、对等式通信及移动中信息访问等。通过NFC手机，人们可以在任何地点、任何时间，通过任何设备，与他们希望得到的娱乐服务与交易联系在一起，从而完成付款，获取海报信息等。NFC设备可以用作非接触式智能卡、智能卡的读写器终端以及设备对设备的数据传输链路，其应用主要可分为以下四个基本类型：用于付款和购票、用于电子票证、用于智能媒体以及用于交换、传输数据。 </p><p>我们来看一下NFC在Android代码中的位置： </p><p>1.frameworks/base/core/java/android/nfc </p><p>ErrorCodes.java</p><p>This class defines all the error codes that can be returned by the service and producing an exception on the application level. These are needed since binders does not support exceptions.</p><p>弄了个iserror方法 定义了一堆小于0的常量！等于0就success</p><p><pre><font class="keyword">public </font><font class="keyword">static </font><font class="keyword">boolean </font>isError(</font><font class="keyword">int </font>code) {</p><p>	<font class="keyword">if </font>(code &lt; 0) {</p><p>		<font class="keyword">return </font><font class="keyword">true</font>;</p><p>	</font>} <font class="keyword">else </font>{</p><p>		<font class="keyword">return </font><font class="keyword">false</font>;</p><p>	}</p><p>}</p><p></pre> </p><p>TagLostException.java</p><p>FormatException.java</p><p>自定义的一个类型转化异常！</p><p><pre><font class="keyword">public </font>FormatException(String message) {</p><p>	<font class="keyword">super</font>(message);</p><p>}</p><p></pre> </p><p>自己抛出异常</p><p>LlcpPacket.java</p><p>Represents a LLCP packet received in a LLCP Connectionless communication</p><p>LLCP –其在定义一个通讯协定，以管理架构在ISO 18092/NFC IP-1的NFC设备间的逻辑连结，当然这个通讯协定主要是为了Peer-to-Peer模式下，设备间通讯时使用。</p><p>private final int mRemoteSap;private final byte[] mDataBuffer;</p><p>NdefMessage.java</p><p>Represents an NDEF (NFC Data Exchange Format) data message that contains one or more </p><p>数据的数据交换格式</p><p><pre><font class="keyword">public </font>NdefMessage(byte[] data) </font><font class="keyword">throws </font>FormatException {</p><p>	</font>mRecords = <font class="keyword">null</font>; <font class="Comments">// stop compiler complaints about </font><font class="keyword">final </font>field</font></p><p>	<font class="keyword">if </font>(parseNdefMessage(data) == -1) {</p><p>		<font class="keyword">throw </font><font class="keyword">new </font>FormatException(<font class="Fields">"Error </font><font class="keyword">while </font>parsing NDEF message"</font>);</p><p>	}</p><p>}</p><p><font class="keyword">private </font>native </font><font class="keyword">int </font>parseNdefMessage(byte[] data);</p><p></pre> </p><p>NdefRecord.java</p><p>逻辑记录数据交换的格式。</p><p><pre><font class="keyword">private </font><font class="keyword">final </font>byte mFlags;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>byte FLAG_MB = (byte) 0x80;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>byte FLAG_ME = (byte) 0x40;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>byte FLAG_CF = (byte) 0x20;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>byte FLAG_SR = (byte) 0x10;</p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font>byte FLAG_IL = (byte) 0x08;</p><p><font class="keyword">private </font><font class="keyword">final </font>short mTnf; 表示格式如何解读型态栏位</p><p><font class="keyword">private </font><font class="keyword">final </font>byte[] mType;描述了记录格式</p><p><font class="keyword">private </font><font class="keyword">final </font>byte[] mId;一个唯一的标识符备案</p><p><font class="keyword">private </font><font class="keyword">final </font>byte[] mPayload;实际数据的有效载荷</p><p><font class="keyword">private </font>native </font><font class="keyword">int </font>parseNdefRecord(byte[] data);</p><p></pre> </p><p>NfcAdapter.java</p><p>Represents the device's local NFC adapter.</p><p>NfcManager.java</p><p>High level manager used to obtain an instance of an</p><p>其实只有一个getDefaultAdapter（）说明NfcAdapter其实正扮演着manager的角色</p><p>NfcSecureElement.java</p><p>This class provides the primary API for managing all aspects Secure Element.Get an instance of this class by calling Context.getSystemService(Context.NFC_SERVICE).</p><p>这个类提供了主要的API的管理所有安全方面的元素</p><p>Tag.java</p><p><pre>Represents a (generic) discovered tag.</p><p></font>/*package*/ <font class="keyword">final </font>byte[] mId;The tag identifier</p><p></font>/*package*/ <font class="keyword">final </font><font class="keyword">int</font>[] mTechList;</p><p></font>/*package*/ <font class="keyword">final </font>String[] mTechStringList;</p><p></font>/*package*/ <font class="keyword">final </font>Bundle[] mTechExtras;</p><p></font>/*package*/ <font class="keyword">final </font><font class="keyword">int </font>mServiceHandle; <font class="Comments">// </font><font class="keyword">for </font>use by NFC service, 0 indicates a mock</font></p><p></font>/*package*/ <font class="keyword">final </font>INfcTag mTagService;</p><p></font>/*package*/ <font class="keyword">int </font>mConnectedTechnology;</p><p></p><p><font class="keyword">public </font>Tag(byte[] id, </font><font class="keyword">int</font>[] techList, Bundle[] techListExtras,</p><p>	<font class="keyword">if </font>(techList == </font><font class="keyword">null</font>) {</p><p>		<font class="keyword">throw </font><font class="keyword">new </font>IllegalArgumentException(<font class="Fields">"rawTargets cannot be </font><font class="keyword">null</font>"</font>);</p><p>	}</p><p>	mId = id;</p><p>	mTechList = Arrays.copyOf(techList, techList.length);</p><p>	mTechStringList = generateTechStringList(techList);</p><p>	<font class="Comments">// Ensure mTechExtras is as long as mTechList</font></p><p>	mTechExtras = Arrays.copyOf(techListExtras, techList.length);</p><p>	mServiceHandle = serviceHandle;</p><p>	mTagService = tagService;</p><p>	mConnectedTechnology = -1;</p><p>}</p><p></pre></p><p>TechListParcel.java</p><p><pre><font class="keyword">private </font>String[][] mTechLists;</p><p><font class="keyword">public </font>TechListParcel(String[]... strings) {</p><p>	mTechLists = strings;</p><p>}</p><p></pre></p><p>TransceiveResult.java</p><p>Class used to pipe transceive result from the NFC service.</p><p><pre>private final boolean mTagLost;</p><p>private final boolean mSuccess;</p><p>private final byte[] mResponseData;</p><p>ILlcpConnectionlessSocket.aidl</p><p>ILlcpServiceSocket.aidl</p><p>ILlcpSocket.aidl</p><p>INfcAdapter.aidl</p><p>INfcSecureElement.aidl</p><p>INfcTag.aidl</p><p>IP2pInitiator.aidl</p><p>IP2pTarget.aidl</p><p>LlcpPacket.aidl</p><p>NdefMessage.aidl</p><p>NdefRecord.aidl</p><p>Tag.aidl</p><p>TechListParcel.aidl</p><p>TransceiveResult.aidl</p><p></pre></p><p>2.frameworks/base/core/java/android/nfc/tech </p><p>NFC Protocol Bindings –在Peer-to-Peer模式下，NFC Forum不自己另定高层的资料传输协定，而是直接使用其他既有的资料传输协定，如IP、OBEX等，来实现该模式下设备间资料的传输。 </p><p><pre>BasicTagTechnology.java</p><p>A base class for tag technologies that are built on top of transceive().</p><p></pre></p><p>这个应该是最顶端的transceive()方法！IsoDep.java NfcA.javaNfcB.javaNfcF.javaNfcV.java全部调用此方法实现！</p><p><pre>/*package*/ final Tag mTag;</p><p>/*package*/ boolean mIsConnected;</p><p>/*package*/ int mSelectedTechnology;</p><p>IsoDep.java</p><p>A low-level connection to a {@link Tag} using the ISO-DEP technology, also known as ISO1443-4.</p><p>MifareClassic.java</p><p></pre></p><p>即Philips的Mifare，现有悠游卡即属此类</p><p><pre>MifareUltralight.java</p><p>Ndef.java</p><p></pre></p><p>NDEF – NFC Data Exchange Format (NDEF) 主要在定义一个简洁与共同的资料格式，此资料格式将可作为NFC设备在读取标签（Tag）资料时的一个依据。此规格於2006年便完成制定并已公告。 </p><p>目前整个NFC相关技术规格标准的制定，主要是由NFC Forum负责</p><p>下图为NFC Forum所展示的NFC技术规格架构</p><p><pre>&lt;img id="\"aimg_u7zQJ\"" onclick="\"zoom(this," this.src,="" 0,="" 0)\"="" class="\"zoom\"" file="\"http://dl.iteye.com/upload/attachment/471075/a760e498-60e7-398c-8f23-e7bae2f0f83a.jpg\"" onmouseover="\"img_onmouseoverfunc(this)\"" lazyloadthumb="\"1\"" border="\"0\"" alt="\"\""&gt;</p><p>A high-level connection to a {@link Tag} using one of the NFC type 1, 2, 3, or 4 technologies to interact with NDEF data. MiFare Classic cards that present NDEF data may also be used via this class. To determine the exact technology being used call</p><p>NdefFormatable.java</p><p>An interface to a {@link Tag} allowing to format the tag as NDEF.</p><p>NfcA.java</p><p>A low-level connection to a {@link Tag} using the NFC-A technology, also known as ISO1443-3A.</p><p>NfcB.java</p><p>A low-level connection to a {@link Tag} using the NFC-B technology, also known as ISO1443-3B.</p><p>NfcF.java</p><p>A low-level connection to a {@link Tag} using the NFC-F technology, also known as JIS6319-4.</p><p>NfcV.java</p><p>A low-level connection to a {@link Tag} using NFC vicinity technology, also known as ISO15693</p><p>TagTechnology.java</p><p></pre></p><p>最上层的接口这里定义集中协议类型的标识 继承closeable便于克隆</p><p>拥有方法getTag connect reconnect close isConnected</p><p>这里涉及到几个协议一起来看一下</p><p><img src="../img/network_nfc/04_nfc2.jpg"></p><p><img src="../img/network_nfc/04_nfc3.jpg"></p><p><img src="../img/network_nfc/04_nfc4.jpg"></p><p><img src="../img/network_nfc/04_nfc5.jpg"></p><p><img src="../img/network_nfc/04_nfc6.jpg"></p><p><img src="../img/network_nfc/04_nfc7.jpg"></p><p><pre>3.frameworks/base/core/java/com/android/internal/nfc</p><p>LlcpConnectionlessSocket.java</p><p>LlcpException.java</p><p>LlcpServiceSocket.java</p><p>LlcpSocket.java</p><p>NfcException.java</p><p>P2pDevice.java</p><p>P2pDevice is the abstract base class for all supported P2P targets the</p><p>NfcManager can handle.</p><p>P2pInitiator.java</p><p>P2pInitiator represents the initiator in an NFC-IP1 peer-to-peer</p><p>communication.</p><p>P2pTarget.java</p><p>P2pTarget represents the target in an NFC-IP1 peer-to-peer communication.</p><p></pre></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

