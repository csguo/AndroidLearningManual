
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Launcher之文件夹美化_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li ><A href="../userinterface/index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li class="navcurrentLink"><A href="index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="Launcher" href="index_207.html">Launcher</A></h2>
<UL><li ><A title=Android Launcher 分析（一） href="show_1_207.html">Android Launcher 分析（一）</A> </li><li ><A title=Android Launcher 分析（二） href="show_2_207.html">Android Launcher 分析（二）</A> </li><li ><A title=Android Launcher 分析（三） href="show_3_207.html">Android Launcher 分析（三）</A> </li><li ><A title=Android 启动唯一的Launcher href="show_4_207.html">Android 启动唯一的Launcher</A> </li><li class="currentLink"><A title=Launcher之文件夹美化 href="show_5_207.html">Launcher之文件夹美化</A> </li><li ><A title=关于使用Eclipse调试Launcher的完美解决方法 href="show_6_207.html">关于使用Eclipse调试Launcher的完美解决方法</A> </li><li ><A title=提取Launcher中的WorkSapce，可以左右滑动切换屏幕页面的类 href="show_7_207.html">提取Launcher中的WorkSapce，可以左右滑动切换屏幕页面的类</A> </li><li ><A title=使用ViewPager实现高仿launcher拖动效果 href="show_8_207.html">使用ViewPager实现高仿launcher拖动效果</A> </li><li ><A title=Android 深入研究拖放功能Launcher（一） href="show_9_207.html">Android 深入研究拖放功能Launcher（一）</A> </li><li ><A title=Android 深入研究拖放功能Launcher（二） href="show_10_207.html">Android 深入研究拖放功能Launcher（二）</A> </li><li ><A title=Android 深入研究拖放功能Launcher（三） href="show_11_207.html">Android 深入研究拖放功能Launcher（三）</A> </li><li ><A title=Android 深入研究拖放功能Launcher（四） href="show_12_207.html">Android 深入研究拖放功能Launcher（四）</A> </li><li ><A title=Android 深入研究拖放功能Launcher（五） href="show_13_207.html">Android 深入研究拖放功能Launcher（五）</A> </li><li ><A title=Android 深入研究拖放功能Launcher（六） href="show_14_207.html">Android 深入研究拖放功能Launcher（六）</A> </li><li ><A title=Android 在launcher 2.1上实现2.2的屏幕标记 href="show_15_207.html">Android 在launcher 2.1上实现2.2的屏幕标记</A> </li></UL>
  <h2><A title="电话系统RIL" href="index_208.html">电话系统RIL</A></h2>

  <h2><A title="进程间通信" href="index_209.html">进程间通信</A></h2>

  <h2><A title="内部sensor系统" href="index_210.html">内部sensor系统</A></h2>

  <h2><A title="内部surface系统" href="index_211.html">内部surface系统</A></h2>

  <h2><A title="启动流程" href="index_212.html">启动流程</A></h2>

  <h2><A title="源码编译" href="index_213.html">源码编译</A></h2>

  <h2><A title="状态栏" href="index_214.html">状态栏</A></h2>

</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Launcher之文件夹美化</H2>
<div style="line-height:20px; font-size:14px;"><p>需要的源代码包：（还需要在Eclipse中配置）</p><p><img src="../img/source_launcher/05_Launcher01.jpg"></p><p>从launcher源码中很容易变可以看出需要修改的文件，主要修改FolderIcon.java这个文件。修改后的代码如下：</p><p><pre><font class="keyword">public </font><font class="keyword">class </font>FolderIcon </font><font class="keyword">extends </font>BubbleTextView </font><font class="keyword">implements </font>DropTarget {</p><p>	<font class="keyword">private </font>UserFolderInfo mInfo;</p><p>	<font class="keyword">private </font>Launcher mLauncher;</p><p>	<font class="keyword">private </font>Drawable mCloseIcon;</p><p>	<font class="keyword">private </font>Drawable mOpenIcon;</p><p>	<font class="Comments">// add by hmg for FolderIcon {</font></p><p>	<font class="keyword">private </font>IconCache mIconCache;</p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>ICON_COUNT = 4; <font class="Comments">// 可显示的缩略图数</font></p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>NUM_COL = 2; <font class="Comments">// 每行显示的个数</font></p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>PADDING = 1; <font class="Comments">// 内边距</font></p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>MARGIN = 7; <font class="Comments">// 外边距</font></p><p>	<font class="Comments">// add by hmg for FolderIcon }</font></p><p>	<font class="keyword">public </font>FolderIcon(Context context, AttributeSet attrs) {</p><p>		<font class="keyword">super</font>(context, attrs);</p><p>		mIconCache = ((LauncherApplication) mContext.getApplicationContext()).getIconCache();</p><p>	}</p><p>	<font class="keyword">public </font>FolderIcon(Context context) {</p><p>		<font class="keyword">super</font>(context);</p><p>		mIconCache = ((LauncherApplication) mContext.getApplicationContext()).getIconCache();</p><p>	}</p><p>	<font class="keyword">static </font>FolderIcon fromXml(</font><font class="keyword">int </font>resId, Launcher launcher, ViewGroup group,</p><p>			UserFolderInfo folderInfo) {</p><p>				</font>resId, group, <font class="keyword">false</font>);</p><p>		<font class="Comments">// final Resources resources = launcher.getResources();</font></p><p>		<font class="Comments">// Drawable d = resources.getDrawable(R.drawable.ic_launcher_folder);</font></p><p>		<font class="Comments">// icon.mCloseIcon = d;</font></p><p>		<font class="Comments">// icon.mOpenIcon =</font></p><p>		<font class="Comments">// resources.getDrawable(R.drawable.ic_launcher_folder_open);</font></p><p>		<font class="Comments">// icon.setCompoundDrawablesWithIntrinsicBounds(null, d, null, null);</font></p><p>		icon.setText(folderInfo.title);</p><p>		icon.setTag(folderInfo);</p><p>		icon.setOnClickListener(launcher);</p><p>		icon.mInfo = folderInfo;</p><p>		icon.mLauncher = launcher;</p><p>		icon.updateFolderIcon(); <font class="Comments">// 更新图标</font></p><p>		folderInfo.setFolderIcon(icon); <font class="Comments">// 设置FolderIcon</font></p><p>		<font class="keyword">return </font>icon;</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>updateFolderIcon() {</p><p>		<font class="keyword">float </font>x, y;</p><p>		<font class="keyword">final </font>Resources resources = mLauncher.getResources();</p><p>		Bitmap closebmp = BitmapFactory.decodeResource(resources,</p><p>				R.drawable.icon_folder); <font class="Comments">// 获取FolderIcon关闭时的背景图</font></p><p>		Bitmap openbmp = BitmapFactory.decodeResource(resources,</p><p>				R.drawable.icon_folder_open); <font class="Comments">// 获取FolderIcon打开时的背景图</font></p><p>		<font class="keyword">int </font>iconWidth = closebmp.getWidth(); <font class="Comments">// icon的宽度</font></p><p>		<font class="keyword">int </font>iconHeight = closebmp.getHeight();</p><p>		Bitmap folderclose = Bitmap.createBitmap(iconWidth, iconHeight,</p><p>				Bitmap.Config.ARGB_8888);</p><p>		Bitmap folderopen = Bitmap.createBitmap(iconWidth, iconHeight,</p><p>				Bitmap.Config.ARGB_8888);</p><p>		</font>Canvas canvas = <font class="keyword">new </font>Canvas(folderclose);</p><p>		</font>canvas.drawBitmap(closebmp, 0, 0, <font class="keyword">null</font>); <font class="Comments">// 绘制背景</font></p><p>		</font>Matrix matrix = <font class="keyword">new </font>Matrix(); <font class="Comments">// 创建操作图片用的Matrix对象</font></p><p>		<font class="keyword">float </font>scaleWidth = (iconWidth - MARGIN * 2) / NUM_COL - 2 * PADDING; <font class="Comments">// 计算缩略图的宽(高与宽相同)</font></p><p>		<font class="keyword">float </font>scale = (scaleWidth / iconWidth); <font class="Comments">// 计算缩放比例</font></p><p>		matrix.postScale(scale, scale); <font class="Comments">// 设置缩放比例</font></p><p>		<font class="keyword">for </font>(</font><font class="keyword">int </font>i = 0; i &lt; ICON_COUNT; i++) {</p><p>			<font class="keyword">if </font>(i &lt; mInfo.contents.size()) {</p><p>				x = MARGIN + PADDING * (2 * (i % NUM_COL) + 1) + scaleWidth</p><p>						<font class="Comments">* (i % NUM_COL);</font></p><p>				y = MARGIN + PADDING * (2 * (i / NUM_COL) + 1) + scaleWidth</p><p>						<font class="Comments">* (i / NUM_COL);</font></p><p>				ShortcutInfo scInfo = (ShortcutInfo) mInfo.contents.get(i);</p><p>				Bitmap iconbmp = scInfo.getIcon(mIconCache); <font class="Comments">// 获取缩略图标</font></p><p>				Bitmap scalebmp = Bitmap.createBitmap(iconbmp, 0, 0, iconWidth,</p><p>						</font>iconHeight, matrix, <font class="keyword">true</font>);</p><p>				</font>canvas.drawBitmap(scalebmp, x, y, <font class="keyword">null</font>);</p><p>			}</p><p>		}</p><p>		</font>mCloseIcon = <font class="keyword">new </font>FastBitmapDrawable(folderclose); <font class="Comments">// 将bitmap转换为Drawable</font></p><p>		</font>setCompoundDrawablesWithIntrinsicBounds(<font class="keyword">null</font>, mCloseIcon, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>);</p><p>		</font>canvas = <font class="keyword">new </font>Canvas(folderopen);</p><p>		</font>canvas.drawBitmap(folderclose, 0, 0, <font class="keyword">null</font>);</p><p>		</font>canvas.drawBitmap(openbmp, 0, 0, <font class="keyword">null</font>);</p><p>		</font>mOpenIcon = <font class="keyword">new </font>FastBitmapDrawable(folderopen); <font class="Comments">// 绘制open图片</font></p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">boolean </font>acceptDrop(DragSource source, </font><font class="keyword">int </font>x, </font><font class="keyword">int </font>y, </font><font class="keyword">int </font>xOffset,</p><p>			<font class="keyword">int </font>yOffset, DragView dragView, Object dragInfo) {</p><p>		<font class="keyword">final </font>ItemInfo item = (ItemInfo) dragInfo;</p><p>		<font class="keyword">final </font><font class="keyword">int </font>itemType = item.itemType;</p><p>		<font class="keyword">return </font>(itemType == LauncherSettings.Favorites.ITEM_TYPE_APPLICATION || itemType == LauncherSettings.Favorites.ITEM_TYPE_SHORTCUT)</p><p>				&& item.container != mInfo.id;</p><p>	}</p><p>	<font class="keyword">public </font>Rect estimateDropLocation(DragSource source, </font><font class="keyword">int </font>x, </font><font class="keyword">int </font>y,</p><p>			<font class="keyword">int </font>xOffset, </font><font class="keyword">int </font>yOffset, DragView dragView, Object dragInfo,</p><p>			Rect recycle) {</p><p>		<font class="keyword">return </font><font class="keyword">null</font>;</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onDrop(DragSource source, </font><font class="keyword">int </font>x, </font><font class="keyword">int </font>y, </font><font class="keyword">int </font>xOffset,</p><p>			<font class="keyword">int </font>yOffset, DragView dragView, Object dragInfo) {</p><p>		ShortcutInfo item;</p><p>		<font class="keyword">if </font>(dragInfo instanceof ApplicationInfo) {</p><p>			<font class="Comments">// Came from all apps -- make a copy</font></p><p>			item = ((ApplicationInfo) dragInfo).makeShortcut();</p><p>		</font>} <font class="keyword">else </font>{</p><p>			item = (ShortcutInfo) dragInfo;</p><p>		}</p><p>		mInfo.add(item);</p><p>		LauncherModel.addOrMoveItemInDatabase(mLauncher, item, mInfo.id, 0, 0,</p><p>				0);</p><p>		updateFolderIcon(); <font class="Comments">// 拖拽放入时更新</font></p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onDragEnter(DragSource source, </font><font class="keyword">int </font>x, </font><font class="keyword">int </font>y, </font><font class="keyword">int </font>xOffset,</p><p>			<font class="keyword">int </font>yOffset, DragView dragView, Object dragInfo) {</p><p>		</font>setCompoundDrawablesWithIntrinsicBounds(<font class="keyword">null</font>, mOpenIcon, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>);</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onDragOver(DragSource source, </font><font class="keyword">int </font>x, </font><font class="keyword">int </font>y, </font><font class="keyword">int </font>xOffset,</p><p>			<font class="keyword">int </font>yOffset, DragView dragView, Object dragInfo) {</p><p>	}</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onDragExit(DragSource source, </font><font class="keyword">int </font>x, </font><font class="keyword">int </font>y, </font><font class="keyword">int </font>xOffset,</p><p>			<font class="keyword">int </font>yOffset, DragView dragView, Object dragInfo) {</p><p>		</font>setCompoundDrawablesWithIntrinsicBounds(<font class="keyword">null</font>, mCloseIcon, </font><font class="keyword">null</font>, </font><font class="keyword">null</font>);</p><p>	}</p><p>}</p><p></pre></p><p>将文件拖拽进入文件夹时响应FolderIcon中的onDrop,所以添加updateFolderIcon();</p><p>以上代码可以实现将图标拖拽进文件夹时实时更新缩略图显示，还没有对拖拽出文件夹时更新显示，所以还需要修改其他地方。跟踪代码可以看出拖拽离开文件夹时响应UserFolder中方法onDropCompleted，需要修改UserFolder.java：</p><p><pre><font class="keyword">public </font><font class="keyword">void </font>onDropCompleted(View target, </font><font class="keyword">boolean </font>success) {</p><p>	<font class="keyword">if </font>(success) {</p><p>		ShortcutsAdapter adapter = (ShortcutsAdapter) mContent.getAdapter();</p><p>		adapter.remove(mDragItem);</p><p>		<font class="Comments">// 拖拽离开时更新</font></p><p>		((UserFolderInfo) mInfo).mFolderIcon.updateFolderIcon();</p><p>	}</p><p>}</p><p><font class="keyword">public </font><font class="keyword">void </font>onDrop(DragSource source, </font><font class="keyword">int </font>x, </font><font class="keyword">int </font>y, </font><font class="keyword">int </font>xOffset,</p><p>		<font class="keyword">int </font>yOffset, DragView dragView, Object dragInfo) {</p><p>	ShortcutInfo item;</p><p>	<font class="keyword">if </font>(dragInfo instanceof ApplicationInfo) {</p><p>		<font class="Comments">// Came from all apps -- make a copy</font></p><p>		item = ((ApplicationInfo) dragInfo).makeShortcut();</p><p>	</font>} <font class="keyword">else </font>{</p><p>		item = (ShortcutInfo) dragInfo;</p><p>	}</p><p>	((ShortcutsAdapter) mContent.getAdapter()).add(item);</p><p>	LauncherModel.addOrMoveItemInDatabase(mLauncher, item, mInfo.id, 0, 0, 0);</p><p>	<font class="Comments">// 将文件直接拖拽到打开的文件夹更新</font></p><p>	((UserFolderInfo) mInfo).mFolderIcon.updateFolderIcon();</p><p>}</p><p></pre></p><p>从以上代码可以看出为了传递FolderIcon对象，所以我们还需要为UserFolderInfo添加一个mFolderIcon成员，修改UserFolderInfo.java:</p><p><pre><font class="keyword">protected </font>FolderIcon mFolderIcon = </font><font class="keyword">null</font>; </p><p><font class="keyword">void </font>setFolderIcon(FolderIcon icon) {</p><p>	mFolderIcon = icon;</p><p>}</p><p></pre></p><p>以上代码是在android2.2, 480*320下测试的，其他分辨率的可以修改</p><p><pre><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>ICON_COUNT = 4; <font class="Comments">// 可显示的缩略图数</font></p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>NUM_COL = 2; <font class="Comments">// 每行显示的个数</font></p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>PADDING = 1; <font class="Comments">// 内边距</font></p><p><font class="keyword">private </font><font class="keyword">static </font><font class="keyword">final </font><font class="keyword">int </font>MARGIN = 7; <font class="Comments">// 外边距</font></p><p></pre></p><p>的值。</p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
 
 
    </P>
</DIV></BODY></HTML>

