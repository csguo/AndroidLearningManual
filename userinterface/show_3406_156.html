
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>Android图像处理特效之素描效果_Android学习手册</TITLE>
<META content="text/html; charset=gb2312" http-equiv=Content-Type><LINK  rel=stylesheet type=text/css href="../css/c5.css">
<META name=GENERATOR content="MSHTML 8.00.6001.18702">
<meta name="Description" content=Android基础 Android组件 Android用户界面 Android设备功能 Android数据存储 Android网络应用 Android游戏开发 Android多媒体 Android源码开发 Android高级进阶 Android面试题/>
<meta name="Keywords" content="android 学习手册">

</HEAD>
<BODY id=homesecond class=serverscripting>
<DIV id=wrapper>
<DIV id=header><h1><a href="../index.html">Android学习手册</a></h1> 
</DIV>

<DIV id=navfirst>
<div id="indexGuide"><UL><li ><A href="../basic/index.html">Android基础</A> </li><li ><A href="../component/index.html">Android组件</A> </li><li class="navcurrentLink"><A href="index.html">用户界面</A> </li><li ><A href="../device/index.html">设备功能</A> </li><li ><A href="../datastorage/index.html">数据存储</A> </li><li ><A href="../network/index.html">网络应用</A> </li><li ><A href="../game/index.html">游戏开发</A> </li><li ><A href="../multimedia/index.html">多媒体</A> </li><li ><A href="../source/index.html">源码开发</A> </li><li ><A href="../advance/index.html">高级进阶</A> </li><li ><A href="../interview/index.html">Android面试题</A> </li></UL></div>
</DIV>
<DIV id=navsecond>
<DIV id=course>
<div id="kcTitle">课 程 表</div>


  <h2><A title="用户界面之view(视图)" href="index_123.html">用户界面之view(视图)</A></h2>

  <h2><A title="用户界面之Layout(布局)" href="index_124.html">用户界面之Layout(布局)</A></h2>

  <h2><A title="用户界面之TextView(文本视图)" href="index_125.html">用户界面之TextView(文本视图)</A></h2>

  <h2><A title="用户界面之EditText(编辑视图)" href="index_126.html">用户界面之EditText(编辑视图)</A></h2>

  <h2><A title="用户界面之Button(按钮)" href="index_127.html">用户界面之Button(按钮)</A></h2>

  <h2><A title="用户界面之Dialog(对话框)" href="index_128.html">用户界面之Dialog(对话框)</A></h2>

  <h2><A title="用户界面之ListView(列表视图)" href="index_129.html">用户界面之ListView(列表视图)</A></h2>

  <h2><A title="用户界面之Adapter(适配器)" href="index_130.html">用户界面之Adapter(适配器)</A></h2>

  <h2><A title="用户界面之Menu(菜单)" href="index_131.html">用户界面之Menu(菜单)</A></h2>

  <h2><A title="用户界面之Notification(通知栏)" href="index_132.html">用户界面之Notification(通知栏)</A></h2>

  <h2><A title="NotificationImageView(图像视图)" href="index_133.html">NotificationImageView(图像视图)</A></h2>

  <h2><A title="用户界面之GridView(格视图)" href="index_134.html">用户界面之GridView(格视图)</A></h2>

  <h2><A title="用户界面之ProgressBar(进度条)" href="index_135.html">用户界面之ProgressBar(进度条)</A></h2>

  <h2><A title="用户界面之Checkbox(复选框)" href="index_136.html">用户界面之Checkbox(复选框)</A></h2>

  <h2><A title="用户界面之ScrollView(滚动视图)" href="index_137.html">用户界面之ScrollView(滚动视图)</A></h2>

  <h2><A title="用户界面之Gallery(长廊视图)" href="index_138.html">用户界面之Gallery(长廊视图)</A></h2>

  <h2><A title="用户界面之ActionBar(导航栏)" href="index_139.html">用户界面之ActionBar(导航栏)</A></h2>

  <h2><A title="用户界面之PopupWindow(弹出窗口)" href="index_140.html">用户界面之PopupWindow(弹出窗口)</A></h2>

  <h2><A title="用户界面之RatingBar(评分栏)" href="index_141.html">用户界面之RatingBar(评分栏)</A></h2>

  <h2><A title="用户界面之Spinner" href="index_142.html">用户界面之Spinner</A></h2>

  <h2><A title="用户界面之SeekBar(搜索bar)" href="index_143.html">用户界面之SeekBar(搜索bar)</A></h2>

  <h2><A title="用户界面之TabHost(分割栏)" href="index_144.html">用户界面之TabHost(分割栏)</A></h2>

  <h2><A title="用户界面之SlidingDrawer(抽屉)" href="index_145.html">用户界面之SlidingDrawer(抽屉)</A></h2>

  <h2><A title="用户界面之ViewFlipper" href="index_146.html">用户界面之ViewFlipper</A></h2>

  <h2><A title="用户界面之SurfaceView" href="index_147.html">用户界面之SurfaceView</A></h2>

  <h2><A title="用户界面之Splash" href="index_148.html">用户界面之Splash</A></h2>

  <h2><A title="用户界面之Toast" href="index_149.html">用户界面之Toast</A></h2>

  <h2><A title="用户界面之AlarmManager" href="index_150.html">用户界面之AlarmManager</A></h2>

  <h2><A title="用户界面之Fragment" href="index_151.html">用户界面之Fragment</A></h2>

  <h2><A title="用户界面之WebView(网络视图)" href="index_152.html">用户界面之WebView(网络视图)</A></h2>

  <h2><A title="Android用户界面之Widget(小组件)" href="index_153.html">Android用户界面之Widget(小组件)</A></h2>

  <h2><A title="Android用户界面之theme和style" href="index_154.html">Android用户界面之theme和style</A></h2>

  <h2><A title="Android用户界面之多语言" href="index_155.html">Android用户界面之多语言</A></h2>

  <h2><A title="Android用户界面之界面特效" href="index_156.html">Android用户界面之界面特效</A></h2>
<UL><li ><A title=Android Activity界面切换带动画特效 href="show_3401_156.html">Android Activity界面切换带动画特效</A> </li><li ><A title=Android Button特效selector+shape href="show_3402_156.html">Android Button特效selector+shape</A> </li><li ><A title=Android 电视关闭的动画效果(姜饼版本的特效) href="show_3403_156.html">Android 电视关闭的动画效果(姜饼版本的特效)</A> </li><li ><A title=Android 拖动相片特效Gallery应用 href="show_3404_156.html">Android 拖动相片特效Gallery应用</A> </li><li ><A title=Android 照片特效 href="show_3405_156.html">Android 照片特效</A> </li><li class="currentLink"><A title=Android图像处理特效之素描效果 href="show_3406_156.html">Android图像处理特效之素描效果</A> </li><li ><A title=Android有趣的全透明效果 href="show_3407_156.html">Android有趣的全透明效果</A> </li><li ><A title=Android中的图片特效处理 href="show_3408_156.html">Android中的图片特效处理</A> </li><li ><A title=打造自己的动画效果 href="show_3409_156.html">打造自己的动画效果</A> </li><li ><A title=UI特效 href="show_3410_156.html">UI特效</A> </li></UL>
</DIV></DIV>
<DIV id=maincontent>
<DIV id=w3school>
<H1></H1>
<P><STRONG></STRONG></P></DIV>

<DIV>
<H2>Android图像处理特效之素描效果</H2>
<div style="line-height:20px; font-size:14px;"><p>自从照相技术诞生以来，我们的生活就和图片照片这些东西紧密联系起来。相应的，无论是电脑上的应用还是手机上的应用，图像处理一直是都是不可或缺的一大应用。这里边包括很多各个方面的应用，这次我就讲一个小的图像特效：素描。素描要体现的其实就是两点，一个就是图像呈黑白效果，另一个就是图像颜色深的存在，颜色浅的被忽略。图像处理的实质是对图像的像素进行处理，对于Android平台，只需要取得被处理图像的像素进行相应的运算就可以了。</p><p>原理为：先把原来的图像取均值变成黑白图像，然后对黑白图像的像素取反，对这些取反的像素进行模糊，再把原来黑白图像的像素值和模糊后的图像的像素值进行差值运算，最后就得到素描效果的图像了。下面给出代码，我们在这里采用采用高斯模糊方式进行模糊处理，当然，处理的过程中需要处理像素值越界，即大于255和小于0的情形。在本次处理我们用java语言实现，数据运算不是java的强项，如果为了追求更好的处理速度，可以采用NDK的方式来实现。代码后面给出原图和处理后的效果图，最后为了方便大家我们给出了相应的Android工程 和apk文件。</p><p><pre><font class="keyword">import </font>android.app.Activity;</p><p><font class="keyword">import </font>android.graphics.Bitmap;</p><p><font class="keyword">import </font>android.graphics.BitmapFactory;</p><p><font class="keyword">import </font>android.graphics.Color;</p><p><font class="keyword">import </font>android.os.Bundle;</p><p><font class="keyword">import </font>android.os.Handler;</p><p><font class="keyword">import </font>android.os.Message;</p><p><font class="keyword">import </font>android.util.Log;</p><p><font class="keyword">import </font>android.view.Menu;</p><p><font class="keyword">import </font>android.view.MenuItem;</p><p><font class="keyword">import </font>android.view.Window;</p><p><font class="keyword">import </font>android.widget.ImageView;</p><p><font class="keyword">public </font><font class="keyword">class </font>SketchActivity </font><font class="keyword">extends </font>Activity {</p><p>	<font class="keyword">private </font><font class="keyword">final </font><font class="keyword">int </font>PROGRESS_WAIT_VISIBLE = 1;</p><p>	<font class="keyword">private </font><font class="keyword">final </font><font class="keyword">int </font>PROGRESS_WAIT_GONE = 2;</p><p>	<font class="keyword">private </font><font class="keyword">final </font><font class="keyword">int </font>IMAGEVIEW_INVALIDATE = 3;</p><p>	<font class="keyword">private </font>ImageView mImageView;</p><p>	<font class="keyword">private </font>Bitmap mBitmap;</p><p>	<font class="keyword">private </font>Handler mHandler = </font><font class="keyword">new </font>Handler() {</p><p>		@Override</p><p>		<font class="keyword">public </font><font class="keyword">void </font>handleMessage(Message msg) {</p><p>			<font class="keyword">super</font>.handleMessage(msg);</p><p>			<font class="keyword">switch </font>(msg.what) {</p><p>			<font class="keyword">case </font>PROGRESS_WAIT_VISIBLE:</p><p>				</font>setProgressBarIndeterminateVisibility(<font class="keyword">true</font>);</p><p>				<font class="keyword">break</font>;</p><p>			<font class="keyword">case </font>PROGRESS_WAIT_GONE:</p><p>				</font>setProgressBarIndeterminateVisibility(<font class="keyword">false</font>);</p><p>				<font class="keyword">break</font>;</p><p>			<font class="keyword">case </font>IMAGEVIEW_INVALIDATE:</p><p>				mImageView.invalidate();</p><p>				<font class="keyword">break</font>;</p><p>			<font class="keyword">default</font>:</p><p>				<font class="keyword">break</font>;</p><p>			}</p><p>		}</p><p>	};</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">void </font>onCreate(Bundle savedInstanceState) {</p><p>		<font class="keyword">super</font>.onCreate(savedInstanceState);</p><p>		requestWindowFeature(Window.FEATURE_INDETERMINATE_PROGRESS);</p><p>		setContentView(R.layout.sketch);</p><p>		mImageView = (ImageView) findViewById(R.id.sketch_image);</p><p>		cancelSketch();</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">boolean </font>onCreateOptionsMenu(Menu menu) {</p><p>		<font class="keyword">super</font>.onCreateOptionsMenu(menu);</p><p>		menu.add(1, R.string.label_sketch, 1, R.string.label_sketch);</p><p>		menu.add(1, R.string.label_cancel, 2, R.string.label_cancel);</p><p>		<font class="keyword">return </font><font class="keyword">true</font>;</p><p>	}</p><p>	@Override</p><p>	<font class="keyword">public </font><font class="keyword">boolean </font>onOptionsItemSelected(MenuItem item) {</p><p>		<font class="keyword">super</font>.onOptionsItemSelected(item);</p><p>		<font class="keyword">switch </font>(item.getItemId()) {</p><p>		<font class="keyword">case </font>R.string.label_sketch:</p><p>			doSketch();</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">case </font>R.string.label_cancel:</p><p>			cancelSketch();</p><p>			<font class="keyword">break</font>;</p><p>		<font class="keyword">default</font>:</p><p>			<font class="keyword">break</font>;</p><p>		}</p><p>		<font class="keyword">return </font><font class="keyword">true</font>;</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>cancelSketch() {</p><p>		Bitmap bmp = BitmapFactory.decodeStream(getResources().openRawResource(</p><p>				R.drawable.demo));</p><p>		<font class="keyword">int </font>width = bmp.getWidth();</p><p>		<font class="keyword">int </font>height = bmp.getHeight();</p><p>		<font class="keyword">int</font>[] pixel = </font><font class="keyword">new </font><font class="keyword">int</font>[width * height];</p><p>		bmp.getPixels(pixel, 0, width, 0, 0, width, height);</p><p>		mBitmap = Bitmap.createBitmap(width, height, bmp.getConfig());</p><p>		mBitmap.setPixels(pixel, 0, width, 0, 0, width, height);</p><p>		mImageView.setImageBitmap(mBitmap);</p><p>		bmp.recycle();</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>doSketch() {</p><p>		<font class="keyword">new </font>Thread(</font><font class="keyword">new </font>Runnable() {</p><p>			<font class="keyword">public </font><font class="keyword">void </font>run() {</p><p>				<font class="keyword">try </font>{</p><p>					<font class="keyword">int </font>pos, row, col, clr;</p><p>					<font class="keyword">int </font>width = mBitmap.getWidth();</p><p>					<font class="keyword">int </font>height = mBitmap.getHeight();</p><p>					<font class="keyword">int</font>[] pixSrc = </font><font class="keyword">new </font><font class="keyword">int</font>[width * height];</p><p>					<font class="keyword">int</font>[] pixNvt = </font><font class="keyword">new </font><font class="keyword">int</font>[width * height];</p><p>					mHandler.sendEmptyMessage(PROGRESS_WAIT_VISIBLE);</p><p>					mBitmap.getPixels(pixSrc, 0, width, 0, 0, width, height);</p><p>					<font class="Comments">// 先对图象的像素处理成灰度颜色后再取反</font></p><p>					<font class="keyword">for </font>(row = 0; row &lt; height; row++) {</p><p>						<font class="keyword">for </font>(col = 0; col &lt; width; col++) {</p><p>							pos = row * width + col;</p><p>							pixSrc[pos] = (Color.red(pixSrc[pos])</p><p>									+ Color.green(pixSrc[pos]) + Color</p><p>									.blue(pixSrc[pos])) / 3;</p><p>							pixNvt[pos] = 255 - pixSrc[pos];</p><p>						}</p><p>					}</p><p>					<font class="Comments">// 对取反的像素进行高斯模糊, 强度可以设置，暂定为5.0</font></p><p>					gaussGray(pixNvt, 5.0, 5.0, width, height);</p><p>					<font class="Comments">// 灰度颜色和模糊后像素进行差值运算</font></p><p>					<font class="keyword">for </font>(row = 0; row &lt; height; row++) {</p><p>						<font class="keyword">for </font>(col = 0; col &lt; width; col++) {</p><p>							pos = row * width + col;</p><p></p><p>							clr = pixSrc[pos] &lt;&lt; 8;</p><p>							clr /= 256 - pixNvt[pos];</p><p>							clr = Math.min(clr, 255);</p><p></p><p>							pixSrc[pos] = Color.rgb(clr, clr, clr);</p><p>						}</p><p>					}</p><p>					<font class="Comments">// 将处理好的数据更新到图象中</font></p><p>					mBitmap.setPixels(pixSrc, 0, width, 0, 0, width, height);</p><p>					mHandler.sendEmptyMessage(IMAGEVIEW_INVALIDATE);</p><p>				</font>} <font class="keyword">catch </font>(Exception e) {</p><p>					</font>Log.e(<font class="Fields">"sketch"</font>, e.getMessage());</p><p>				} finally {</p><p>					mHandler.sendEmptyMessage(PROGRESS_WAIT_GONE);</p><p>				}</p><p>			}</p><p>		}).start();</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">static </font><font class="keyword">void </font>transferGaussPixels(</font><font class="keyword">double</font>[] src1, </font><font class="keyword">double</font>[] src2,</p><p>			<font class="keyword">int</font>[] dest, </font><font class="keyword">int </font>bytes, </font><font class="keyword">int </font>width) {</p><p>		<font class="keyword">int </font>i, j, k, b;</p><p>		<font class="keyword">int </font>bend = bytes * width;</p><p>		<font class="keyword">double </font>sum;</p><p>		i = j = k = 0;</p><p>		<font class="keyword">for </font>(b = 0; b &lt; bend; b++) {</p><p>			sum = src1[i++] + src2[j++];</p><p>			<font class="keyword">if </font>(sum &gt; 255)</p><p>				sum = 255;</p><p>			<font class="keyword">else </font><font class="keyword">if </font>(sum &lt; 0)</p><p>				sum = 0;</p><p>			</font>dest[k++] = (<font class="keyword">int</font>) sum;</p><p>		}</p><p>	}</p><p>	<font class="keyword">private </font><font class="keyword">void </font>findConstants(</font><font class="keyword">double</font>[] n_p, </font><font class="keyword">double</font>[] n_m, </font><font class="keyword">double</font>[] d_p,</p><p>			<font class="keyword">double</font>[] d_m, </font><font class="keyword">double</font>[] bd_p, </font><font class="keyword">double</font>[] bd_m, </font><font class="keyword">double </font>std_dev) {</p><p>		<font class="keyword">double </font>div = Math.sqrt(2 * 3.141593) * std_dev;</p><p>		<font class="keyword">double </font>x0 = -1.783 / std_dev;</p><p>		<font class="keyword">double </font>x1 = -1.723 / std_dev;</p><p>		<font class="keyword">double </font>x2 = 0.6318 / std_dev;</p><p>		<font class="keyword">double </font>x3 = 1.997 / std_dev;</p><p>		<font class="keyword">double </font>x4 = 1.6803 / div;</p><p>		<font class="keyword">double </font>x5 = 3.735 / div;</p><p>		<font class="keyword">double </font>x6 = -0.6803 / div;</p><p>		<font class="keyword">double </font>x7 = -0.2598 / div;</p><p>		<font class="keyword">int </font>i;</p><p>		n_p[0] = x4 + x6;</p><p>		n_p[1] = (Math.exp(x1)</p><p>				<font class="Comments">* (x7 <font class="Comments">* Math.sin(x3) - (x6 + 2 <font class="Comments">* x4) <font class="Comments">* Math.cos(x3)) + Math</font></p><p>				.exp(x0) * (x5 * Math.sin(x2) - (2 * x6 + x4) * Math.cos(x2)));</p><p>		n_p[2] = (2</p><p>				<font class="Comments">* Math.exp(x0 + x1)</font></p><p>				<font class="Comments">* ((x4 + x6) <font class="Comments">* Math.cos(x3) <font class="Comments">* Math.cos(x2) - x5 <font class="Comments">* Math.cos(x3)</font></p><p>						<font class="Comments">* Math.sin(x2) - x7 <font class="Comments">* Math.cos(x2) <font class="Comments">* Math.sin(x3)) + x6</font></p><p>				<font class="Comments">* Math.exp(2 <font class="Comments">* x0) + x4 <font class="Comments">* Math.exp(2 <font class="Comments">* x1));</font></p><p>		n_p[3] = (Math.exp(x1 + 2 * x0)</p><p>				<font class="Comments">* (x7 <font class="Comments">* Math.sin(x3) - x6 <font class="Comments">* Math.cos(x3)) + Math.exp(x0 + 2</font></p><p>				<font class="Comments">* x1)</font></p><p>				<font class="Comments">* (x5 <font class="Comments">* Math.sin(x2) - x4 <font class="Comments">* Math.cos(x2)));</font></p><p>		n_p[4] = 0.0;</p><p>		d_p[0] = 0.0;</p><p>		d_p[1] = -2 * Math.exp(x1) * Math.cos(x3) - 2 * Math.exp(x0)</p><p>				<font class="Comments">* Math.cos(x2);</font></p><p>		d_p[2] = 4 * Math.cos(x3) * Math.cos(x2) * Math.exp(x0 + x1)</p><p>				+ Math.exp(2 * x1) + Math.exp(2 * x0);</p><p>		d_p[3] = -2 * Math.cos(x2) * Math.exp(x0 + 2 * x1) - 2 * Math.cos(x3)</p><p>				<font class="Comments">* Math.exp(x1 + 2 <font class="Comments">* x0);</font></p><p>		d_p[4] = Math.exp(2 * x0 + 2 * x1);</p><p>		<font class="keyword">for </font>(i = 0; i &lt;= 4; i++) {</p><p>			d_m = d_p;</p><p>		}</p><p>		n_m[0] = 0.0;</p><p>		<font class="keyword">for </font>(i = 1; i &lt;= 4; i++) {</p><p>			n_m = n_p - d_p * n_p[0];</p><p>		}</p><p>		<font class="keyword">double </font>sum_n_p, sum_n_m, sum_d;</p><p>		<font class="keyword">double </font>a, b;</p><p>		sum_n_p = 0.0;</p><p>		sum_n_m = 0.0;</p><p>		sum_d = 0.0;</p><p>		<font class="keyword">for </font>(i = 0; i &lt;= 4; i++) {</p><p>			sum_n_p += n_p;</p><p>			sum_n_m += n_m;</p><p>			sum_d += d_p;</p><p>		}</p><p>		a = sum_n_p / (1.0 + sum_d);</p><p>		b = sum_n_m / (1.0 + sum_d);</p><p>		<font class="keyword">for </font>(i = 0; i &lt;= 4; i++) {</p><p>			bd_p = d_p * a;</p><p>			bd_m = d_m * b;</p><p>		}</p><p>	}</p><p>	<font class="Comments">// 高斯模糊</font></p><p>	<font class="keyword">private </font><font class="keyword">int </font>gaussGray(</font><font class="keyword">int</font>[] psrc, </font><font class="keyword">double </font>horz, </font><font class="keyword">double </font>vert, </font><font class="keyword">int </font>width,</p><p>			<font class="keyword">int </font>height) {</p><p>		<font class="keyword">int</font>[] dst, src;</p><p>		<font class="keyword">double</font>[] n_p, n_m, d_p, d_m, bd_p, bd_m;</p><p>		<font class="keyword">double</font>[] val_p, val_m;</p><p>		<font class="keyword">int </font>i, j, t, k, row, col, terms;</p><p>		<font class="keyword">int</font>[] initial_p, initial_m;</p><p>		<font class="keyword">double </font>std_dev;</p><p>		<font class="keyword">int </font>row_stride = width;</p><p>		<font class="keyword">int </font>max_len = Math.max(width, height);</p><p>		<font class="keyword">int </font>sp_p_idx, sp_m_idx, vp_idx, vm_idx;</p><p>		</font>val_p = <font class="keyword">new </font><font class="keyword">double</font>[max_len];</p><p>		</font>val_m = <font class="keyword">new </font><font class="keyword">double</font>[max_len];</p><p>		</font>n_p = <font class="keyword">new </font><font class="keyword">double</font>[5];</p><p>		</font>n_m = <font class="keyword">new </font><font class="keyword">double</font>[5];</p><p>		</font>d_p = <font class="keyword">new </font><font class="keyword">double</font>[5];</p><p>		</font>d_m = <font class="keyword">new </font><font class="keyword">double</font>[5];</p><p>		</font>bd_p = <font class="keyword">new </font><font class="keyword">double</font>[5];</p><p>		</font>bd_m = <font class="keyword">new </font><font class="keyword">double</font>[5];</p><p>		</font>src = <font class="keyword">new </font><font class="keyword">int</font>[max_len];</p><p>		</font>dst = <font class="keyword">new </font><font class="keyword">int</font>[max_len];</p><p>		</font>initial_p = <font class="keyword">new </font><font class="keyword">int</font>[4];</p><p>		</font>initial_m = <font class="keyword">new </font><font class="keyword">int</font>[4];</p><p>		<font class="Comments">// 垂直方向</font></p><p>		<font class="keyword">if </font>(vert &gt; 0.0) {</p><p>			vert = Math.abs(vert) + 1.0;</p><p>			std_dev = Math.sqrt(-(vert * vert) / (2 * Math.log(1.0 / 255.0)));</p><p>			<font class="Comments">// 初试化常量</font></p><p>			findConstants(n_p, n_m, d_p, d_m, bd_p, bd_m, std_dev);</p><p>			<font class="keyword">for </font>(col = 0; col &lt; width; col++) {</p><p>				<font class="keyword">for </font>(k = 0; k &lt; max_len; k++) {</p><p>					val_m[k] = val_p[k] = 0;</p><p>				}</p><p>				<font class="keyword">for </font>(t = 0; t &lt; height; t++) {</p><p>					src[t] = psrc[t * row_stride + col];</p><p>				}</p><p>				sp_p_idx = 0;</p><p>				sp_m_idx = height - 1;</p><p>				vp_idx = 0;</p><p>				vm_idx = height - 1;</p><p>				initial_p[0] = src[0];</p><p>				initial_m[0] = src[height - 1];</p><p>				<font class="keyword">for </font>(row = 0; row &lt; height; row++) {</p><p>					terms = (row &lt; 4) ? row : 4;</p><p>					<font class="keyword">for </font>(i = 0; i &lt;= terms; i++) {</p><p>						val_p[vp_idx] += n_p * src[sp_p_idx - i] - d_p</p><p>								<font class="Comments">* val_p[vp_idx - i];</font></p><p>						val_m[vm_idx] += n_m * src[sp_m_idx + i] - d_m</p><p>								<font class="Comments">* val_m[vm_idx + i];</font></p><p>					}</p><p>					<font class="keyword">for </font>(j = i; j &lt;= 4; j++) {</p><p>						val_p[vp_idx] += (n_p[j] - bd_p[j]) * initial_p[0];</p><p>						val_m[vm_idx] += (n_m[j] - bd_m[j]) * initial_m[0];</p><p>					}</p><p>					sp_p_idx++;</p><p>					sp_m_idx--;</p><p>					vp_idx++;</p><p>					vm_idx--;</p><p>				}</p><p>				transferGaussPixels(val_p, val_m, dst, 1, height);</p><p>				<font class="keyword">for </font>(t = 0; t &lt; height; t++) {</p><p>					psrc[t * row_stride + col] = dst[t];</p><p>				}</p><p>			}</p><p>		}</p><p>		<font class="Comments">// 水平方向</font></p><p>		<font class="keyword">if </font>(horz &gt; 0.0) {</p><p>			horz = Math.abs(horz) + 1.0;</p><p>			<font class="keyword">if </font>(horz != vert) {</p><p>				std_dev = Math.sqrt(-(horz * horz)</p><p>						/ (2 * Math.log(1.0 / 255.0)));</p><p>				<font class="Comments">// 初试化常量</font></p><p>				findConstants(n_p, n_m, d_p, d_m, bd_p, bd_m, std_dev);</p><p>			}</p><p>			<font class="keyword">for </font>(row = 0; row &lt; height; row++) {</p><p>				<font class="keyword">for </font>(k = 0; k &lt; max_len; k++) {</p><p>					val_m[k] = val_p[k] = 0;</p><p>				}</p><p>				<font class="keyword">for </font>(t = 0; t &lt; width; t++) {</p><p>					src[t] = psrc[row * row_stride + t];</p><p>				}</p><p>				sp_p_idx = 0;</p><p>				sp_m_idx = width - 1;</p><p>				vp_idx = 0;</p><p>				vm_idx = width - 1;</p><p>				initial_p[0] = src[0];</p><p>				initial_m[0] = src[width - 1];</p><p>				<font class="keyword">for </font>(col = 0; col &lt; width; col++) {</p><p>					terms = (col &lt; 4) ? col : 4;</p><p>					<font class="keyword">for </font>(i = 0; i &lt;= terms; i++) {</p><p>						val_p[vp_idx] += n_p * src[sp_p_idx - i] - d_p</p><p>								<font class="Comments">* val_p[vp_idx - i];</font></p><p>						val_m[vm_idx] += n_m * src[sp_m_idx + i] - d_m</p><p>								<font class="Comments">* val_m[vm_idx + i];</font></p><p>					}</p><p>					<font class="keyword">for </font>(j = i; j &lt;= 4; j++) {</p><p>						val_p[vp_idx] += (n_p[j] - bd_p[j]) * initial_p[0];</p><p>						val_m[vm_idx] += (n_m[j] - bd_m[j]) * initial_m[0];</p><p>					}</p><p>					sp_p_idx++;</p><p>					sp_m_idx--;</p><p>					vp_idx++;</p><p>					vm_idx--;</p><p>				}</p><p>				transferGaussPixels(val_p, val_m, dst, 1, width);</p><p></p><p>				<font class="keyword">for </font>(t = 0; t &lt; width; t++) {</p><p>					psrc[row * row_stride + t] = dst[t];</p><p>				}</p><p>			}</p><p>		}</p><p>		<font class="keyword">return </font>0;</p><p>	}</p><p>}</p><p></pre></p><p>左边为原图，右边为处理后的图像，原图偏绿，如果觉得图像有点偏绿，可以在进行灰度处理时进行校正，这里就不啰嗦了。</p><p><img src="../img/view_ani/06_ani.jpg"></p><p></p></div>

</DIV></DIV>

<DIV id=footer style="display:none">
<P align="center">  
 
  
   </P>
</DIV></BODY></HTML>

